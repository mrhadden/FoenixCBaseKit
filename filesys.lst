  Thu Dec  3 2020 22:25                                                Page 1


                     ***************************************
                     **      WDC 65C816 Macro Assembler   **
                     **                                   **
                     **     Version 3.49.1- Feb  6 2006    **
                     ***************************************

     1                        ;:ts=8
     2             00000001   R0	equ	1
     3             00000005   R1	equ	5
     4             00000009   R2	equ	9
     5             0000000D   R3	equ	13
     6                        	.file	"G:\devprojects\c256Foenix\fxos\FXOSWork
                    space\FXOSv1\src\FILE_SYS.C",0
     7                        ;
     8                        ;#include	"FILE_SYS.H"
     9                        	.file	"G:\devprojects\c256Foenix\fxos\FXOSWork
                    space\FXOSv1\src\FILE_SYS.H",0
    10                        	.file	"G:\devprojects\c256Foenix\fxos\FXOSWork
                    space\FXOSv1\src\HAL.H",0
    11                        	.file	"G:\devprojects\c256Foenix\fxos\FXOSWork
                    space\FXOSv1\src\CH376INC.H",0
    12                        	.stag	_FAT_DIR_INFO,256,1
    13                        	.member	DIR_Name,0,110,8,0,11
    14                        	.member	DIR_Attr,88,14,8,8
    15                        	.member	DIR_NTRes,96,14,8,8
    16                        	.member	DIR_CrtTimeTenth,104,14,8,8
    17                        	.member	DIR_CrtTime,112,15,8,16
    18                        	.member	DIR_CrtDate,128,15,8,16
    19                        	.member	DIR_LstAccDate,144,15,8,16
    20                        	.member	DIR_FstClusHI,160,15,8,16
    21                        	.member	DIR_WrtTime,176,15,8,16
    22                        	.member	DIR_WrtDate,192,15,8,16
    23                        	.member	DIR_FstClusLO,208,15,8,16
    24                        	.member	DIR_FileSize,224,18,8,32
    25                        	.eos
    26                        	.stag	_BULK_ONLY_CBW,248,2
    27                        	.member	CBW_Sig,0,18,8,32
    28                        	.member	CBW_Tag,32,18,8,32
    29                        	.member	CBW_DataLen0,64,14,8,8
    30                        	.member	CBW_DataLen1,72,14,8,8
    31                        	.member	CBW_DataLen2,80,15,8,16
    32                        	.member	CBW_Flag,96,14,8,8
    33                        	.member	CBW_LUN,104,14,8,8
    34                        	.member	CBW_CB_Len,112,14,8,8
    35                        	.member	CBW_CB_Buf,120,110,8,0,16
    36                        	.eos
    37                        	.stag	_INQUIRY_DATA,288,3
    38                        	.member	DeviceType,0,14,8,8
    39                        	.member	RemovableMedia,8,14,8,8
    40                        	.member	Versions,16,14,8,8
    41                        	.member	DataFormatAndEtc,24,14,8,8
    42                        	.member	AdditionalLength,32,14,8,8
    43                        	.member	Reserved1,40,14,8,8
    44                        	.member	Reserved2,48,14,8,8
    45                        	.member	MiscFlag,56,14,8,8
    46                        	.member	VendorIdStr,64,110,8,0,8
    47                        	.member	ProductIdStr,128,110,8,0,16
    48                        	.member	ProductRevStr,256,110,8,0,4
  Thu Dec  3 2020 22:25                                                Page 2


    49                        	.eos
    50                        	.stag	_SENSE_DATA,144,4
    51                        	.member	ErrorCode,0,14,8,8
    52                        	.member	SegmentNumber,8,14,8,8
    53                        	.member	SenseKeyAndEtc,16,14,8,8
    54                        	.member	Information0,24,14,8,8
    55                        	.member	Information1,32,14,8,8
    56                        	.member	Information2,40,14,8,8
    57                        	.member	Information3,48,14,8,8
    58                        	.member	AdditSenseLen,56,14,8,8
    59                        	.member	CmdSpecInfo,64,110,8,0,4
    60                        	.member	AdditSenseCode,96,14,8,8
    61                        	.member	AddSenCodeQual,104,14,8,8
    62                        	.member	FieldReplaUnit,112,14,8,8
    63                        	.member	SenseKeySpec,120,110,8,0,3
    64                        	.eos
    65                        	.stag	fake5_,112,5
    66                        	.member	mBuffer,0,110,8,0,14
    67                        	.eos
    68                        	.stag	fake6_,8,6
    69                        	.member	mUpdateFileSz,0,14,8,8
    70                        	.eos
    71                        	.stag	fake7_,8,7
    72                        	.member	mDirInfoIndex,0,14,8,8
    73                        	.eos
    74                        	.utag	fake8_,32,8
    75                        	.member	mByteOffset,0,18,11,32
    76                        	.member	mSectorLba,0,18,11,32
    77                        	.eos
    78                        	.stag	fake9_,16,9
    79                        	.member	mByteCount,0,15,8,16
    80                        	.eos
    81                        	.stag	fake10_,16,10
    82                        	.member	mByteCount,0,15,8,16
    83                        	.eos
    84                        	.utag	fake11_,32,11
    85                        	.member	mSectorOffset,0,18,11,32
    86                        	.member	mSectorLba,0,18,11,32
    87                        	.eos
    88                        	.stag	fake12_,64,12
    89                        	.member	mSectorCount,0,14,8,8
    90                        	.member	mReserved1,8,14,8,8
    91                        	.member	mReserved2,16,14,8,8
    92                        	.member	mReserved3,24,14,8,8
    93                        	.member	mStartSector,32,18,8,32
    94                        	.eos
    95                        	.stag	fake13_,64,13
    96                        	.member	mSectorCount,0,14,8,8
    97                        	.member	mReserved1,8,14,8,8
    98                        	.member	mReserved2,16,14,8,8
    99                        	.member	mReserved3,24,14,8,8
   100                        	.member	mStartSector,32,18,8,32
   101                        	.eos
   102                        	.stag	fake14_,32,14
   103                        	.member	mDiskSizeSec,0,18,8,32
   104                        	.eos
   105                        	.stag	fake15_,72,15
   106                        	.member	mTotalSector,0,18,8,32
  Thu Dec  3 2020 22:25                                                Page 3


   107                        	.member	mFreeSector,32,18,8,32
   108                        	.member	mDiskFat,64,14,8,8
   109                        	.eos
   110                        	.stag	fake16_,8,16
   111                        	.member	mMaxLogicUnit,0,14,8,8
   112                        	.eos
   113                        	.stag	fake17_,32,17
   114                        	.member	mDiskSizeSec,0,18,8,32
   115                        	.eos
   116                        	.stag	fake18_,40,18
   117                        	.member	mStartSector,0,18,8,32
   118                        	.member	mSectorCount,32,14,8,8
   119                        	.eos
   120                        	.stag	fake19_,40,19
   121                        	.member	mStartSector,0,18,8,32
   122                        	.member	mSectorCount,32,14,8,8
   123                        	.eos
   124                        	.utag	_CH376_CMD_DATA,288,20
   125                        	.member	Default,0,10,11,112,5
   126                        	.member	DiskMountInq,0,10,11,288,3
   127                        	.member	OpenDirInfo,0,10,11,256,1
   128                        	.member	EnumDirInfo,0,10,11,256,1
   129                        	.member	FileCLose,0,10,11,8,6
   130                        	.member	DirInfoRead,0,10,11,8,7
   131                        	.member	ByteLocate,0,11,11,32,8
   132                        	.member	ByteRead,0,10,11,16,9
   133                        	.member	ByteWrite,0,10,11,16,10
   134                        	.member	SectorLocate,0,11,11,32,11
   135                        	.member	SectorRead,0,10,11,64,12
   136                        	.member	SectorWrite,0,10,11,64,13
   137                        	.member	DiskCapacity,0,10,11,32,14
   138                        	.member	DiskQuery,0,10,11,72,15
   139                        	.member	DiskBocCbw,0,10,11,248,2
   140                        	.member	DiskMaxLun,0,10,11,8,16
   141                        	.member	DiskInitInq,0,10,11,288,3
   142                        	.member	DiskInqData,0,10,11,288,3
   143                        	.member	ReqSenseData,0,10,11,144,4
   144                        	.member	DiskSize,0,10,11,32,17
   145                        	.member	DiskRead,0,10,11,40,18
   146                        	.member	DiskWrite,0,10,11,40,19
   147                        	.eos
   148                        	.line	586
   149                        	.file	"G:\devprojects\c256Foenix\fxos\FXOSWork
                    space\FXOSv1\src\HAL.H",4
   150                        	.line	42
   151                        	.file	"G:\devprojects\c256Foenix\fxos\FXOSWork
                    space\FXOSv1\src\FILE_SYS.H",6
   152                        	.line	124
   153                        	.file	"G:\devprojects\c256Foenix\fxos\FXOSWork
                    space\FXOSv1\src\FILE_SYS.C",2
   154                        ;
   155                        ;UINT8	CH376ReadBlock( PUINT8 buf )
   156                        ;{
   157                        	.line	4
   158                        	.line	5
   159                        	code
   160                        	xdef	~~CH376ReadBlock
   161                        	func
  Thu Dec  3 2020 22:25                                                Page 4


   162                        	.function	5
   163                        ~~CH376ReadBlock:
   164                        	longa	on
   165                        	longi	on
   166 00:0000: 3B           	tsc
   167 00:0001: 38           	sec
   168 00:0002: E9 02 00     	sbc	#L2
   169 00:0005: 1B           	tcs
   170 00:0006: 0B           	phd
   171 00:0007: 5B           	tcd
   172             00000004   buf_0	set	4
   173                        	.block	5
   174                        ;	UINT8	s, l;
   175                        ;	xWriteCH376Cmd( CMD01_RD_USB_DATA0 );
   176             00000000   s_1	set	0
   177             00000001   l_1	set	1
   178                        	.sym	s,0,14,1,8
   179                        	.sym	l,1,14,1,8
   180                        	.sym	buf,4,142,6,32
   181                        	.line	7
   182 00:0008: F4 27 00     	pea	#<$27
   183 00:000B: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
   184                        ;	s = l = xReadCH376Data( );
   185                        	.line	8
   186 00:000F: 22 xx xx xx  	jsl	~~xReadCH376Data
   187 00:0013: E2 20        	sep	#$20
   188                        	longa	off
   189 00:0015: 85 02        	sta	<L3+l_1
   190 00:0017: C2 20        	rep	#$20
   191                        	longa	on
   192 00:0019: E2 20        	sep	#$20
   193                        	longa	off
   194 00:001B: A5 02        	lda	<L3+l_1
   195 00:001D: 85 01        	sta	<L3+s_1
   196 00:001F: C2 20        	rep	#$20
   197                        	longa	on
   198                        ;	if ( l ) {
   199                        	.line	9
   200 00:0021: A5 02        	lda	<L3+l_1
   201 00:0023: 29 FF 00     	and	#$ff
   202 00:0026: D0 03        	bne	L5
   203 00:0028: 82 20 00     	brl	L10001
   204                        L5:
   205                        	.line	9
   206                        ;		do {
   207                        	.line	10
   208                        L10004:
   209                        	.line	10
   210                        ;			*buf = xReadCH376Data( );
   211                        	.line	11
   212 00:002B: 22 xx xx xx  	jsl	~~xReadCH376Data
   213 00:002F: E2 20        	sep	#$20
   214                        	longa	off
   215 00:0031: 87 06        	sta	[<L2+buf_0]
   216 00:0033: C2 20        	rep	#$20
   217                        	longa	on
   218                        ;			buf ++;
   219                        	.line	12
  Thu Dec  3 2020 22:25                                                Page 5


   220 00:0035: E6 06        	inc	<L2+buf_0
   221 00:0037: D0 02        	bne	L6
   222 00:0039: E6 08        	inc	<L2+buf_0+2
   223                        L6:
   224                        ;		} while ( -- l );
   225                        	.line	13
   226                        L10002:
   227 00:003B: E2 20        	sep	#$20
   228                        	longa	off
   229 00:003D: C6 02        	dec	<L3+l_1
   230 00:003F: C2 20        	rep	#$20
   231                        	longa	on
   232 00:0041: A5 02        	lda	<L3+l_1
   233 00:0043: 29 FF 00     	and	#$ff
   234 00:0046: F0 03        	beq	L7
   235 00:0048: 82 E0 FF     	brl	L10004
   236                        L7:
   237                        L10003:
   238                        ;	}
   239                        	.line	14
   240                        ;	xEndCH376Cmd( );
   241                        L10001:
   242                        	.line	15
   243 00:004B: 22 xx xx xx  	jsl	~~xEndCH376Cmd
   244                        ;	return( s );
   245                        	.line	16
   246 00:004F: A5 01        	lda	<L3+s_1
   247 00:0051: 29 FF 00     	and	#$ff
   248                        L8:
   249 00:0054: A8           	tay
   250 00:0055: A5 04        	lda	<L2+2
   251 00:0057: 85 08        	sta	<L2+2+4
   252 00:0059: A5 03        	lda	<L2+1
   253 00:005B: 85 07        	sta	<L2+1+4
   254 00:005D: 2B           	pld
   255 00:005E: 3B           	tsc
   256 00:005F: 18           	clc
   257 00:0060: 69 06 00     	adc	#L2+4
   258 00:0063: 1B           	tcs
   259 00:0064: 98           	tya
   260 00:0065: 6B           	rtl
   261                        ;}
   262                        	.line	17
   263                        	.endblock	17
   264             00000002   L2	equ	2
   265             00000001   L3	equ	1
   266                        	ends
   267                        	efunc
   268                        	.endfunc	17,1,2
   269                        	.line	17
   270                        ;
   271                        ;UINT8	CH376WriteReqBlock( PUINT8 buf )
   272                        ;{
   273                        	.line	19
   274                        	.line	20
   275                        	code
   276                        	xdef	~~CH376WriteReqBlock
   277                        	func
  Thu Dec  3 2020 22:25                                                Page 6


   278                        	.function	20
   279                        ~~CH376WriteReqBlock:
   280                        	longa	on
   281                        	longi	on
   282 00:0066: 3B           	tsc
   283 00:0067: 38           	sec
   284 00:0068: E9 02 00     	sbc	#L9
   285 00:006B: 1B           	tcs
   286 00:006C: 0B           	phd
   287 00:006D: 5B           	tcd
   288             00000004   buf_0	set	4
   289                        	.block	20
   290                        ;	UINT8	s, l;
   291                        ;	xWriteCH376Cmd( CMD01_WR_REQ_DATA );
   292             00000000   s_1	set	0
   293             00000001   l_1	set	1
   294                        	.sym	s,0,14,1,8
   295                        	.sym	l,1,14,1,8
   296                        	.sym	buf,4,142,6,32
   297                        	.line	22
   298 00:006E: F4 2D 00     	pea	#<$2d
   299 00:0071: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
   300                        ;	s = l = xReadCH376Data( );
   301                        	.line	23
   302 00:0075: 22 xx xx xx  	jsl	~~xReadCH376Data
   303 00:0079: E2 20        	sep	#$20
   304                        	longa	off
   305 00:007B: 85 02        	sta	<L10+l_1
   306 00:007D: C2 20        	rep	#$20
   307                        	longa	on
   308 00:007F: E2 20        	sep	#$20
   309                        	longa	off
   310 00:0081: A5 02        	lda	<L10+l_1
   311 00:0083: 85 01        	sta	<L10+s_1
   312 00:0085: C2 20        	rep	#$20
   313                        	longa	on
   314                        ;	if ( l ) {
   315                        	.line	24
   316 00:0087: A5 02        	lda	<L10+l_1
   317 00:0089: 29 FF 00     	and	#$ff
   318 00:008C: D0 03        	bne	L12
   319 00:008E: 82 1D 00     	brl	L10005
   320                        L12:
   321                        	.line	24
   322                        ;		do {
   323                        	.line	25
   324                        L10008:
   325                        	.line	25
   326                        ;			xWriteCH376Data( *buf );
   327                        	.line	26
   328 00:0091: A7 06        	lda	[<L9+buf_0]
   329 00:0093: 48           	pha
   330 00:0094: 22 xx xx xx  	jsl	~~xWriteCH376Data
   331                        ;			buf ++;
   332                        	.line	27
   333 00:0098: E6 06        	inc	<L9+buf_0
   334 00:009A: D0 02        	bne	L13
   335 00:009C: E6 08        	inc	<L9+buf_0+2
  Thu Dec  3 2020 22:25                                                Page 7


   336                        L13:
   337                        ;		} while ( -- l );
   338                        	.line	28
   339                        L10006:
   340 00:009E: E2 20        	sep	#$20
   341                        	longa	off
   342 00:00A0: C6 02        	dec	<L10+l_1
   343 00:00A2: C2 20        	rep	#$20
   344                        	longa	on
   345 00:00A4: A5 02        	lda	<L10+l_1
   346 00:00A6: 29 FF 00     	and	#$ff
   347 00:00A9: F0 03        	beq	L14
   348 00:00AB: 82 E3 FF     	brl	L10008
   349                        L14:
   350                        L10007:
   351                        ;	}
   352                        	.line	29
   353                        ;	xEndCH376Cmd( );
   354                        L10005:
   355                        	.line	30
   356 00:00AE: 22 xx xx xx  	jsl	~~xEndCH376Cmd
   357                        ;	return( s );
   358                        	.line	31
   359 00:00B2: A5 01        	lda	<L10+s_1
   360 00:00B4: 29 FF 00     	and	#$ff
   361                        L15:
   362 00:00B7: A8           	tay
   363 00:00B8: A5 04        	lda	<L9+2
   364 00:00BA: 85 08        	sta	<L9+2+4
   365 00:00BC: A5 03        	lda	<L9+1
   366 00:00BE: 85 07        	sta	<L9+1+4
   367 00:00C0: 2B           	pld
   368 00:00C1: 3B           	tsc
   369 00:00C2: 18           	clc
   370 00:00C3: 69 06 00     	adc	#L9+4
   371 00:00C6: 1B           	tcs
   372 00:00C7: 98           	tya
   373 00:00C8: 6B           	rtl
   374                        ;}
   375                        	.line	32
   376                        	.endblock	32
   377             00000002   L9	equ	2
   378             00000001   L10	equ	1
   379                        	ends
   380                        	efunc
   381                        	.endfunc	32,1,2
   382                        	.line	32
   383                        ;
   384                        ;void	CH376WriteHostBlock( PUINT8 buf, UINT8 l
                    en )
   385                        ;{
   386                        	.line	34
   387                        	.line	35
   388                        	code
   389                        	xdef	~~CH376WriteHostBlock
   390                        	func
   391                        	.function	35
   392                        ~~CH376WriteHostBlock:
  Thu Dec  3 2020 22:25                                                Page 8


   393                        	longa	on
   394                        	longi	on
   395 00:00C9: 3B           	tsc
   396 00:00CA: 38           	sec
   397 00:00CB: E9 00 00     	sbc	#L16
   398 00:00CE: 1B           	tcs
   399 00:00CF: 0B           	phd
   400 00:00D0: 5B           	tcd
   401             00000004   buf_0	set	4
   402             00000008   len_0	set	8
   403                        	.block	35
   404                        ;	xWriteCH376Cmd( CMD10_WR_HOST_DATA );
   405                        	.sym	buf,4,142,6,32
   406                        	.sym	len,8,14,6,8
   407                        	.line	36
   408 00:00D1: F4 2C 00     	pea	#<$2c
   409 00:00D4: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
   410                        ;	xWriteCH376Data( len );
   411                        	.line	37
   412 00:00D8: D4 08        	pei	<L16+len_0
   413 00:00DA: 22 xx xx xx  	jsl	~~xWriteCH376Data
   414                        ;	if ( len ) {
   415                        	.line	38
   416 00:00DE: A5 08        	lda	<L16+len_0
   417 00:00E0: 29 FF 00     	and	#$ff
   418 00:00E3: D0 03        	bne	L19
   419 00:00E5: 82 1D 00     	brl	L10009
   420                        L19:
   421                        	.line	38
   422                        ;		do {
   423                        	.line	39
   424                        L10012:
   425                        	.line	39
   426                        ;			xWriteCH376Data( *buf );
   427                        	.line	40
   428 00:00E8: A7 04        	lda	[<L16+buf_0]
   429 00:00EA: 48           	pha
   430 00:00EB: 22 xx xx xx  	jsl	~~xWriteCH376Data
   431                        ;			buf ++;
   432                        	.line	41
   433 00:00EF: E6 04        	inc	<L16+buf_0
   434 00:00F1: D0 02        	bne	L20
   435 00:00F3: E6 06        	inc	<L16+buf_0+2
   436                        L20:
   437                        ;		} while ( -- len );
   438                        	.line	42
   439                        L10010:
   440 00:00F5: E2 20        	sep	#$20
   441                        	longa	off
   442 00:00F7: C6 08        	dec	<L16+len_0
   443 00:00F9: C2 20        	rep	#$20
   444                        	longa	on
   445 00:00FB: A5 08        	lda	<L16+len_0
   446 00:00FD: 29 FF 00     	and	#$ff
   447 00:0100: F0 03        	beq	L21
   448 00:0102: 82 E3 FF     	brl	L10012
   449                        L21:
   450                        L10011:
  Thu Dec  3 2020 22:25                                                Page 9


   451                        ;	}
   452                        	.line	43
   453                        ;	xEndCH376Cmd( );
   454                        L10009:
   455                        	.line	44
   456 00:0105: 22 xx xx xx  	jsl	~~xEndCH376Cmd
   457                        ;}
   458                        	.line	45
   459                        L22:
   460 00:0109: A5 02        	lda	<L16+2
   461 00:010B: 85 08        	sta	<L16+2+6
   462 00:010D: A5 01        	lda	<L16+1
   463 00:010F: 85 07        	sta	<L16+1+6
   464 00:0111: 2B           	pld
   465 00:0112: 3B           	tsc
   466 00:0113: 18           	clc
   467 00:0114: 69 06 00     	adc	#L16+6
   468 00:0117: 1B           	tcs
   469 00:0118: 6B           	rtl
   470                        	.endblock	45
   471             00000000   L16	equ	0
   472             00000001   L17	equ	1
   473                        	ends
   474                        	efunc
   475                        	.endfunc	45,1,0
   476                        	.line	45
   477                        ;
   478                        ;void	CH376WriteOfsBlock( PUINT8 buf, UINT8 of
                    s, UINT8 len )
   479                        ;{
   480                        	.line	47
   481                        	.line	48
   482                        	code
   483                        	xdef	~~CH376WriteOfsBlock
   484                        	func
   485                        	.function	48
   486                        ~~CH376WriteOfsBlock:
   487                        	longa	on
   488                        	longi	on
   489 00:0119: 3B           	tsc
   490 00:011A: 38           	sec
   491 00:011B: E9 00 00     	sbc	#L23
   492 00:011E: 1B           	tcs
   493 00:011F: 0B           	phd
   494 00:0120: 5B           	tcd
   495             00000004   buf_0	set	4
   496             00000008   ofs_0	set	8
   497             0000000A   len_0	set	10
   498                        	.block	48
   499                        ;	xWriteCH376Cmd( CMD20_WR_OFS_DATA );
   500                        	.sym	buf,4,142,6,32
   501                        	.sym	ofs,8,14,6,8
   502                        	.sym	len,10,14,6,8
   503                        	.line	49
   504 00:0121: F4 2E 00     	pea	#<$2e
   505 00:0124: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
   506                        ;	xWriteCH376Data( ofs );
   507                        	.line	50
  Thu Dec  3 2020 22:25                                                Page 10


   508 00:0128: D4 08        	pei	<L23+ofs_0
   509 00:012A: 22 xx xx xx  	jsl	~~xWriteCH376Data
   510                        ;	xWriteCH376Data( len );
   511                        	.line	51
   512 00:012E: D4 0A        	pei	<L23+len_0
   513 00:0130: 22 xx xx xx  	jsl	~~xWriteCH376Data
   514                        ;	if ( len ) {
   515                        	.line	52
   516 00:0134: A5 0A        	lda	<L23+len_0
   517 00:0136: 29 FF 00     	and	#$ff
   518 00:0139: D0 03        	bne	L26
   519 00:013B: 82 1D 00     	brl	L10013
   520                        L26:
   521                        	.line	52
   522                        ;		do {
   523                        	.line	53
   524                        L10016:
   525                        	.line	53
   526                        ;			xWriteCH376Data( *buf );
   527                        	.line	54
   528 00:013E: A7 04        	lda	[<L23+buf_0]
   529 00:0140: 48           	pha
   530 00:0141: 22 xx xx xx  	jsl	~~xWriteCH376Data
   531                        ;			buf ++;
   532                        	.line	55
   533 00:0145: E6 04        	inc	<L23+buf_0
   534 00:0147: D0 02        	bne	L27
   535 00:0149: E6 06        	inc	<L23+buf_0+2
   536                        L27:
   537                        ;		} while ( -- len );
   538                        	.line	56
   539                        L10014:
   540 00:014B: E2 20        	sep	#$20
   541                        	longa	off
   542 00:014D: C6 0A        	dec	<L23+len_0
   543 00:014F: C2 20        	rep	#$20
   544                        	longa	on
   545 00:0151: A5 0A        	lda	<L23+len_0
   546 00:0153: 29 FF 00     	and	#$ff
   547 00:0156: F0 03        	beq	L28
   548 00:0158: 82 E3 FF     	brl	L10016
   549                        L28:
   550                        L10015:
   551                        ;	}
   552                        	.line	57
   553                        ;	xEndCH376Cmd( );
   554                        L10013:
   555                        	.line	58
   556 00:015B: 22 xx xx xx  	jsl	~~xEndCH376Cmd
   557                        ;}
   558                        	.line	59
   559                        L29:
   560 00:015F: A5 02        	lda	<L23+2
   561 00:0161: 85 0A        	sta	<L23+2+8
   562 00:0163: A5 01        	lda	<L23+1
   563 00:0165: 85 09        	sta	<L23+1+8
   564 00:0167: 2B           	pld
   565 00:0168: 3B           	tsc
  Thu Dec  3 2020 22:25                                                Page 11


   566 00:0169: 18           	clc
   567 00:016A: 69 08 00     	adc	#L23+8
   568 00:016D: 1B           	tcs
   569 00:016E: 6B           	rtl
   570                        	.endblock	59
   571             00000000   L23	equ	0
   572             00000001   L24	equ	1
   573                        	ends
   574                        	efunc
   575                        	.endfunc	59,1,0
   576                        	.line	59
   577                        ;
   578                        ;void	CH376SetFileName( PUINT8 name )
   579                        ;{
   580                        	.line	61
   581                        	.line	62
   582                        	code
   583                        	xdef	~~CH376SetFileName
   584                        	func
   585                        	.function	62
   586                        ~~CH376SetFileName:
   587                        	longa	on
   588                        	longi	on
   589 00:016F: 3B           	tsc
   590 00:0170: 38           	sec
   591 00:0171: E9 0E 00     	sbc	#L30
   592 00:0174: 1B           	tcs
   593 00:0175: 0B           	phd
   594 00:0176: 5B           	tcd
   595             00000004   name_0	set	4
   596                        	.block	62
   597                        ;/*	UINT8	i;*/
   598                        ;	UINT8	c;
   599                        ;#ifndef	DEF_IC_V43_U
   600                        ;	UINT8	s;
   601                        ;	xWriteCH376Cmd( CMD01_GET_IC_VER );
   602             00000000   c_1	set	0
   603             00000001   s_1	set	1
   604                        	.sym	c,0,14,1,8
   605                        	.sym	s,1,14,1,8
   606                        	.sym	name,4,142,6,32
   607                        	.line	67
   608 00:0177: F4 01 00     	pea	#<$1
   609 00:017A: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
   610                        ;	if ( xReadCH376Data( ) < 0x43 ) {
   611                        	.line	68
   612 00:017E: 22 xx xx xx  	jsl	~~xReadCH376Data
   613 00:0182: E2 20        	sep	#$20
   614                        	longa	off
   615 00:0184: 85 01        	sta	<R0
   616 00:0186: C2 20        	rep	#$20
   617                        	longa	on
   618 00:0188: E2 20        	sep	#$20
   619                        	longa	off
   620 00:018A: A5 01        	lda	<R0
   621 00:018C: C9 43        	cmp	#<$43
   622 00:018E: C2 20        	rep	#$20
   623                        	longa	on
  Thu Dec  3 2020 22:25                                                Page 12


   624 00:0190: 90 03        	bcc	L33
   625 00:0192: 82 D6 00     	brl	L10017
   626                        L33:
   627                        	.line	68
   628                        ;		if ( CH376ReadVar8( VAR_DISK_STATUS ) < 
                    DEF_DISK_READY ) {
   629                        	.line	69
   630 00:0195: F4 2B 00     	pea	#<$2b
   631 00:0198: 22 xx xx xx  	jsl	~~CH376ReadVar8
   632 00:019C: E2 20        	sep	#$20
   633                        	longa	off
   634 00:019E: 85 01        	sta	<R0
   635 00:01A0: C2 20        	rep	#$20
   636                        	longa	on
   637 00:01A2: E2 20        	sep	#$20
   638                        	longa	off
   639 00:01A4: A5 01        	lda	<R0
   640 00:01A6: C9 10        	cmp	#<$10
   641 00:01A8: C2 20        	rep	#$20
   642                        	longa	on
   643 00:01AA: 90 03        	bcc	L34
   644 00:01AC: 82 BC 00     	brl	L10018
   645                        L34:
   646                        	.line	69
   647                        ;			xWriteCH376Cmd( CMD10_SET_FILE_N
                    AME );
   648                        	.line	70
   649 00:01AF: F4 2F 00     	pea	#<$2f
   650 00:01B2: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
   651                        ;			xWriteCH376Data( 0 );
   652                        	.line	71
   653 00:01B6: F4 00 00     	pea	#<$0
   654 00:01B9: 22 xx xx xx  	jsl	~~xWriteCH376Data
   655                        ;			s = CH376SendCmdWaitInt( CMD0H_F
                    ILE_OPEN );
   656                        	.line	72
   657 00:01BD: F4 32 00     	pea	#<$32
   658 00:01C0: 22 xx xx xx  	jsl	~~CH376SendCmdWaitInt
   659 00:01C4: E2 20        	sep	#$20
   660                        	longa	off
   661 00:01C6: 85 0E        	sta	<L31+s_1
   662 00:01C8: C2 20        	rep	#$20
   663                        	longa	on
   664                        ;			if ( s == USB_INT_SUCCESS ) {
   665                        	.line	73
   666 00:01CA: E2 20        	sep	#$20
   667                        	longa	off
   668 00:01CC: A5 0E        	lda	<L31+s_1
   669 00:01CE: C9 14        	cmp	#<$14
   670 00:01D0: C2 20        	rep	#$20
   671                        	longa	on
   672 00:01D2: F0 03        	beq	L35
   673 00:01D4: 82 94 00     	brl	L10019
   674                        L35:
   675                        	.line	73
   676                        ;				s = CH376ReadVar8( 0xCF 
                    );
   677                        	.line	74
  Thu Dec  3 2020 22:25                                                Page 13


   678 00:01D7: F4 CF 00     	pea	#<$cf
   679 00:01DA: 22 xx xx xx  	jsl	~~CH376ReadVar8
   680 00:01DE: E2 20        	sep	#$20
   681                        	longa	off
   682 00:01E0: 85 0E        	sta	<L31+s_1
   683 00:01E2: C2 20        	rep	#$20
   684                        	longa	on
   685                        ;				if ( s ) {
   686                        	.line	75
   687 00:01E4: A5 0E        	lda	<L31+s_1
   688 00:01E6: 29 FF 00     	and	#$ff
   689 00:01E9: D0 03        	bne	L36
   690 00:01EB: 82 7D 00     	brl	L10020
   691                        L36:
   692                        	.line	75
   693                        ;					CH376WriteVar32(
                     0x4C, CH376ReadVar32( 0x4C ) + ( (UINT16)s << 8 ) );
   694                        	.line	76
   695 00:01EE: A5 0E        	lda	<L31+s_1
   696 00:01F0: 29 FF 00     	and	#$ff
   697 00:01F3: 85 05        	sta	<R1
   698 00:01F5: A5 05        	lda	<R1
   699 00:01F7: EB           	xba
   700 00:01F8: 29 00 FF     	and	#$ff00
   701 00:01FB: 85 01        	sta	<R0
   702 00:01FD: A5 01        	lda	<R0
   703 00:01FF: 85 01        	sta	<R0
   704 00:0201: 64 03        	stz	<R0+2
   705 00:0203: F4 4C 00     	pea	#<$4c
   706 00:0206: 22 xx xx xx  	jsl	~~CH376ReadVar32
   707 00:020A: 85 05        	sta	<R1
   708 00:020C: 86 07        	stx	<R1+2
   709 00:020E: 18           	clc
   710 00:020F: A5 05        	lda	<R1
   711 00:0211: 65 01        	adc	<R0
   712 00:0213: 85 09        	sta	<R2
   713 00:0215: A5 07        	lda	<R1+2
   714 00:0217: 65 03        	adc	<R0+2
   715 00:0219: 85 0B        	sta	<R2+2
   716 00:021B: D4 0B        	pei	<R2+2
   717 00:021D: D4 09        	pei	<R2
   718 00:021F: F4 4C 00     	pea	#<$4c
   719 00:0222: 22 xx xx xx  	jsl	~~CH376WriteVar32
   720                        ;					CH376WriteVar32(
                     0x50, CH376ReadVar32( 0x50 ) + ( (UINT16)s << 8 ) );
   721                        	.line	77
   722 00:0226: A5 0E        	lda	<L31+s_1
   723 00:0228: 29 FF 00     	and	#$ff
   724 00:022B: 85 05        	sta	<R1
   725 00:022D: A5 05        	lda	<R1
   726 00:022F: EB           	xba
   727 00:0230: 29 00 FF     	and	#$ff00
   728 00:0233: 85 01        	sta	<R0
   729 00:0235: A5 01        	lda	<R0
   730 00:0237: 85 01        	sta	<R0
   731 00:0239: 64 03        	stz	<R0+2
   732 00:023B: F4 50 00     	pea	#<$50
   733 00:023E: 22 xx xx xx  	jsl	~~CH376ReadVar32
  Thu Dec  3 2020 22:25                                                Page 14


   734 00:0242: 85 05        	sta	<R1
   735 00:0244: 86 07        	stx	<R1+2
   736 00:0246: 18           	clc
   737 00:0247: A5 05        	lda	<R1
   738 00:0249: 65 01        	adc	<R0
   739 00:024B: 85 09        	sta	<R2
   740 00:024D: A5 07        	lda	<R1+2
   741 00:024F: 65 03        	adc	<R0+2
   742 00:0251: 85 0B        	sta	<R2+2
   743 00:0253: D4 0B        	pei	<R2+2
   744 00:0255: D4 09        	pei	<R2
   745 00:0257: F4 50 00     	pea	#<$50
   746 00:025A: 22 xx xx xx  	jsl	~~CH376WriteVar32
   747                        ;					CH376WriteVar32(
                     0x70, 0 );
   748                        	.line	78
   749 00:025E: F4 00 00     	pea	#^$0
   750 00:0261: F4 00 00     	pea	#<$0
   751 00:0264: F4 70 00     	pea	#<$70
   752 00:0267: 22 xx xx xx  	jsl	~~CH376WriteVar32
   753                        ;				}
   754                        	.line	79
   755                        ;			}
   756                        L10020:
   757                        	.line	80
   758                        ;		}
   759                        L10019:
   760                        	.line	81
   761                        ;	}
   762                        L10018:
   763                        	.line	82
   764                        ;#endif
   765                        ;	xWriteCH376Cmd( CMD10_SET_FILE_NAME );
   766                        L10017:
   767                        	.line	84
   768 00:026B: F4 2F 00     	pea	#<$2f
   769 00:026E: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
   770                        ;/*	for ( i = MAX_FILE_NAME_LEN; i != 0; -- 
                    i ) {
   771                        ;		c = *name;
   772                        ;		xWriteCH376Data( c );
   773                        ;		if ( c == 0 ) break;
   774                        ;		name ++;
   775                        ;	}*/
   776                        ;	c = *name;
   777                        	.line	91
   778 00:0272: E2 20        	sep	#$20
   779                        	longa	off
   780 00:0274: A7 12        	lda	[<L30+name_0]
   781 00:0276: 85 0D        	sta	<L31+c_1
   782 00:0278: C2 20        	rep	#$20
   783                        	longa	on
   784                        ;	xWriteCH376Data( c );
   785                        	.line	92
   786 00:027A: D4 0D        	pei	<L31+c_1
   787 00:027C: 22 xx xx xx  	jsl	~~xWriteCH376Data
   788                        ;	while ( c ) {
   789                        	.line	93
  Thu Dec  3 2020 22:25                                                Page 15


   790                        L10021:
   791 00:0280: A5 0D        	lda	<L31+c_1
   792 00:0282: 29 FF 00     	and	#$ff
   793 00:0285: D0 03        	bne	L37
   794 00:0287: 82 37 00     	brl	L10022
   795                        L37:
   796                        	.line	93
   797                        ;		name ++;
   798                        	.line	94
   799 00:028A: E6 12        	inc	<L30+name_0
   800 00:028C: D0 02        	bne	L38
   801 00:028E: E6 14        	inc	<L30+name_0+2
   802                        L38:
   803                        ;		c = *name;
   804                        	.line	95
   805 00:0290: E2 20        	sep	#$20
   806                        	longa	off
   807 00:0292: A7 12        	lda	[<L30+name_0]
   808 00:0294: 85 0D        	sta	<L31+c_1
   809 00:0296: C2 20        	rep	#$20
   810                        	longa	on
   811                        ;		if ( c == DEF_SEPAR_CHAR1 || c == DEF_SE
                    PAR_CHAR2 ) c = 0;      					
                    				  				
                    					    			
                    						  		
                    							/*强行将
                    文件名截止 */
   812                        	.line	96
   813 00:0298: E2 20        	sep	#$20
   814                        	longa	off
   815 00:029A: A5 0D        	lda	<L31+c_1
   816 00:029C: C9 5C        	cmp	#<$5c
   817 00:029E: C2 20        	rep	#$20
   818                        	longa	on
   819 00:02A0: D0 03        	bne	L40
   820 00:02A2: 82 0D 00     	brl	L39
   821                        L40:
   822 00:02A5: E2 20        	sep	#$20
   823                        	longa	off
   824 00:02A7: A5 0D        	lda	<L31+c_1
   825 00:02A9: C9 2F        	cmp	#<$2f
   826 00:02AB: C2 20        	rep	#$20
   827                        	longa	on
   828 00:02AD: F0 03        	beq	L41
   829 00:02AF: 82 06 00     	brl	L10023
   830                        L41:
   831                        L39:
   832                        	.line	96
   833 00:02B2: E2 20        	sep	#$20
   834                        	longa	off
   835 00:02B4: 64 0D        	stz	<L31+c_1
   836 00:02B6: C2 20        	rep	#$20
   837                        	longa	on
   838                        ;		xWriteCH376Data( c );
   839                        L10023:
   840                        	.line	97
   841 00:02B8: D4 0D        	pei	<L31+c_1
  Thu Dec  3 2020 22:25                                                Page 16


   842 00:02BA: 22 xx xx xx  	jsl	~~xWriteCH376Data
   843                        ;	}
   844                        	.line	98
   845 00:02BE: 82 BF FF     	brl	L10021
   846                        L10022:
   847                        ;	xEndCH376Cmd( );
   848                        	.line	99
   849 00:02C1: 22 xx xx xx  	jsl	~~xEndCH376Cmd
   850                        ;}
   851                        	.line	100
   852                        L42:
   853 00:02C5: A5 10        	lda	<L30+2
   854 00:02C7: 85 14        	sta	<L30+2+4
   855 00:02C9: A5 0F        	lda	<L30+1
   856 00:02CB: 85 13        	sta	<L30+1+4
   857 00:02CD: 2B           	pld
   858 00:02CE: 3B           	tsc
   859 00:02CF: 18           	clc
   860 00:02D0: 69 12 00     	adc	#L30+4
   861 00:02D3: 1B           	tcs
   862 00:02D4: 6B           	rtl
   863                        	.endblock	100
   864             0000000E   L30	equ	14
   865             0000000D   L31	equ	13
   866                        	ends
   867                        	efunc
   868                        	.endfunc	100,13,14
   869                        	.line	100
   870                        ;
   871                        ;UINT32	CH376Read32bitDat( void )      		
                    							  	
                    								
                        							
                    		  						
                    			/*从CH376芯片读取32位的数据并结束命令 */
   872                        ;{
   873                        	.line	102
   874                        	.line	103
   875                        	code
   876                        	xdef	~~CH376Read32bitDat
   877                        	func
   878                        	.function	103
   879                        ~~CH376Read32bitDat:
   880                        	longa	on
   881                        	longi	on
   882 00:02D5: 3B           	tsc
   883 00:02D6: 38           	sec
   884 00:02D7: E9 18 00     	sbc	#L43
   885 00:02DA: 1B           	tcs
   886 00:02DB: 0B           	phd
   887 00:02DC: 5B           	tcd
   888                        	.block	103
   889                        ;	UINT8	c0, c1, c2, c3;
   890                        ;	c0 = xReadCH376Data( );
   891             00000000   c0_1	set	0
   892             00000001   c1_1	set	1
   893             00000002   c2_1	set	2
   894             00000003   c3_1	set	3
  Thu Dec  3 2020 22:25                                                Page 17


   895                        	.sym	c0,0,14,1,8
   896                        	.sym	c1,1,14,1,8
   897                        	.sym	c2,2,14,1,8
   898                        	.sym	c3,3,14,1,8
   899                        	.line	105
   900 00:02DD: 22 xx xx xx  	jsl	~~xReadCH376Data
   901 00:02E1: E2 20        	sep	#$20
   902                        	longa	off
   903 00:02E3: 85 15        	sta	<L44+c0_1
   904 00:02E5: C2 20        	rep	#$20
   905                        	longa	on
   906                        ;	c1 = xReadCH376Data( );
   907                        	.line	106
   908 00:02E7: 22 xx xx xx  	jsl	~~xReadCH376Data
   909 00:02EB: E2 20        	sep	#$20
   910                        	longa	off
   911 00:02ED: 85 16        	sta	<L44+c1_1
   912 00:02EF: C2 20        	rep	#$20
   913                        	longa	on
   914                        ;	c2 = xReadCH376Data( );
   915                        	.line	107
   916 00:02F1: 22 xx xx xx  	jsl	~~xReadCH376Data
   917 00:02F5: E2 20        	sep	#$20
   918                        	longa	off
   919 00:02F7: 85 17        	sta	<L44+c2_1
   920 00:02F9: C2 20        	rep	#$20
   921                        	longa	on
   922                        ;	c3 = xReadCH376Data( );
   923                        	.line	108
   924 00:02FB: 22 xx xx xx  	jsl	~~xReadCH376Data
   925 00:02FF: E2 20        	sep	#$20
   926                        	longa	off
   927 00:0301: 85 18        	sta	<L44+c3_1
   928 00:0303: C2 20        	rep	#$20
   929                        	longa	on
   930                        ;	xEndCH376Cmd( );
   931                        	.line	109
   932 00:0305: 22 xx xx xx  	jsl	~~xEndCH376Cmd
   933                        ;	return( c0 | (UINT16)c1 << 8 | (UINT32)c2 << 16 
                    | (UINT32)c3 << 24 );
   934                        	.line	110
   935 00:0309: A5 15        	lda	<L44+c0_1
   936 00:030B: 29 FF 00     	and	#$ff
   937 00:030E: 85 01        	sta	<R0
   938 00:0310: A5 16        	lda	<L44+c1_1
   939 00:0312: 29 FF 00     	and	#$ff
   940 00:0315: 85 09        	sta	<R2
   941 00:0317: A5 09        	lda	<R2
   942 00:0319: EB           	xba
   943 00:031A: 29 00 FF     	and	#$ff00
   944 00:031D: 85 05        	sta	<R1
   945 00:031F: A5 05        	lda	<R1
   946 00:0321: 05 01        	ora	<R0
   947 00:0323: 85 09        	sta	<R2
   948 00:0325: A5 09        	lda	<R2
   949 00:0327: 85 01        	sta	<R0
   950 00:0329: 64 03        	stz	<R0+2
   951 00:032B: A5 17        	lda	<L44+c2_1
  Thu Dec  3 2020 22:25                                                Page 18


   952 00:032D: 29 FF 00     	and	#$ff
   953 00:0330: 85 09        	sta	<R2
   954 00:0332: 64 0B        	stz	<R2+2
   955 00:0334: D4 0B        	pei	<R2+2
   956 00:0336: D4 09        	pei	<R2
   957 00:0338: A9 10 00     	lda	#$10
   958                        	xref	~~~lasl
   959 00:033B: 22 xx xx xx  	jsl	~~~lasl
   960 00:033F: 85 05        	sta	<R1
   961 00:0341: 86 07        	stx	<R1+2
   962 00:0343: A5 05        	lda	<R1
   963 00:0345: 05 01        	ora	<R0
   964 00:0347: 85 0D        	sta	<R3
   965 00:0349: A5 07        	lda	<R1+2
   966 00:034B: 05 03        	ora	<R0+2
   967 00:034D: 85 0F        	sta	<R3+2
   968 00:034F: A5 18        	lda	<L44+c3_1
   969 00:0351: 29 FF 00     	and	#$ff
   970 00:0354: 85 05        	sta	<R1
   971 00:0356: 64 07        	stz	<R1+2
   972 00:0358: D4 07        	pei	<R1+2
   973 00:035A: D4 05        	pei	<R1
   974 00:035C: A9 18 00     	lda	#$18
   975                        	xref	~~~lasl
   976 00:035F: 22 xx xx xx  	jsl	~~~lasl
   977 00:0363: 85 01        	sta	<R0
   978 00:0365: 86 03        	stx	<R0+2
   979 00:0367: A5 01        	lda	<R0
   980 00:0369: 05 0D        	ora	<R3
   981 00:036B: 85 11        	sta	<17
   982 00:036D: A5 03        	lda	<R0+2
   983 00:036F: 05 0F        	ora	<R3+2
   984 00:0371: 85 13        	sta	<17+2
   985 00:0373: A6 13        	ldx	<17+2
   986 00:0375: A5 11        	lda	<17
   987                        L46:
   988 00:0377: A8           	tay
   989 00:0378: 2B           	pld
   990 00:0379: 3B           	tsc
   991 00:037A: 18           	clc
   992 00:037B: 69 18 00     	adc	#L43
   993 00:037E: 1B           	tcs
   994 00:037F: 98           	tya
   995 00:0380: 6B           	rtl
   996                        ;}
   997                        	.line	111
   998                        	.endblock	111
   999             00000018   L43	equ	24
  1000             00000015   L44	equ	21
  1001                        	ends
  1002                        	efunc
  1003                        	.endfunc	111,21,24
  1004                        	.line	111
  1005                        ;
  1006                        ;UINT8	CH376ReadVar8( UINT8 var )      	
                    								
                      								
                    	    							
  Thu Dec  3 2020 22:25                                                Page 19


                    		  						
                    			/*读CH376芯片内部的8位变量 */
  1007                        ;{
  1008                        	.line	113
  1009                        	.line	114
  1010                        	code
  1011                        	xdef	~~CH376ReadVar8
  1012                        	func
  1013                        	.function	114
  1014                        ~~CH376ReadVar8:
  1015                        	longa	on
  1016                        	longi	on
  1017 00:0381: 3B           	tsc
  1018 00:0382: 38           	sec
  1019 00:0383: E9 01 00     	sbc	#L47
  1020 00:0386: 1B           	tcs
  1021 00:0387: 0B           	phd
  1022 00:0388: 5B           	tcd
  1023             00000004   var_0	set	4
  1024                        	.block	114
  1025                        ;	UINT8	c0;
  1026                        ;	xWriteCH376Cmd( CMD11_READ_VAR8 );
  1027             00000000   c0_1	set	0
  1028                        	.sym	c0,0,14,1,8
  1029                        	.sym	var,4,14,6,8
  1030                        	.line	116
  1031 00:0389: F4 0A 00     	pea	#<$a
  1032 00:038C: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
  1033                        ;	xWriteCH376Data( var );
  1034                        	.line	117
  1035 00:0390: D4 05        	pei	<L47+var_0
  1036 00:0392: 22 xx xx xx  	jsl	~~xWriteCH376Data
  1037                        ;	c0 = xReadCH376Data( );
  1038                        	.line	118
  1039 00:0396: 22 xx xx xx  	jsl	~~xReadCH376Data
  1040 00:039A: E2 20        	sep	#$20
  1041                        	longa	off
  1042 00:039C: 85 01        	sta	<L48+c0_1
  1043 00:039E: C2 20        	rep	#$20
  1044                        	longa	on
  1045                        ;	xEndCH376Cmd( );
  1046                        	.line	119
  1047 00:03A0: 22 xx xx xx  	jsl	~~xEndCH376Cmd
  1048                        ;	return( c0 );
  1049                        	.line	120
  1050 00:03A4: A5 01        	lda	<L48+c0_1
  1051 00:03A6: 29 FF 00     	and	#$ff
  1052                        L50:
  1053 00:03A9: A8           	tay
  1054 00:03AA: A5 03        	lda	<L47+2
  1055 00:03AC: 85 05        	sta	<L47+2+2
  1056 00:03AE: A5 02        	lda	<L47+1
  1057 00:03B0: 85 04        	sta	<L47+1+2
  1058 00:03B2: 2B           	pld
  1059 00:03B3: 3B           	tsc
  1060 00:03B4: 18           	clc
  1061 00:03B5: 69 03 00     	adc	#L47+2
  1062 00:03B8: 1B           	tcs
  Thu Dec  3 2020 22:25                                                Page 20


  1063 00:03B9: 98           	tya
  1064 00:03BA: 6B           	rtl
  1065                        ;}
  1066                        	.line	121
  1067                        	.endblock	121
  1068             00000001   L47	equ	1
  1069             00000001   L48	equ	1
  1070                        	ends
  1071                        	efunc
  1072                        	.endfunc	121,1,1
  1073                        	.line	121
  1074                        ;
  1075                        ;void	CH376WriteVar8( UINT8 var, UINT8 dat )  
                        							
                    		  						
                    			    					
                    				  				
                    					/*写CH376芯片内部的8位变
                    量 */
  1076                        ;{
  1077                        	.line	123
  1078                        	.line	124
  1079                        	code
  1080                        	xdef	~~CH376WriteVar8
  1081                        	func
  1082                        	.function	124
  1083                        ~~CH376WriteVar8:
  1084                        	longa	on
  1085                        	longi	on
  1086 00:03BB: 3B           	tsc
  1087 00:03BC: 38           	sec
  1088 00:03BD: E9 00 00     	sbc	#L51
  1089 00:03C0: 1B           	tcs
  1090 00:03C1: 0B           	phd
  1091 00:03C2: 5B           	tcd
  1092             00000004   var_0	set	4
  1093             00000006   dat_0	set	6
  1094                        	.block	124
  1095                        ;	xWriteCH376Cmd( CMD20_WRITE_VAR8 );
  1096                        	.sym	var,4,14,6,8
  1097                        	.sym	dat,6,14,6,8
  1098                        	.line	125
  1099 00:03C3: F4 0B 00     	pea	#<$b
  1100 00:03C6: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
  1101                        ;	xWriteCH376Data( var );
  1102                        	.line	126
  1103 00:03CA: D4 04        	pei	<L51+var_0
  1104 00:03CC: 22 xx xx xx  	jsl	~~xWriteCH376Data
  1105                        ;	xWriteCH376Data( dat );
  1106                        	.line	127
  1107 00:03D0: D4 06        	pei	<L51+dat_0
  1108 00:03D2: 22 xx xx xx  	jsl	~~xWriteCH376Data
  1109                        ;	xEndCH376Cmd( );
  1110                        	.line	128
  1111 00:03D6: 22 xx xx xx  	jsl	~~xEndCH376Cmd
  1112                        ;}
  1113                        	.line	129
  1114                        L54:
  Thu Dec  3 2020 22:25                                                Page 21


  1115 00:03DA: A5 02        	lda	<L51+2
  1116 00:03DC: 85 06        	sta	<L51+2+4
  1117 00:03DE: A5 01        	lda	<L51+1
  1118 00:03E0: 85 05        	sta	<L51+1+4
  1119 00:03E2: 2B           	pld
  1120 00:03E3: 3B           	tsc
  1121 00:03E4: 18           	clc
  1122 00:03E5: 69 04 00     	adc	#L51+4
  1123 00:03E8: 1B           	tcs
  1124 00:03E9: 6B           	rtl
  1125                        	.endblock	129
  1126             00000000   L51	equ	0
  1127             00000001   L52	equ	1
  1128                        	ends
  1129                        	efunc
  1130                        	.endfunc	129,1,0
  1131                        	.line	129
  1132                        ;
  1133                        ;UINT32	CH376ReadVar32( UINT8 var )      	
                    								
                      								
                    	    							
                    		  						
                    			/*读CH376芯片内部的32位变量 */
  1134                        ;{
  1135                        	.line	131
  1136                        	.line	132
  1137                        	code
  1138                        	xdef	~~CH376ReadVar32
  1139                        	func
  1140                        	.function	132
  1141                        ~~CH376ReadVar32:
  1142                        	longa	on
  1143                        	longi	on
  1144 00:03EA: 3B           	tsc
  1145 00:03EB: 38           	sec
  1146 00:03EC: E9 04 00     	sbc	#L55
  1147 00:03EF: 1B           	tcs
  1148 00:03F0: 0B           	phd
  1149 00:03F1: 5B           	tcd
  1150             00000004   var_0	set	4
  1151                        	.block	132
  1152                        ;	xWriteCH376Cmd( CMD14_READ_VAR32 );
  1153                        	.sym	var,4,14,6,8
  1154                        	.line	133
  1155 00:03F2: F4 0C 00     	pea	#<$c
  1156 00:03F5: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
  1157                        ;	xWriteCH376Data( var );
  1158                        	.line	134
  1159 00:03F9: D4 08        	pei	<L55+var_0
  1160 00:03FB: 22 xx xx xx  	jsl	~~xWriteCH376Data
  1161                        ;	return( CH376Read32bitDat( ) );      		
                    							  	
                    								
                        							
                    		  						
                    			/*从CH376芯片读取32位的数据并结束命令 */
  1162                        	.line	135
  Thu Dec  3 2020 22:25                                                Page 22


  1163 00:03FF: 22 xx xx xx  	jsl	~~CH376Read32bitDat
  1164 00:0403: 85 01        	sta	<R0
  1165 00:0405: 86 03        	stx	<R0+2
  1166 00:0407: A6 03        	ldx	<R0+2
  1167 00:0409: A5 01        	lda	<R0
  1168                        L58:
  1169 00:040B: A8           	tay
  1170 00:040C: A5 06        	lda	<L55+2
  1171 00:040E: 85 08        	sta	<L55+2+2
  1172 00:0410: A5 05        	lda	<L55+1
  1173 00:0412: 85 07        	sta	<L55+1+2
  1174 00:0414: 2B           	pld
  1175 00:0415: 3B           	tsc
  1176 00:0416: 18           	clc
  1177 00:0417: 69 06 00     	adc	#L55+2
  1178 00:041A: 1B           	tcs
  1179 00:041B: 98           	tya
  1180 00:041C: 6B           	rtl
  1181                        ;}
  1182                        	.line	136
  1183                        	.endblock	136
  1184             00000004   L55	equ	4
  1185             00000005   L56	equ	5
  1186                        	ends
  1187                        	efunc
  1188                        	.endfunc	136,5,4
  1189                        	.line	136
  1190                        ;
  1191                        ;void	CH376WriteVar32( UINT8 var, UINT32 dat )
                          							
                    		  						
                    			    					
                    				  				
                    					/*写CH376芯片内部的32位
                    淞 */
  1192                        ;{
  1193                        	.line	138
  1194                        	.line	139
  1195                        	code
  1196                        	xdef	~~CH376WriteVar32
  1197                        	func
  1198                        	.function	139
  1199                        ~~CH376WriteVar32:
  1200                        	longa	on
  1201                        	longi	on
  1202 00:041D: 3B           	tsc
  1203 00:041E: 38           	sec
  1204 00:041F: E9 04 00     	sbc	#L59
  1205 00:0422: 1B           	tcs
  1206 00:0423: 0B           	phd
  1207 00:0424: 5B           	tcd
  1208             00000004   var_0	set	4
  1209             00000006   dat_0	set	6
  1210                        	.block	139
  1211                        ;	xWriteCH376Cmd( CMD50_WRITE_VAR32 );
  1212                        	.sym	var,4,14,6,8
  1213                        	.sym	dat,6,18,6,32
  1214                        	.line	140
  Thu Dec  3 2020 22:25                                                Page 23


  1215 00:0425: F4 0D 00     	pea	#<$d
  1216 00:0428: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
  1217                        ;	xWriteCH376Data( var );
  1218                        	.line	141
  1219 00:042C: D4 08        	pei	<L59+var_0
  1220 00:042E: 22 xx xx xx  	jsl	~~xWriteCH376Data
  1221                        ;	xWriteCH376Data( (UINT8)dat );
  1222                        	.line	142
  1223 00:0432: D4 0A        	pei	<L59+dat_0
  1224 00:0434: 22 xx xx xx  	jsl	~~xWriteCH376Data
  1225                        ;	xWriteCH376Data( (UINT8)( (UINT16)dat >> 8 ) );
  1226                        	.line	143
  1227 00:0438: A5 0A        	lda	<L59+dat_0
  1228 00:043A: EB           	xba
  1229 00:043B: 29 FF 00     	and	#$00ff
  1230 00:043E: 48           	pha
  1231 00:043F: 22 xx xx xx  	jsl	~~xWriteCH376Data
  1232                        ;	xWriteCH376Data( (UINT8)( dat >> 16 ) );
  1233                        	.line	144
  1234 00:0443: D4 0C        	pei	<L59+dat_0+2
  1235 00:0445: D4 0A        	pei	<L59+dat_0
  1236 00:0447: A9 10 00     	lda	#$10
  1237                        	xref	~~~llsr
  1238 00:044A: 22 xx xx xx  	jsl	~~~llsr
  1239 00:044E: 85 01        	sta	<R0
  1240 00:0450: 86 03        	stx	<R0+2
  1241 00:0452: D4 01        	pei	<R0
  1242 00:0454: 22 xx xx xx  	jsl	~~xWriteCH376Data
  1243                        ;	xWriteCH376Data( (UINT8)( dat >> 24 ) );
  1244                        	.line	145
  1245 00:0458: D4 0C        	pei	<L59+dat_0+2
  1246 00:045A: D4 0A        	pei	<L59+dat_0
  1247 00:045C: A9 18 00     	lda	#$18
  1248                        	xref	~~~llsr
  1249 00:045F: 22 xx xx xx  	jsl	~~~llsr
  1250 00:0463: 85 01        	sta	<R0
  1251 00:0465: 86 03        	stx	<R0+2
  1252 00:0467: D4 01        	pei	<R0
  1253 00:0469: 22 xx xx xx  	jsl	~~xWriteCH376Data
  1254                        ;	xEndCH376Cmd( );
  1255                        	.line	146
  1256 00:046D: 22 xx xx xx  	jsl	~~xEndCH376Cmd
  1257                        ;}
  1258                        	.line	147
  1259                        L62:
  1260 00:0471: A5 06        	lda	<L59+2
  1261 00:0473: 85 0C        	sta	<L59+2+6
  1262 00:0475: A5 05        	lda	<L59+1
  1263 00:0477: 85 0B        	sta	<L59+1+6
  1264 00:0479: 2B           	pld
  1265 00:047A: 3B           	tsc
  1266 00:047B: 18           	clc
  1267 00:047C: 69 0A 00     	adc	#L59+6
  1268 00:047F: 1B           	tcs
  1269 00:0480: 6B           	rtl
  1270                        	.endblock	147
  1271             00000004   L59	equ	4
  1272             00000005   L60	equ	5
  Thu Dec  3 2020 22:25                                                Page 24


  1273                        	ends
  1274                        	efunc
  1275                        	.endfunc	147,5,4
  1276                        	.line	147
  1277                        ;
  1278                        ;void	CH376EndDirInfo( void )      		
                    							  	
                    								
                        							
                    		  						
                    			/*在调用CH376DirInfoRead获取FAT_DIR_INFO
                    结构之后应该通知CH376结束 */
  1279                        ;{
  1280                        	.line	149
  1281                        	.line	150
  1282                        	code
  1283                        	xdef	~~CH376EndDirInfo
  1284                        	func
  1285                        	.function	150
  1286                        ~~CH376EndDirInfo:
  1287                        	longa	on
  1288                        	longi	on
  1289 00:0481: 3B           	tsc
  1290 00:0482: 38           	sec
  1291 00:0483: E9 00 00     	sbc	#L63
  1292 00:0486: 1B           	tcs
  1293 00:0487: 0B           	phd
  1294 00:0488: 5B           	tcd
  1295                        	.block	150
  1296                        ;	CH376WriteVar8( 0x0D, 0x00 );
  1297                        	.line	151
  1298 00:0489: F4 00 00     	pea	#<$0
  1299 00:048C: F4 0D 00     	pea	#<$d
  1300 00:048F: 22 xx xx xx  	jsl	~~CH376WriteVar8
  1301                        ;}
  1302                        	.line	152
  1303                        L66:
  1304 00:0493: 2B           	pld
  1305 00:0494: 3B           	tsc
  1306 00:0495: 18           	clc
  1307 00:0496: 69 00 00     	adc	#L63
  1308 00:0499: 1B           	tcs
  1309 00:049A: 6B           	rtl
  1310                        	.endblock	152
  1311             00000000   L63	equ	0
  1312             00000001   L64	equ	1
  1313                        	ends
  1314                        	efunc
  1315                        	.endfunc	152,1,0
  1316                        	.line	152
  1317                        ;
  1318                        ;UINT32	CH376GetFileSize( void )     		
                    							  	
                    								
                         							
                    		  						
                    			/*读取当前文件长度 */
  1319                        ;{
  Thu Dec  3 2020 22:25                                                Page 25


  1320                        	.line	154
  1321                        	.line	155
  1322                        	code
  1323                        	xdef	~~CH376GetFileSize
  1324                        	func
  1325                        	.function	155
  1326                        ~~CH376GetFileSize:
  1327                        	longa	on
  1328                        	longi	on
  1329 00:049B: 3B           	tsc
  1330 00:049C: 38           	sec
  1331 00:049D: E9 04 00     	sbc	#L67
  1332 00:04A0: 1B           	tcs
  1333 00:04A1: 0B           	phd
  1334 00:04A2: 5B           	tcd
  1335                        	.block	155
  1336                        ;	return( CH376ReadVar32( VAR_FILE_SIZE ) );
  1337                        	.line	156
  1338 00:04A3: F4 68 00     	pea	#<$68
  1339 00:04A6: 22 xx xx xx  	jsl	~~CH376ReadVar32
  1340 00:04AA: 85 01        	sta	<R0
  1341 00:04AC: 86 03        	stx	<R0+2
  1342 00:04AE: A6 03        	ldx	<R0+2
  1343 00:04B0: A5 01        	lda	<R0
  1344                        L70:
  1345 00:04B2: A8           	tay
  1346 00:04B3: 2B           	pld
  1347 00:04B4: 3B           	tsc
  1348 00:04B5: 18           	clc
  1349 00:04B6: 69 04 00     	adc	#L67
  1350 00:04B9: 1B           	tcs
  1351 00:04BA: 98           	tya
  1352 00:04BB: 6B           	rtl
  1353                        ;}
  1354                        	.line	157
  1355                        	.endblock	157
  1356             00000004   L67	equ	4
  1357             00000005   L68	equ	5
  1358                        	ends
  1359                        	efunc
  1360                        	.endfunc	157,5,4
  1361                        	.line	157
  1362                        ;
  1363                        ;UINT8	CH376GetDiskStatus( void )      	
                    								
                      								
                    	    							
                    		  						
                    			/*获取磁盘和文件系统的工作状态 */
  1364                        ;{
  1365                        	.line	159
  1366                        	.line	160
  1367                        	code
  1368                        	xdef	~~CH376GetDiskStatus
  1369                        	func
  1370                        	.function	160
  1371                        ~~CH376GetDiskStatus:
  1372                        	longa	on
  Thu Dec  3 2020 22:25                                                Page 26


  1373                        	longi	on
  1374 00:04BC: 3B           	tsc
  1375 00:04BD: 38           	sec
  1376 00:04BE: E9 04 00     	sbc	#L71
  1377 00:04C1: 1B           	tcs
  1378 00:04C2: 0B           	phd
  1379 00:04C3: 5B           	tcd
  1380                        	.block	160
  1381                        ;	return( CH376ReadVar8( VAR_DISK_STATUS ) );
  1382                        	.line	161
  1383 00:04C4: F4 2B 00     	pea	#<$2b
  1384 00:04C7: 22 xx xx xx  	jsl	~~CH376ReadVar8
  1385 00:04CB: E2 20        	sep	#$20
  1386                        	longa	off
  1387 00:04CD: 85 01        	sta	<R0
  1388 00:04CF: C2 20        	rep	#$20
  1389                        	longa	on
  1390 00:04D1: A5 01        	lda	<R0
  1391 00:04D3: 29 FF 00     	and	#$ff
  1392                        L74:
  1393 00:04D6: A8           	tay
  1394 00:04D7: 2B           	pld
  1395 00:04D8: 3B           	tsc
  1396 00:04D9: 18           	clc
  1397 00:04DA: 69 04 00     	adc	#L71
  1398 00:04DD: 1B           	tcs
  1399 00:04DE: 98           	tya
  1400 00:04DF: 6B           	rtl
  1401                        ;}
  1402                        	.line	162
  1403                        	.endblock	162
  1404             00000004   L71	equ	4
  1405             00000005   L72	equ	5
  1406                        	ends
  1407                        	efunc
  1408                        	.endfunc	162,5,4
  1409                        	.line	162
  1410                        ;
  1411                        ;UINT8	CH376GetIntStatus( void )      		
                    							  	
                    								
                        							
                    		  						
                    			/*获取中断状态并取消中断请求 */
  1412                        ;{
  1413                        	.line	164
  1414                        	.line	165
  1415                        	code
  1416                        	xdef	~~CH376GetIntStatus
  1417                        	func
  1418                        	.function	165
  1419                        ~~CH376GetIntStatus:
  1420                        	longa	on
  1421                        	longi	on
  1422 00:04E0: 3B           	tsc
  1423 00:04E1: 38           	sec
  1424 00:04E2: E9 01 00     	sbc	#L75
  1425 00:04E5: 1B           	tcs
  Thu Dec  3 2020 22:25                                                Page 27


  1426 00:04E6: 0B           	phd
  1427 00:04E7: 5B           	tcd
  1428                        	.block	165
  1429                        ;	UINT8	s;
  1430                        ;	xWriteCH376Cmd( CMD01_GET_STATUS );
  1431             00000000   s_1	set	0
  1432                        	.sym	s,0,14,1,8
  1433                        	.line	167
  1434 00:04E8: F4 22 00     	pea	#<$22
  1435 00:04EB: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
  1436                        ;	s = xReadCH376Data( );
  1437                        	.line	168
  1438 00:04EF: 22 xx xx xx  	jsl	~~xReadCH376Data
  1439 00:04F3: E2 20        	sep	#$20
  1440                        	longa	off
  1441 00:04F5: 85 01        	sta	<L76+s_1
  1442 00:04F7: C2 20        	rep	#$20
  1443                        	longa	on
  1444                        ;	xEndCH376Cmd( );
  1445                        	.line	169
  1446 00:04F9: 22 xx xx xx  	jsl	~~xEndCH376Cmd
  1447                        ;	return( s );
  1448                        	.line	170
  1449 00:04FD: A5 01        	lda	<L76+s_1
  1450 00:04FF: 29 FF 00     	and	#$ff
  1451                        L78:
  1452 00:0502: A8           	tay
  1453 00:0503: 2B           	pld
  1454 00:0504: 3B           	tsc
  1455 00:0505: 18           	clc
  1456 00:0506: 69 01 00     	adc	#L75
  1457 00:0509: 1B           	tcs
  1458 00:050A: 98           	tya
  1459 00:050B: 6B           	rtl
  1460                        ;}
  1461                        	.line	171
  1462                        	.endblock	171
  1463             00000001   L75	equ	1
  1464             00000001   L76	equ	1
  1465                        	ends
  1466                        	efunc
  1467                        	.endfunc	171,1,1
  1468                        	.line	171
  1469                        ;
  1470                        ;#ifndef	NO_DEFAULT_CH376_INT
  1471                        ;UINT8	Wait376Interrupt( void )     		
                    							  	
                    								
                         							
                    		  						
                    			/*等待CH376中断(INT#低电平)，返回中断状
                    码, 超时则返回ERR_USB_UNKNOWN */
  1472                        ;{
  1473                        	.line	174
  1474                        	.line	175
  1475                        	code
  1476                        	xdef	~~Wait376Interrupt
  1477                        	func
  Thu Dec  3 2020 22:25                                                Page 28


  1478                        	.function	175
  1479                        ~~Wait376Interrupt:
  1480                        	longa	on
  1481                        	longi	on
  1482 00:050C: 3B           	tsc
  1483 00:050D: 38           	sec
  1484 00:050E: E9 08 00     	sbc	#L79
  1485 00:0511: 1B           	tcs
  1486 00:0512: 0B           	phd
  1487 00:0513: 5B           	tcd
  1488                        	.block	175
  1489                        ;#ifdef	DEF_INT_TIMEOUT
  1490                        ;#if		DEF_INT_TIMEOUT < 1
  1491                        ;	while ( Query376Interrupt( ) == FALSE );      	
                    								
                      								
                    	    							
                    		  						
                    			/*一直等中断 */
  1492                        ;	return( CH376GetIntStatus( ) );      		
                    							  	
                    								
                        							
                    		  						
                    			/*检测到中断 */
  1493                        ;#else
  1494                        ;	UINT32	i;
  1495                        ;	for ( i = 0; i < DEF_INT_TIMEOUT; i ++ ) {      
                    								
                    	  							
                    		    						
                    			  					
                    				/*计数防止超时 */
  1496                        ;		if ( Query376Interrupt( ) ) return( CH37
                    6GetIntStatus( ) );      					
                    				  				
                    					    			
                    						  		
                    							/*检测到
                    中断 */
  1497                        ;	}
  1498                        ;	return( ERR_USB_UNKNOWN );      		
                    							  	
                    								
                        							
                    		  						
                    			/*不应该发生的情况 */
  1499                        ;#endif
  1500                        ;#else
  1501                        ;	UINT32	i;
  1502                        ;	for ( i = 0; i < 5000000; i ++ ) {      	
                    								
                      								
                    	    							
                    		  						
                    			/*计数防止超时,默认的超时时间,与单片机主
                    频有关 */
  1503             00000000   i_1	set	0
  Thu Dec  3 2020 22:25                                                Page 29


  1504                        	.sym	i,0,18,1,32
  1505                        	.line	189
  1506 00:0514: 64 05        	stz	<L80+i_1
  1507 00:0516: 64 07        	stz	<L80+i_1+2
  1508                        L10026:
  1509                        	.line	189
  1510                        ;		if ( Query376Interrupt( ) ) return( CH37
                    6GetIntStatus( ) );      					
                    				  				
                    					    			
                    						  		
                    							/*检测到
                    中断 */
  1511                        	.line	190
  1512 00:0518: 22 xx xx xx  	jsl	~~Query376Interrupt
  1513 00:051C: 29 FF 00     	and	#$ff
  1514 00:051F: D0 03        	bne	L82
  1515 00:0521: 82 19 00     	brl	L10027
  1516                        L82:
  1517                        	.line	190
  1518 00:0524: 22 xx xx xx  	jsl	~~CH376GetIntStatus
  1519 00:0528: E2 20        	sep	#$20
  1520                        	longa	off
  1521 00:052A: 85 01        	sta	<R0
  1522 00:052C: C2 20        	rep	#$20
  1523                        	longa	on
  1524 00:052E: A5 01        	lda	<R0
  1525 00:0530: 29 FF 00     	and	#$ff
  1526                        L83:
  1527 00:0533: A8           	tay
  1528 00:0534: 2B           	pld
  1529 00:0535: 3B           	tsc
  1530 00:0536: 18           	clc
  1531 00:0537: 69 08 00     	adc	#L79
  1532 00:053A: 1B           	tcs
  1533 00:053B: 98           	tya
  1534 00:053C: 6B           	rtl
  1535                        ;	}
  1536                        L10027:
  1537                        	.line	191
  1538                        L10024:
  1539 00:053D: E6 05        	inc	<L80+i_1
  1540 00:053F: D0 02        	bne	L84
  1541 00:0541: E6 07        	inc	<L80+i_1+2
  1542                        L84:
  1543 00:0543: A5 05        	lda	<L80+i_1
  1544 00:0545: C9 40 4B     	cmp	#<$4c4b40
  1545 00:0548: A5 07        	lda	<L80+i_1+2
  1546 00:054A: E9 4C 00     	sbc	#^$4c4b40
  1547 00:054D: B0 03        	bcs	L85
  1548 00:054F: 82 C6 FF     	brl	L10026
  1549                        L85:
  1550                        L10025:
  1551                        ;	return( ERR_USB_UNKNOWN );
  1552                        	.line	192
  1553 00:0552: A9 FA 00     	lda	#$fa
  1554 00:0555: 82 DB FF     	brl	L83
  1555                        ;#endif
  Thu Dec  3 2020 22:25                                                Page 30


  1556                        ;}
  1557                        	.line	194
  1558                        	.endblock	194
  1559             00000008   L79	equ	8
  1560             00000005   L80	equ	5
  1561                        	ends
  1562                        	efunc
  1563                        	.endfunc	194,5,8
  1564                        	.line	194
  1565                        ;#endif
  1566                        ;
  1567                        ;UINT8	CH376SendCmdWaitInt( UINT8 mCmd )
  1568                        ;{
  1569                        	.line	197
  1570                        	.line	198
  1571                        	code
  1572                        	xdef	~~CH376SendCmdWaitInt
  1573                        	func
  1574                        	.function	198
  1575                        ~~CH376SendCmdWaitInt:
  1576                        	longa	on
  1577                        	longi	on
  1578 00:0558: 3B           	tsc
  1579 00:0559: 38           	sec
  1580 00:055A: E9 04 00     	sbc	#L86
  1581 00:055D: 1B           	tcs
  1582 00:055E: 0B           	phd
  1583 00:055F: 5B           	tcd
  1584             00000004   mCmd_0	set	4
  1585                        	.block	198
  1586                        ;	xWriteCH376Cmd( mCmd );
  1587                        	.sym	mCmd,4,14,6,8
  1588                        	.line	199
  1589 00:0560: D4 08        	pei	<L86+mCmd_0
  1590 00:0562: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
  1591                        ;	xEndCH376Cmd( );
  1592                        	.line	200
  1593 00:0566: 22 xx xx xx  	jsl	~~xEndCH376Cmd
  1594                        ;	return( Wait376Interrupt( ) );
  1595                        	.line	201
  1596 00:056A: 22 xx xx xx  	jsl	~~Wait376Interrupt
  1597 00:056E: E2 20        	sep	#$20
  1598                        	longa	off
  1599 00:0570: 85 01        	sta	<R0
  1600 00:0572: C2 20        	rep	#$20
  1601                        	longa	on
  1602 00:0574: A5 01        	lda	<R0
  1603 00:0576: 29 FF 00     	and	#$ff
  1604                        L89:
  1605 00:0579: A8           	tay
  1606 00:057A: A5 06        	lda	<L86+2
  1607 00:057C: 85 08        	sta	<L86+2+2
  1608 00:057E: A5 05        	lda	<L86+1
  1609 00:0580: 85 07        	sta	<L86+1+2
  1610 00:0582: 2B           	pld
  1611 00:0583: 3B           	tsc
  1612 00:0584: 18           	clc
  1613 00:0585: 69 06 00     	adc	#L86+2
  Thu Dec  3 2020 22:25                                                Page 31


  1614 00:0588: 1B           	tcs
  1615 00:0589: 98           	tya
  1616 00:058A: 6B           	rtl
  1617                        ;}
  1618                        	.line	202
  1619                        	.endblock	202
  1620             00000004   L86	equ	4
  1621             00000005   L87	equ	5
  1622                        	ends
  1623                        	efunc
  1624                        	.endfunc	202,5,4
  1625                        	.line	202
  1626                        ;
  1627                        ;UINT8	CH376SendCmdDatWaitInt( UINT8 mCmd, UINT
                    8 mDat )      						
                    			  					
                    				    				
                    					  			
                    						/*发出命令码和一
                    字节数据后,等待中断 */
  1628                        ;{
  1629                        	.line	204
  1630                        	.line	205
  1631                        	code
  1632                        	xdef	~~CH376SendCmdDatWaitInt
  1633                        	func
  1634                        	.function	205
  1635                        ~~CH376SendCmdDatWaitInt:
  1636                        	longa	on
  1637                        	longi	on
  1638 00:058B: 3B           	tsc
  1639 00:058C: 38           	sec
  1640 00:058D: E9 04 00     	sbc	#L90
  1641 00:0590: 1B           	tcs
  1642 00:0591: 0B           	phd
  1643 00:0592: 5B           	tcd
  1644             00000004   mCmd_0	set	4
  1645             00000006   mDat_0	set	6
  1646                        	.block	205
  1647                        ;	xWriteCH376Cmd( mCmd );
  1648                        	.sym	mCmd,4,14,6,8
  1649                        	.sym	mDat,6,14,6,8
  1650                        	.line	206
  1651 00:0593: D4 08        	pei	<L90+mCmd_0
  1652 00:0595: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
  1653                        ;	xWriteCH376Data( mDat );
  1654                        	.line	207
  1655 00:0599: D4 0A        	pei	<L90+mDat_0
  1656 00:059B: 22 xx xx xx  	jsl	~~xWriteCH376Data
  1657                        ;	xEndCH376Cmd( );
  1658                        	.line	208
  1659 00:059F: 22 xx xx xx  	jsl	~~xEndCH376Cmd
  1660                        ;	return( Wait376Interrupt( ) );
  1661                        	.line	209
  1662 00:05A3: 22 xx xx xx  	jsl	~~Wait376Interrupt
  1663 00:05A7: E2 20        	sep	#$20
  1664                        	longa	off
  1665 00:05A9: 85 01        	sta	<R0
  Thu Dec  3 2020 22:25                                                Page 32


  1666 00:05AB: C2 20        	rep	#$20
  1667                        	longa	on
  1668 00:05AD: A5 01        	lda	<R0
  1669 00:05AF: 29 FF 00     	and	#$ff
  1670                        L93:
  1671 00:05B2: A8           	tay
  1672 00:05B3: A5 06        	lda	<L90+2
  1673 00:05B5: 85 0A        	sta	<L90+2+4
  1674 00:05B7: A5 05        	lda	<L90+1
  1675 00:05B9: 85 09        	sta	<L90+1+4
  1676 00:05BB: 2B           	pld
  1677 00:05BC: 3B           	tsc
  1678 00:05BD: 18           	clc
  1679 00:05BE: 69 08 00     	adc	#L90+4
  1680 00:05C1: 1B           	tcs
  1681 00:05C2: 98           	tya
  1682 00:05C3: 6B           	rtl
  1683                        ;}
  1684                        	.line	210
  1685                        	.endblock	210
  1686             00000004   L90	equ	4
  1687             00000005   L91	equ	5
  1688                        	ends
  1689                        	efunc
  1690                        	.endfunc	210,5,4
  1691                        	.line	210
  1692                        ;
  1693                        ;UINT8	CH376DiskReqSense( void )      		
                    							  	
                    								
                        							
                    		  						
                    			/*检查USB存储器错误 */
  1694                        ;{
  1695                        	.line	212
  1696                        	.line	213
  1697                        	code
  1698                        	xdef	~~CH376DiskReqSense
  1699                        	func
  1700                        	.function	213
  1701                        ~~CH376DiskReqSense:
  1702                        	longa	on
  1703                        	longi	on
  1704 00:05C4: 3B           	tsc
  1705 00:05C5: 38           	sec
  1706 00:05C6: E9 01 00     	sbc	#L94
  1707 00:05C9: 1B           	tcs
  1708 00:05CA: 0B           	phd
  1709 00:05CB: 5B           	tcd
  1710                        	.block	213
  1711                        ;	UINT8	s;
  1712                        ;	mDelaymS( 5 );
  1713             00000000   s_1	set	0
  1714                        	.sym	s,0,14,1,8
  1715                        	.line	215
  1716 00:05CC: F4 05 00     	pea	#<$5
  1717 00:05CF: 22 xx xx xx  	jsl	~~mDelaymS
  1718                        ;	s = CH376SendCmdWaitInt( CMD0H_DISK_R_SENSE );
  Thu Dec  3 2020 22:25                                                Page 33


  1719                        	.line	216
  1720 00:05D3: F4 5A 00     	pea	#<$5a
  1721 00:05D6: 22 xx xx xx  	jsl	~~CH376SendCmdWaitInt
  1722 00:05DA: E2 20        	sep	#$20
  1723                        	longa	off
  1724 00:05DC: 85 01        	sta	<L95+s_1
  1725 00:05DE: C2 20        	rep	#$20
  1726                        	longa	on
  1727                        ;	mDelaymS( 5 );
  1728                        	.line	217
  1729 00:05E0: F4 05 00     	pea	#<$5
  1730 00:05E3: 22 xx xx xx  	jsl	~~mDelaymS
  1731                        ;	return( s );
  1732                        	.line	218
  1733 00:05E7: A5 01        	lda	<L95+s_1
  1734 00:05E9: 29 FF 00     	and	#$ff
  1735                        L97:
  1736 00:05EC: A8           	tay
  1737 00:05ED: 2B           	pld
  1738 00:05EE: 3B           	tsc
  1739 00:05EF: 18           	clc
  1740 00:05F0: 69 01 00     	adc	#L94
  1741 00:05F3: 1B           	tcs
  1742 00:05F4: 98           	tya
  1743 00:05F5: 6B           	rtl
  1744                        ;}
  1745                        	.line	219
  1746                        	.endblock	219
  1747             00000001   L94	equ	1
  1748             00000001   L95	equ	1
  1749                        	ends
  1750                        	efunc
  1751                        	.endfunc	219,1,1
  1752                        	.line	219
  1753                        ;
  1754                        ;UINT8	CH376DiskConnect( void )      		
                    							  	
                    								
                        							
                    		  						
                    			/*检查U盘是否连接,不支持SD卡 */
  1755                        ;{
  1756                        	.line	221
  1757                        	.line	222
  1758                        	code
  1759                        	xdef	~~CH376DiskConnect
  1760                        	func
  1761                        	.function	222
  1762                        ~~CH376DiskConnect:
  1763                        	longa	on
  1764                        	longi	on
  1765 00:05F6: 3B           	tsc
  1766 00:05F7: 38           	sec
  1767 00:05F8: E9 04 00     	sbc	#L98
  1768 00:05FB: 1B           	tcs
  1769 00:05FC: 0B           	phd
  1770 00:05FD: 5B           	tcd
  1771                        	.block	222
  Thu Dec  3 2020 22:25                                                Page 34


  1772                        ;	if ( Query376Interrupt( ) ) CH376GetIntStatus( )
                    ;      							
                    		  						
                    			    					
                    				  				
                    					/*检测到中断 */
  1773                        	.line	223
  1774 00:05FE: 22 xx xx xx  	jsl	~~Query376Interrupt
  1775 00:0602: 29 FF 00     	and	#$ff
  1776 00:0605: D0 03        	bne	L101
  1777 00:0607: 82 04 00     	brl	L10028
  1778                        L101:
  1779                        	.line	223
  1780 00:060A: 22 xx xx xx  	jsl	~~CH376GetIntStatus
  1781                        ;	return( CH376SendCmdWaitInt( CMD0H_DISK_CONNECT 
                    ) );
  1782                        L10028:
  1783                        	.line	224
  1784 00:060E: F4 30 00     	pea	#<$30
  1785 00:0611: 22 xx xx xx  	jsl	~~CH376SendCmdWaitInt
  1786 00:0615: E2 20        	sep	#$20
  1787                        	longa	off
  1788 00:0617: 85 01        	sta	<R0
  1789 00:0619: C2 20        	rep	#$20
  1790                        	longa	on
  1791 00:061B: A5 01        	lda	<R0
  1792 00:061D: 29 FF 00     	and	#$ff
  1793                        L102:
  1794 00:0620: A8           	tay
  1795 00:0621: 2B           	pld
  1796 00:0622: 3B           	tsc
  1797 00:0623: 18           	clc
  1798 00:0624: 69 04 00     	adc	#L98
  1799 00:0627: 1B           	tcs
  1800 00:0628: 98           	tya
  1801 00:0629: 6B           	rtl
  1802                        ;}
  1803                        	.line	225
  1804                        	.endblock	225
  1805             00000004   L98	equ	4
  1806             00000005   L99	equ	5
  1807                        	ends
  1808                        	efunc
  1809                        	.endfunc	225,5,4
  1810                        	.line	225
  1811                        ;
  1812                        ;UINT8	CH376DiskMount( void )      		
                    							  	
                    								
                        							
                    		  						
                    			/*初始化磁盘并测试磁盘是否就绪 */
  1813                        ;{
  1814                        	.line	227
  1815                        	.line	228
  1816                        	code
  1817                        	xdef	~~CH376DiskMount
  1818                        	func
  Thu Dec  3 2020 22:25                                                Page 35


  1819                        	.function	228
  1820                        ~~CH376DiskMount:
  1821                        	longa	on
  1822                        	longi	on
  1823 00:062A: 3B           	tsc
  1824 00:062B: 38           	sec
  1825 00:062C: E9 04 00     	sbc	#L103
  1826 00:062F: 1B           	tcs
  1827 00:0630: 0B           	phd
  1828 00:0631: 5B           	tcd
  1829                        	.block	228
  1830                        ;	return( CH376SendCmdWaitInt( CMD0H_DISK_MOUNT ) 
                    );
  1831                        	.line	229
  1832 00:0632: F4 31 00     	pea	#<$31
  1833 00:0635: 22 xx xx xx  	jsl	~~CH376SendCmdWaitInt
  1834 00:0639: E2 20        	sep	#$20
  1835                        	longa	off
  1836 00:063B: 85 01        	sta	<R0
  1837 00:063D: C2 20        	rep	#$20
  1838                        	longa	on
  1839 00:063F: A5 01        	lda	<R0
  1840 00:0641: 29 FF 00     	and	#$ff
  1841                        L106:
  1842 00:0644: A8           	tay
  1843 00:0645: 2B           	pld
  1844 00:0646: 3B           	tsc
  1845 00:0647: 18           	clc
  1846 00:0648: 69 04 00     	adc	#L103
  1847 00:064B: 1B           	tcs
  1848 00:064C: 98           	tya
  1849 00:064D: 6B           	rtl
  1850                        ;}
  1851                        	.line	230
  1852                        	.endblock	230
  1853             00000004   L103	equ	4
  1854             00000005   L104	equ	5
  1855                        	ends
  1856                        	efunc
  1857                        	.endfunc	230,5,4
  1858                        	.line	230
  1859                        ;
  1860                        ;UINT8	CH376FileOpen( PUINT8 name )      	
                    								
                      								
                    	    							
                    		  						
                    			/*在根目录或者当前目录下打开文件或者目录
                    (文件夹) */
  1861                        ;{
  1862                        	.line	232
  1863                        	.line	233
  1864                        	code
  1865                        	xdef	~~CH376FileOpen
  1866                        	func
  1867                        	.function	233
  1868                        ~~CH376FileOpen:
  1869                        	longa	on
  Thu Dec  3 2020 22:25                                                Page 36


  1870                        	longi	on
  1871 00:064E: 3B           	tsc
  1872 00:064F: 38           	sec
  1873 00:0650: E9 04 00     	sbc	#L107
  1874 00:0653: 1B           	tcs
  1875 00:0654: 0B           	phd
  1876 00:0655: 5B           	tcd
  1877             00000004   name_0	set	4
  1878                        	.block	233
  1879                        ;	CH376SetFileName( name );      			
                    						  		
                    							    	
                    								
                      								
                    	    							
                    		  						
                    			/*设置将要操作的文件的文件名 */
  1880                        	.sym	name,4,142,6,32
  1881                        	.line	234
  1882 00:0656: D4 0A        	pei	<L107+name_0+2
  1883 00:0658: D4 08        	pei	<L107+name_0
  1884 00:065A: 22 xx xx xx  	jsl	~~CH376SetFileName
  1885                        ;#ifndef	DEF_IC_V43_U
  1886                        ;	if ( name[0] == DEF_SEPAR_CHAR1 || name[0] == DE
                    F_SEPAR_CHAR2 ) CH376WriteVar32( VAR_CURRENT_CLUST, 0 );
  1887                        	.line	236
  1888 00:065E: E2 20        	sep	#$20
  1889                        	longa	off
  1890 00:0660: A7 08        	lda	[<L107+name_0]
  1891 00:0662: C9 5C        	cmp	#<$5c
  1892 00:0664: C2 20        	rep	#$20
  1893                        	longa	on
  1894 00:0666: D0 03        	bne	L111
  1895 00:0668: 82 0D 00     	brl	L110
  1896                        L111:
  1897 00:066B: E2 20        	sep	#$20
  1898                        	longa	off
  1899 00:066D: A7 08        	lda	[<L107+name_0]
  1900 00:066F: C9 2F        	cmp	#<$2f
  1901 00:0671: C2 20        	rep	#$20
  1902                        	longa	on
  1903 00:0673: F0 03        	beq	L112
  1904 00:0675: 82 0D 00     	brl	L10029
  1905                        L112:
  1906                        L110:
  1907                        	.line	236
  1908 00:0678: F4 00 00     	pea	#^$0
  1909 00:067B: F4 00 00     	pea	#<$0
  1910 00:067E: F4 64 00     	pea	#<$64
  1911 00:0681: 22 xx xx xx  	jsl	~~CH376WriteVar32
  1912                        ;#endif
  1913                        ;	return( CH376SendCmdWaitInt( CMD0H_FILE_OPEN ) )
                    ;
  1914                        L10029:
  1915                        	.line	238
  1916 00:0685: F4 32 00     	pea	#<$32
  1917 00:0688: 22 xx xx xx  	jsl	~~CH376SendCmdWaitInt
  1918 00:068C: E2 20        	sep	#$20
  Thu Dec  3 2020 22:25                                                Page 37


  1919                        	longa	off
  1920 00:068E: 85 01        	sta	<R0
  1921 00:0690: C2 20        	rep	#$20
  1922                        	longa	on
  1923 00:0692: A5 01        	lda	<R0
  1924 00:0694: 29 FF 00     	and	#$ff
  1925                        L113:
  1926 00:0697: A8           	tay
  1927 00:0698: A5 06        	lda	<L107+2
  1928 00:069A: 85 0A        	sta	<L107+2+4
  1929 00:069C: A5 05        	lda	<L107+1
  1930 00:069E: 85 09        	sta	<L107+1+4
  1931 00:06A0: 2B           	pld
  1932 00:06A1: 3B           	tsc
  1933 00:06A2: 18           	clc
  1934 00:06A3: 69 08 00     	adc	#L107+4
  1935 00:06A6: 1B           	tcs
  1936 00:06A7: 98           	tya
  1937 00:06A8: 6B           	rtl
  1938                        ;}
  1939                        	.line	239
  1940                        	.endblock	239
  1941             00000004   L107	equ	4
  1942             00000005   L108	equ	5
  1943                        	ends
  1944                        	efunc
  1945                        	.endfunc	239,5,4
  1946                        	.line	239
  1947                        ;
  1948                        ;UINT8	CH376FileCreate( PUINT8 name )      	
                    								
                      								
                    	    							
                    		  						
                    			/*在根目录或者当前目录下新建文件,如果文
                    已经存在那么先删除 */
  1949                        ;{
  1950                        	.line	241
  1951                        	.line	242
  1952                        	code
  1953                        	xdef	~~CH376FileCreate
  1954                        	func
  1955                        	.function	242
  1956                        ~~CH376FileCreate:
  1957                        	longa	on
  1958                        	longi	on
  1959 00:06A9: 3B           	tsc
  1960 00:06AA: 38           	sec
  1961 00:06AB: E9 04 00     	sbc	#L114
  1962 00:06AE: 1B           	tcs
  1963 00:06AF: 0B           	phd
  1964 00:06B0: 5B           	tcd
  1965             00000004   name_0	set	4
  1966                        	.block	242
  1967                        ;	if ( name ) CH376SetFileName( name );      	
                    								
                      								
                    	    							
  Thu Dec  3 2020 22:25                                                Page 38


                    		  						
                    			/*设置将要操作的文件的文件名 */
  1968                        	.sym	name,4,142,6,32
  1969                        	.line	243
  1970 00:06B1: A5 08        	lda	<L114+name_0
  1971 00:06B3: 05 0A        	ora	<L114+name_0+2
  1972 00:06B5: D0 03        	bne	L117
  1973 00:06B7: 82 08 00     	brl	L10030
  1974                        L117:
  1975                        	.line	243
  1976 00:06BA: D4 0A        	pei	<L114+name_0+2
  1977 00:06BC: D4 08        	pei	<L114+name_0
  1978 00:06BE: 22 xx xx xx  	jsl	~~CH376SetFileName
  1979                        ;	return( CH376SendCmdWaitInt( CMD0H_FILE_CREATE )
                     );
  1980                        L10030:
  1981                        	.line	244
  1982 00:06C2: F4 34 00     	pea	#<$34
  1983 00:06C5: 22 xx xx xx  	jsl	~~CH376SendCmdWaitInt
  1984 00:06C9: E2 20        	sep	#$20
  1985                        	longa	off
  1986 00:06CB: 85 01        	sta	<R0
  1987 00:06CD: C2 20        	rep	#$20
  1988                        	longa	on
  1989 00:06CF: A5 01        	lda	<R0
  1990 00:06D1: 29 FF 00     	and	#$ff
  1991                        L118:
  1992 00:06D4: A8           	tay
  1993 00:06D5: A5 06        	lda	<L114+2
  1994 00:06D7: 85 0A        	sta	<L114+2+4
  1995 00:06D9: A5 05        	lda	<L114+1
  1996 00:06DB: 85 09        	sta	<L114+1+4
  1997 00:06DD: 2B           	pld
  1998 00:06DE: 3B           	tsc
  1999 00:06DF: 18           	clc
  2000 00:06E0: 69 08 00     	adc	#L114+4
  2001 00:06E3: 1B           	tcs
  2002 00:06E4: 98           	tya
  2003 00:06E5: 6B           	rtl
  2004                        ;}
  2005                        	.line	245
  2006                        	.endblock	245
  2007             00000004   L114	equ	4
  2008             00000005   L115	equ	5
  2009                        	ends
  2010                        	efunc
  2011                        	.endfunc	245,5,4
  2012                        	.line	245
  2013                        ;
  2014                        ;UINT8	CH376DirCreate( PUINT8 name )      	
                    								
                      								
                    	    							
                    		  						
                    			/*在根目录下新建目录(文件夹)并打开,如果
                    柯家丫存在那么直接打开 */
  2015                        ;{
  2016                        	.line	247
  Thu Dec  3 2020 22:25                                                Page 39


  2017                        	.line	248
  2018                        	code
  2019                        	xdef	~~CH376DirCreate
  2020                        	func
  2021                        	.function	248
  2022                        ~~CH376DirCreate:
  2023                        	longa	on
  2024                        	longi	on
  2025 00:06E6: 3B           	tsc
  2026 00:06E7: 38           	sec
  2027 00:06E8: E9 04 00     	sbc	#L119
  2028 00:06EB: 1B           	tcs
  2029 00:06EC: 0B           	phd
  2030 00:06ED: 5B           	tcd
  2031             00000004   name_0	set	4
  2032                        	.block	248
  2033                        ;	CH376SetFileName( name );      			
                    						  		
                    							    	
                    								
                      								
                    	    							
                    		  						
                    			/*设置将要操作的文件的文件名 */
  2034                        	.sym	name,4,142,6,32
  2035                        	.line	249
  2036 00:06EE: D4 0A        	pei	<L119+name_0+2
  2037 00:06F0: D4 08        	pei	<L119+name_0
  2038 00:06F2: 22 xx xx xx  	jsl	~~CH376SetFileName
  2039                        ;#ifndef	DEF_IC_V43_U
  2040                        ;	if ( name[0] == DEF_SEPAR_CHAR1 || name[0] == DE
                    F_SEPAR_CHAR2 ) CH376WriteVar32( VAR_CURRENT_CLUST, 0 );
  2041                        	.line	251
  2042 00:06F6: E2 20        	sep	#$20
  2043                        	longa	off
  2044 00:06F8: A7 08        	lda	[<L119+name_0]
  2045 00:06FA: C9 5C        	cmp	#<$5c
  2046 00:06FC: C2 20        	rep	#$20
  2047                        	longa	on
  2048 00:06FE: D0 03        	bne	L123
  2049 00:0700: 82 0D 00     	brl	L122
  2050                        L123:
  2051 00:0703: E2 20        	sep	#$20
  2052                        	longa	off
  2053 00:0705: A7 08        	lda	[<L119+name_0]
  2054 00:0707: C9 2F        	cmp	#<$2f
  2055 00:0709: C2 20        	rep	#$20
  2056                        	longa	on
  2057 00:070B: F0 03        	beq	L124
  2058 00:070D: 82 0D 00     	brl	L10031
  2059                        L124:
  2060                        L122:
  2061                        	.line	251
  2062 00:0710: F4 00 00     	pea	#^$0
  2063 00:0713: F4 00 00     	pea	#<$0
  2064 00:0716: F4 64 00     	pea	#<$64
  2065 00:0719: 22 xx xx xx  	jsl	~~CH376WriteVar32
  2066                        ;#endif
  Thu Dec  3 2020 22:25                                                Page 40


  2067                        ;	return( CH376SendCmdWaitInt( CMD0H_DIR_CREATE ) 
                    );
  2068                        L10031:
  2069                        	.line	253
  2070 00:071D: F4 40 00     	pea	#<$40
  2071 00:0720: 22 xx xx xx  	jsl	~~CH376SendCmdWaitInt
  2072 00:0724: E2 20        	sep	#$20
  2073                        	longa	off
  2074 00:0726: 85 01        	sta	<R0
  2075 00:0728: C2 20        	rep	#$20
  2076                        	longa	on
  2077 00:072A: A5 01        	lda	<R0
  2078 00:072C: 29 FF 00     	and	#$ff
  2079                        L125:
  2080 00:072F: A8           	tay
  2081 00:0730: A5 06        	lda	<L119+2
  2082 00:0732: 85 0A        	sta	<L119+2+4
  2083 00:0734: A5 05        	lda	<L119+1
  2084 00:0736: 85 09        	sta	<L119+1+4
  2085 00:0738: 2B           	pld
  2086 00:0739: 3B           	tsc
  2087 00:073A: 18           	clc
  2088 00:073B: 69 08 00     	adc	#L119+4
  2089 00:073E: 1B           	tcs
  2090 00:073F: 98           	tya
  2091 00:0740: 6B           	rtl
  2092                        ;}
  2093                        	.line	254
  2094                        	.endblock	254
  2095             00000004   L119	equ	4
  2096             00000005   L120	equ	5
  2097                        	ends
  2098                        	efunc
  2099                        	.endfunc	254,5,4
  2100                        	.line	254
  2101                        ;
  2102                        ;UINT8	CH376SeparatePath( PUINT8 path )      	
                    								
                      								
                    	    							
                    		  						
                    			/*从路径中分离出最后一级文件名或者目录(
                    募夹)名,返回最后一级文件名或者目录名的字节偏移 */
  2103                        ;{
  2104                        	.line	256
  2105                        	.line	257
  2106                        	code
  2107                        	xdef	~~CH376SeparatePath
  2108                        	func
  2109                        	.function	257
  2110                        ~~CH376SeparatePath:
  2111                        	longa	on
  2112                        	longi	on
  2113 00:0741: 3B           	tsc
  2114 00:0742: 38           	sec
  2115 00:0743: E9 08 00     	sbc	#L126
  2116 00:0746: 1B           	tcs
  2117 00:0747: 0B           	phd
  Thu Dec  3 2020 22:25                                                Page 41


  2118 00:0748: 5B           	tcd
  2119             00000004   path_0	set	4
  2120                        	.block	257
  2121                        ;	PUINT8	pName;
  2122                        ;	for ( pName = path; *pName != 0; ++ pName );    
                     								
                    	  							
                    		     						
                    			  					
                    				/*到文件名字符串结束位置 */
  2123             00000000   pName_1	set	0
  2124                        	.sym	pName,0,142,1,32
  2125                        	.sym	path,4,142,6,32
  2126                        	.line	259
  2127 00:0749: A5 0C        	lda	<L126+path_0
  2128 00:074B: 85 05        	sta	<L127+pName_1
  2129 00:074D: A5 0E        	lda	<L126+path_0+2
  2130 00:074F: 85 07        	sta	<L127+pName_1+2
  2131 00:0751: 82 06 00     	brl	L10035
  2132                        L10034:
  2133                        	.line	259
  2134                        L10032:
  2135 00:0754: E6 05        	inc	<L127+pName_1
  2136 00:0756: D0 02        	bne	L129
  2137 00:0758: E6 07        	inc	<L127+pName_1+2
  2138                        L129:
  2139                        L10035:
  2140 00:075A: A7 05        	lda	[<L127+pName_1]
  2141 00:075C: 29 FF 00     	and	#$ff
  2142 00:075F: F0 03        	beq	L130
  2143 00:0761: 82 F0 FF     	brl	L10034
  2144                        L130:
  2145                        L10033:
  2146                        ;	while ( *pName != DEF_SEPAR_CHAR1 && *pName != D
                    EF_SEPAR_CHAR2 && pName != path ) pName --;      		
                    							  	
                    								
                        							
                    		  						
                    			/* 搜索倒数第一个路径分隔符 */
  2147                        	.line	260
  2148                        L10036:
  2149 00:0764: E2 20        	sep	#$20
  2150                        	longa	off
  2151 00:0766: A7 05        	lda	[<L127+pName_1]
  2152 00:0768: C9 5C        	cmp	#<$5c
  2153 00:076A: C2 20        	rep	#$20
  2154                        	longa	on
  2155 00:076C: D0 03        	bne	L131
  2156 00:076E: 82 27 00     	brl	L10037
  2157                        L131:
  2158 00:0771: E2 20        	sep	#$20
  2159                        	longa	off
  2160 00:0773: A7 05        	lda	[<L127+pName_1]
  2161 00:0775: C9 2F        	cmp	#<$2f
  2162 00:0777: C2 20        	rep	#$20
  2163                        	longa	on
  2164 00:0779: D0 03        	bne	L132
  Thu Dec  3 2020 22:25                                                Page 42


  2165 00:077B: 82 1A 00     	brl	L10037
  2166                        L132:
  2167 00:077E: A5 05        	lda	<L127+pName_1
  2168 00:0780: C5 0C        	cmp	<L126+path_0
  2169 00:0782: D0 04        	bne	L133
  2170 00:0784: A5 07        	lda	<L127+pName_1+2
  2171 00:0786: C5 0E        	cmp	<L126+path_0+2
  2172                        L133:
  2173 00:0788: D0 03        	bne	L134
  2174 00:078A: 82 0B 00     	brl	L10037
  2175                        L134:
  2176                        	.line	260
  2177 00:078D: A5 05        	lda	<L127+pName_1
  2178 00:078F: D0 02        	bne	L135
  2179 00:0791: C6 07        	dec	<L127+pName_1+2
  2180                        L135:
  2181 00:0793: C6 05        	dec	<L127+pName_1
  2182 00:0795: 82 CC FF     	brl	L10036
  2183                        L10037:
  2184                        ;	if ( pName != path ) pName ++;      		
                    							  	
                    								
                        							
                    		  						
                    			/*找到了路径分隔符,则修改指向目标文件的
                    詈笠患段募名,跳过前面的多级目录名及路径分隔符 */
  2185                        	.line	261
  2186 00:0798: A5 05        	lda	<L127+pName_1
  2187 00:079A: C5 0C        	cmp	<L126+path_0
  2188 00:079C: D0 04        	bne	L136
  2189 00:079E: A5 07        	lda	<L127+pName_1+2
  2190 00:07A0: C5 0E        	cmp	<L126+path_0+2
  2191                        L136:
  2192 00:07A2: D0 03        	bne	L137
  2193 00:07A4: 82 06 00     	brl	L10038
  2194                        L137:
  2195                        	.line	261
  2196 00:07A7: E6 05        	inc	<L127+pName_1
  2197 00:07A9: D0 02        	bne	L138
  2198 00:07AB: E6 07        	inc	<L127+pName_1+2
  2199                        L138:
  2200                        ;	return( pName - path );
  2201                        L10038:
  2202                        	.line	262
  2203 00:07AD: 38           	sec
  2204 00:07AE: A5 05        	lda	<L127+pName_1
  2205 00:07B0: E5 0C        	sbc	<L126+path_0
  2206 00:07B2: 85 01        	sta	<R0
  2207 00:07B4: A5 07        	lda	<L127+pName_1+2
  2208 00:07B6: E5 0E        	sbc	<L126+path_0+2
  2209 00:07B8: 85 03        	sta	<R0+2
  2210 00:07BA: A5 01        	lda	<R0
  2211 00:07BC: 29 FF 00     	and	#$ff
  2212                        L139:
  2213 00:07BF: A8           	tay
  2214 00:07C0: A5 0A        	lda	<L126+2
  2215 00:07C2: 85 0E        	sta	<L126+2+4
  2216 00:07C4: A5 09        	lda	<L126+1
  Thu Dec  3 2020 22:25                                                Page 43


  2217 00:07C6: 85 0D        	sta	<L126+1+4
  2218 00:07C8: 2B           	pld
  2219 00:07C9: 3B           	tsc
  2220 00:07CA: 18           	clc
  2221 00:07CB: 69 0C 00     	adc	#L126+4
  2222 00:07CE: 1B           	tcs
  2223 00:07CF: 98           	tya
  2224 00:07D0: 6B           	rtl
  2225                        ;}
  2226                        	.line	263
  2227                        	.endblock	263
  2228             00000008   L126	equ	8
  2229             00000005   L127	equ	5
  2230                        	ends
  2231                        	efunc
  2232                        	.endfunc	263,5,8
  2233                        	.line	263
  2234                        ;
  2235                        ;UINT8	CH376FileOpenDir( PUINT8 PathName, UINT8
                     StopName )
  2236                        ;
  2237                        ;{
  2238                        	.line	265
  2239                        	.line	267
  2240                        	code
  2241                        	xdef	~~CH376FileOpenDir
  2242                        	func
  2243                        	.function	267
  2244                        ~~CH376FileOpenDir:
  2245                        	longa	on
  2246                        	longi	on
  2247 00:07D1: 3B           	tsc
  2248 00:07D2: 38           	sec
  2249 00:07D3: E9 0E 00     	sbc	#L140
  2250 00:07D6: 1B           	tcs
  2251 00:07D7: 0B           	phd
  2252 00:07D8: 5B           	tcd
  2253             00000004   PathName_0	set	4
  2254             00000008   StopName_0	set	8
  2255                        	.block	267
  2256                        ;	UINT8	i, s;
  2257                        ;	s = 0;
  2258             00000000   i_1	set	0
  2259             00000001   s_1	set	1
  2260                        	.sym	i,0,14,1,8
  2261                        	.sym	s,1,14,1,8
  2262                        	.sym	PathName,4,142,6,32
  2263                        	.sym	StopName,8,14,6,8
  2264                        	.line	269
  2265 00:07D9: E2 20        	sep	#$20
  2266                        	longa	off
  2267 00:07DB: 64 0E        	stz	<L141+s_1
  2268 00:07DD: C2 20        	rep	#$20
  2269                        	longa	on
  2270                        ;	i = 1;
  2271                        	.line	270
  2272 00:07DF: E2 20        	sep	#$20
  2273                        	longa	off
  Thu Dec  3 2020 22:25                                                Page 44


  2274 00:07E1: A9 01        	lda	#$1
  2275 00:07E3: 85 0D        	sta	<L141+i_1
  2276 00:07E5: C2 20        	rep	#$20
  2277                        	longa	on
  2278                        ;	while ( 1 ) {
  2279                        	.line	271
  2280                        L10039:
  2281                        	.line	271
  2282                        ;		while ( PathName[i] != DEF_SEPAR_CHAR1 &
                    & PathName[i] != DEF_SEPAR_CHAR2 && PathName[i] != 0 ) ++ i;
                          							
                    		  						
                    			/*搜索下一个路径分隔符或者路径结束符 */
  2283                        	.line	272
  2284                        L10041:
  2285 00:07E7: A5 0D        	lda	<L141+i_1
  2286 00:07E9: 29 FF 00     	and	#$ff
  2287 00:07EC: 85 01        	sta	<R0
  2288 00:07EE: E2 20        	sep	#$20
  2289                        	longa	off
  2290 00:07F0: A4 01        	ldy	<R0
  2291 00:07F2: B7 12        	lda	[<L140+PathName_0],Y
  2292 00:07F4: C9 5C        	cmp	#<$5c
  2293 00:07F6: C2 20        	rep	#$20
  2294                        	longa	on
  2295 00:07F8: D0 03        	bne	L143
  2296 00:07FA: 82 32 00     	brl	L10042
  2297                        L143:
  2298 00:07FD: A5 0D        	lda	<L141+i_1
  2299 00:07FF: 29 FF 00     	and	#$ff
  2300 00:0802: 85 05        	sta	<R1
  2301 00:0804: E2 20        	sep	#$20
  2302                        	longa	off
  2303 00:0806: A4 05        	ldy	<R1
  2304 00:0808: B7 12        	lda	[<L140+PathName_0],Y
  2305 00:080A: C9 2F        	cmp	#<$2f
  2306 00:080C: C2 20        	rep	#$20
  2307                        	longa	on
  2308 00:080E: D0 03        	bne	L144
  2309 00:0810: 82 1C 00     	brl	L10042
  2310                        L144:
  2311 00:0813: A5 0D        	lda	<L141+i_1
  2312 00:0815: 29 FF 00     	and	#$ff
  2313 00:0818: 85 09        	sta	<R2
  2314 00:081A: A4 09        	ldy	<R2
  2315 00:081C: B7 12        	lda	[<L140+PathName_0],Y
  2316 00:081E: 29 FF 00     	and	#$ff
  2317 00:0821: D0 03        	bne	L145
  2318 00:0823: 82 09 00     	brl	L10042
  2319                        L145:
  2320                        	.line	272
  2321 00:0826: E2 20        	sep	#$20
  2322                        	longa	off
  2323 00:0828: E6 0D        	inc	<L141+i_1
  2324 00:082A: C2 20        	rep	#$20
  2325                        	longa	on
  2326 00:082C: 82 B8 FF     	brl	L10041
  2327                        L10042:
  Thu Dec  3 2020 22:25                                                Page 45


  2328                        ;		if ( PathName[i] ) i ++;
  2329                        	.line	273
  2330 00:082F: A5 0D        	lda	<L141+i_1
  2331 00:0831: 29 FF 00     	and	#$ff
  2332 00:0834: 85 01        	sta	<R0
  2333 00:0836: A4 01        	ldy	<R0
  2334 00:0838: B7 12        	lda	[<L140+PathName_0],Y
  2335 00:083A: 29 FF 00     	and	#$ff
  2336 00:083D: D0 03        	bne	L146
  2337 00:083F: 82 09 00     	brl	L10043
  2338                        L146:
  2339                        	.line	273
  2340 00:0842: E2 20        	sep	#$20
  2341                        	longa	off
  2342 00:0844: E6 0D        	inc	<L141+i_1
  2343 00:0846: C2 20        	rep	#$20
  2344                        	longa	on
  2345                        ;		else i = 0;
  2346 00:0848: 82 06 00     	brl	L10044
  2347                        L10043:
  2348                        	.line	274
  2349 00:084B: E2 20        	sep	#$20
  2350                        	longa	off
  2351 00:084D: 64 0D        	stz	<L141+i_1
  2352 00:084F: C2 20        	rep	#$20
  2353                        	longa	on
  2354                        L10044:
  2355                        ;		s = CH376FileOpen( &PathName[s] );
  2356                        	.line	275
  2357 00:0851: A5 0E        	lda	<L141+s_1
  2358 00:0853: 29 FF 00     	and	#$ff
  2359 00:0856: 85 01        	sta	<R0
  2360 00:0858: 64 03        	stz	<R0+2
  2361 00:085A: 18           	clc
  2362 00:085B: A5 12        	lda	<L140+PathName_0
  2363 00:085D: 65 01        	adc	<R0
  2364 00:085F: 85 05        	sta	<R1
  2365 00:0861: A5 14        	lda	<L140+PathName_0+2
  2366 00:0863: 65 03        	adc	<R0+2
  2367 00:0865: 85 07        	sta	<R1+2
  2368 00:0867: D4 07        	pei	<R1+2
  2369 00:0869: D4 05        	pei	<R1
  2370 00:086B: 22 xx xx xx  	jsl	~~CH376FileOpen
  2371 00:086F: E2 20        	sep	#$20
  2372                        	longa	off
  2373 00:0871: 85 0E        	sta	<L141+s_1
  2374 00:0873: C2 20        	rep	#$20
  2375                        	longa	on
  2376                        ;		if ( i && i != StopName ) {
  2377                        	.line	276
  2378 00:0875: A5 0D        	lda	<L141+i_1
  2379 00:0877: 29 FF 00     	and	#$ff
  2380 00:087A: D0 03        	bne	L147
  2381 00:087C: 82 62 00     	brl	L10045
  2382                        L147:
  2383 00:087F: E2 20        	sep	#$20
  2384                        	longa	off
  2385 00:0881: A5 0D        	lda	<L141+i_1
  Thu Dec  3 2020 22:25                                                Page 46


  2386 00:0883: C5 16        	cmp	<L140+StopName_0
  2387 00:0885: C2 20        	rep	#$20
  2388                        	longa	on
  2389 00:0887: D0 03        	bne	L148
  2390 00:0889: 82 55 00     	brl	L10045
  2391                        L148:
  2392                        	.line	276
  2393                        ;			if ( s != ERR_OPEN_DIR ) {
  2394                        	.line	277
  2395 00:088C: E2 20        	sep	#$20
  2396                        	longa	off
  2397 00:088E: A5 0E        	lda	<L141+s_1
  2398 00:0890: C9 41        	cmp	#<$41
  2399 00:0892: C2 20        	rep	#$20
  2400                        	longa	on
  2401 00:0894: D0 03        	bne	L149
  2402 00:0896: 82 3D 00     	brl	L10046
  2403                        L149:
  2404                        	.line	277
  2405                        ;				if ( s == USB_INT_SUCCES
                    S ) return( ERR_FOUND_NAME );
  2406                        	.line	278
  2407 00:0899: E2 20        	sep	#$20
  2408                        	longa	off
  2409 00:089B: A5 0E        	lda	<L141+s_1
  2410 00:089D: C9 14        	cmp	#<$14
  2411 00:089F: C2 20        	rep	#$20
  2412                        	longa	on
  2413 00:08A1: F0 03        	beq	L150
  2414 00:08A3: 82 15 00     	brl	L10047
  2415                        L150:
  2416                        	.line	278
  2417 00:08A6: A9 43 00     	lda	#$43
  2418                        L151:
  2419 00:08A9: A8           	tay
  2420 00:08AA: A5 10        	lda	<L140+2
  2421 00:08AC: 85 16        	sta	<L140+2+6
  2422 00:08AE: A5 0F        	lda	<L140+1
  2423 00:08B0: 85 15        	sta	<L140+1+6
  2424 00:08B2: 2B           	pld
  2425 00:08B3: 3B           	tsc
  2426 00:08B4: 18           	clc
  2427 00:08B5: 69 14 00     	adc	#L140+6
  2428 00:08B8: 1B           	tcs
  2429 00:08B9: 98           	tya
  2430 00:08BA: 6B           	rtl
  2431                        ;				else if ( s == ERR_MISS_
                    FILE ) return( ERR_MISS_DIR );
  2432                        L10047:
  2433                        	.line	279
  2434 00:08BB: E2 20        	sep	#$20
  2435                        	longa	off
  2436 00:08BD: A5 0E        	lda	<L141+s_1
  2437 00:08BF: C9 42        	cmp	#<$42
  2438 00:08C1: C2 20        	rep	#$20
  2439                        	longa	on
  2440 00:08C3: F0 03        	beq	L152
  2441 00:08C5: 82 06 00     	brl	L10048
  Thu Dec  3 2020 22:25                                                Page 47


  2442                        L152:
  2443                        	.line	279
  2444 00:08C8: A9 B3 00     	lda	#$b3
  2445 00:08CB: 82 DB FF     	brl	L151
  2446                        ;				else return( s );
  2447                        L10048:
  2448                        	.line	280
  2449 00:08CE: A5 0E        	lda	<L141+s_1
  2450 00:08D0: 29 FF 00     	and	#$ff
  2451 00:08D3: 82 D3 FF     	brl	L151
  2452                        ;			}
  2453                        	.line	281
  2454                        ;			s = i;
  2455                        L10046:
  2456                        	.line	282
  2457 00:08D6: E2 20        	sep	#$20
  2458                        	longa	off
  2459 00:08D8: A5 0D        	lda	<L141+i_1
  2460 00:08DA: 85 0E        	sta	<L141+s_1
  2461 00:08DC: C2 20        	rep	#$20
  2462                        	longa	on
  2463                        ;		}
  2464                        	.line	283
  2465                        ;		else return( s );
  2466 00:08DE: 82 08 00     	brl	L10049
  2467                        L10045:
  2468                        	.line	284
  2469 00:08E1: A5 0E        	lda	<L141+s_1
  2470 00:08E3: 29 FF 00     	and	#$ff
  2471 00:08E6: 82 C0 FF     	brl	L151
  2472                        L10049:
  2473                        ;	}
  2474                        	.line	285
  2475 00:08E9: 82 FB FE     	brl	L10039
  2476                        ;}
  2477                        	.line	286
  2478                        	.endblock	286
  2479             0000000E   L140	equ	14
  2480             0000000D   L141	equ	13
  2481                        	ends
  2482                        	efunc
  2483                        	.endfunc	286,13,14
  2484                        	.line	286
  2485                        ;
  2486                        ;UINT8	CH376FileOpenPath( PUINT8 PathName )
  2487                        ;{
  2488                        	.line	288
  2489                        	.line	289
  2490                        	code
  2491                        	xdef	~~CH376FileOpenPath
  2492                        	func
  2493                        	.function	289
  2494                        ~~CH376FileOpenPath:
  2495                        	longa	on
  2496                        	longi	on
  2497 00:08EC: 3B           	tsc
  2498 00:08ED: 38           	sec
  2499 00:08EE: E9 04 00     	sbc	#L153
  Thu Dec  3 2020 22:25                                                Page 48


  2500 00:08F1: 1B           	tcs
  2501 00:08F2: 0B           	phd
  2502 00:08F3: 5B           	tcd
  2503             00000004   PathName_0	set	4
  2504                        	.block	289
  2505                        ;	return( CH376FileOpenDir( PathName, 0xFF ) );
  2506                        	.sym	PathName,4,142,6,32
  2507                        	.line	290
  2508 00:08F4: F4 FF 00     	pea	#<$ff
  2509 00:08F7: D4 0A        	pei	<L153+PathName_0+2
  2510 00:08F9: D4 08        	pei	<L153+PathName_0
  2511 00:08FB: 22 xx xx xx  	jsl	~~CH376FileOpenDir
  2512 00:08FF: E2 20        	sep	#$20
  2513                        	longa	off
  2514 00:0901: 85 01        	sta	<R0
  2515 00:0903: C2 20        	rep	#$20
  2516                        	longa	on
  2517 00:0905: A5 01        	lda	<R0
  2518 00:0907: 29 FF 00     	and	#$ff
  2519                        L156:
  2520 00:090A: A8           	tay
  2521 00:090B: A5 06        	lda	<L153+2
  2522 00:090D: 85 0A        	sta	<L153+2+4
  2523 00:090F: A5 05        	lda	<L153+1
  2524 00:0911: 85 09        	sta	<L153+1+4
  2525 00:0913: 2B           	pld
  2526 00:0914: 3B           	tsc
  2527 00:0915: 18           	clc
  2528 00:0916: 69 08 00     	adc	#L153+4
  2529 00:0919: 1B           	tcs
  2530 00:091A: 98           	tya
  2531 00:091B: 6B           	rtl
  2532                        ;}
  2533                        	.line	291
  2534                        	.endblock	291
  2535             00000004   L153	equ	4
  2536             00000005   L154	equ	5
  2537                        	ends
  2538                        	efunc
  2539                        	.endfunc	291,5,4
  2540                        	.line	291
  2541                        ;
  2542                        ;UINT8	CH376FileCreatePath( PUINT8 PathName )
  2543                        ;{
  2544                        	.line	293
  2545                        	.line	294
  2546                        	code
  2547                        	xdef	~~CH376FileCreatePath
  2548                        	func
  2549                        	.function	294
  2550                        ~~CH376FileCreatePath:
  2551                        	longa	on
  2552                        	longi	on
  2553 00:091C: 3B           	tsc
  2554 00:091D: 38           	sec
  2555 00:091E: E9 0A 00     	sbc	#L157
  2556 00:0921: 1B           	tcs
  2557 00:0922: 0B           	phd
  Thu Dec  3 2020 22:25                                                Page 49


  2558 00:0923: 5B           	tcd
  2559             00000004   PathName_0	set	4
  2560                        	.block	294
  2561                        ;	UINT8	s;
  2562                        ;	UINT8	Name;
  2563                        ;	Name = CH376SeparatePath( PathName );
  2564             00000000   s_1	set	0
  2565             00000001   Name_1	set	1
  2566                        	.sym	s,0,14,1,8
  2567                        	.sym	Name,1,14,1,8
  2568                        	.sym	PathName,4,142,6,32
  2569                        	.line	297
  2570 00:0924: D4 10        	pei	<L157+PathName_0+2
  2571 00:0926: D4 0E        	pei	<L157+PathName_0
  2572 00:0928: 22 xx xx xx  	jsl	~~CH376SeparatePath
  2573 00:092C: E2 20        	sep	#$20
  2574                        	longa	off
  2575 00:092E: 85 0A        	sta	<L158+Name_1
  2576 00:0930: C2 20        	rep	#$20
  2577                        	longa	on
  2578                        ;	if ( Name ) {
  2579                        	.line	298
  2580 00:0932: A5 0A        	lda	<L158+Name_1
  2581 00:0934: 29 FF 00     	and	#$ff
  2582 00:0937: D0 03        	bne	L160
  2583 00:0939: 82 5A 00     	brl	L10050
  2584                        L160:
  2585                        	.line	298
  2586                        ;		s = CH376FileOpenDir( PathName, Name );
  2587                        	.line	299
  2588 00:093C: D4 0A        	pei	<L158+Name_1
  2589 00:093E: D4 10        	pei	<L157+PathName_0+2
  2590 00:0940: D4 0E        	pei	<L157+PathName_0
  2591 00:0942: 22 xx xx xx  	jsl	~~CH376FileOpenDir
  2592 00:0946: E2 20        	sep	#$20
  2593                        	longa	off
  2594 00:0948: 85 09        	sta	<L158+s_1
  2595 00:094A: C2 20        	rep	#$20
  2596                        	longa	on
  2597                        ;		if ( s != ERR_OPEN_DIR ) {
  2598                        	.line	300
  2599 00:094C: E2 20        	sep	#$20
  2600                        	longa	off
  2601 00:094E: A5 09        	lda	<L158+s_1
  2602 00:0950: C9 41        	cmp	#<$41
  2603 00:0952: C2 20        	rep	#$20
  2604                        	longa	on
  2605 00:0954: D0 03        	bne	L161
  2606 00:0956: 82 3D 00     	brl	L10051
  2607                        L161:
  2608                        	.line	300
  2609                        ;			if ( s == USB_INT_SUCCESS ) retu
                    rn( ERR_FOUND_NAME );
  2610                        	.line	301
  2611 00:0959: E2 20        	sep	#$20
  2612                        	longa	off
  2613 00:095B: A5 09        	lda	<L158+s_1
  2614 00:095D: C9 14        	cmp	#<$14
  Thu Dec  3 2020 22:25                                                Page 50


  2615 00:095F: C2 20        	rep	#$20
  2616                        	longa	on
  2617 00:0961: F0 03        	beq	L162
  2618 00:0963: 82 15 00     	brl	L10052
  2619                        L162:
  2620                        	.line	301
  2621 00:0966: A9 43 00     	lda	#$43
  2622                        L163:
  2623 00:0969: A8           	tay
  2624 00:096A: A5 0C        	lda	<L157+2
  2625 00:096C: 85 10        	sta	<L157+2+4
  2626 00:096E: A5 0B        	lda	<L157+1
  2627 00:0970: 85 0F        	sta	<L157+1+4
  2628 00:0972: 2B           	pld
  2629 00:0973: 3B           	tsc
  2630 00:0974: 18           	clc
  2631 00:0975: 69 0E 00     	adc	#L157+4
  2632 00:0978: 1B           	tcs
  2633 00:0979: 98           	tya
  2634 00:097A: 6B           	rtl
  2635                        ;			else if ( s == ERR_MISS_FILE ) r
                    eturn( ERR_MISS_DIR );
  2636                        L10052:
  2637                        	.line	302
  2638 00:097B: E2 20        	sep	#$20
  2639                        	longa	off
  2640 00:097D: A5 09        	lda	<L158+s_1
  2641 00:097F: C9 42        	cmp	#<$42
  2642 00:0981: C2 20        	rep	#$20
  2643                        	longa	on
  2644 00:0983: F0 03        	beq	L164
  2645 00:0985: 82 06 00     	brl	L10053
  2646                        L164:
  2647                        	.line	302
  2648 00:0988: A9 B3 00     	lda	#$b3
  2649 00:098B: 82 DB FF     	brl	L163
  2650                        ;			else return( s );
  2651                        L10053:
  2652                        	.line	303
  2653 00:098E: A5 09        	lda	<L158+s_1
  2654 00:0990: 29 FF 00     	and	#$ff
  2655 00:0993: 82 D3 FF     	brl	L163
  2656                        ;		}
  2657                        	.line	304
  2658                        ;	}
  2659                        L10051:
  2660                        	.line	305
  2661                        ;	return( CH376FileCreate( &PathName[Name] ) );
  2662                        L10050:
  2663                        	.line	306
  2664 00:0996: A5 0A        	lda	<L158+Name_1
  2665 00:0998: 29 FF 00     	and	#$ff
  2666 00:099B: 85 01        	sta	<R0
  2667 00:099D: 64 03        	stz	<R0+2
  2668 00:099F: 18           	clc
  2669 00:09A0: A5 0E        	lda	<L157+PathName_0
  2670 00:09A2: 65 01        	adc	<R0
  2671 00:09A4: 85 05        	sta	<R1
  Thu Dec  3 2020 22:25                                                Page 51


  2672 00:09A6: A5 10        	lda	<L157+PathName_0+2
  2673 00:09A8: 65 03        	adc	<R0+2
  2674 00:09AA: 85 07        	sta	<R1+2
  2675 00:09AC: D4 07        	pei	<R1+2
  2676 00:09AE: D4 05        	pei	<R1
  2677 00:09B0: 22 xx xx xx  	jsl	~~CH376FileCreate
  2678 00:09B4: E2 20        	sep	#$20
  2679                        	longa	off
  2680 00:09B6: 85 01        	sta	<R0
  2681 00:09B8: C2 20        	rep	#$20
  2682                        	longa	on
  2683 00:09BA: A5 01        	lda	<R0
  2684 00:09BC: 29 FF 00     	and	#$ff
  2685 00:09BF: 82 A7 FF     	brl	L163
  2686                        ;}
  2687                        	.line	307
  2688                        	.endblock	307
  2689             0000000A   L157	equ	10
  2690             00000009   L158	equ	9
  2691                        	ends
  2692                        	efunc
  2693                        	.endfunc	307,9,10
  2694                        	.line	307
  2695                        ;
  2696                        ;#ifdef	EN_DIR_CREATE
  2697                        ;UINT8	CH376DirCreatePath( PUINT8 PathName )
  2698                        ;{
  2699                        ;	UINT8	s;
  2700                        ;	UINT8	Name;
  2701                        ;	UINT8	ClustBuf[4];
  2702                        ;	Name = CH376SeparatePath( PathName );
  2703                        ;	if ( Name ) {
  2704                        ;		s = CH376FileOpenDir( PathName, Name );
  2705                        ;		if ( s != ERR_OPEN_DIR ) {
  2706                        ;			if ( s == USB_INT_SUCCESS ) retu
                    rn( ERR_FOUND_NAME );
  2707                        ;			else if ( s == ERR_MISS_FILE ) r
                    eturn( ERR_MISS_DIR );
  2708                        ;			else return( s );
  2709                        ;		}
  2710                        ;		xWriteCH376Cmd( CMD14_READ_VAR32 );
  2711                        ;		xWriteCH376Data( VAR_START_CLUSTER );
  2712                        ;		for ( s = 0; s != 4; s ++ ) ClustBuf[ s 
                    ] = xReadCH376Data( );
  2713                        ;		xEndCH376Cmd( );
  2714                        ;		s = CH376DirCreate( &PathName[Name] );
  2715                        ;		if ( s != USB_INT_SUCCESS ) return( s );
  2716                        ;		s = CH376ByteLocate( sizeof(FAT_DIR_INFO
                    ) + STRUCT_OFFSET( FAT_DIR_INFO, DIR_FstClusHI ) );
  2717                        ;		if ( s != USB_INT_SUCCESS ) return( s );
  2718                        ;		s = CH376ByteWrite( &ClustBuf[2], 2, NUL
                    L );
  2719                        ;		if ( s != USB_INT_SUCCESS ) return( s );
  2720                        ;		s = CH376ByteLocate( sizeof(FAT_DIR_INFO
                    ) + STRUCT_OFFSET( FAT_DIR_INFO, DIR_FstClusLO ) );
  2721                        ;		if ( s != USB_INT_SUCCESS ) return( s );
  2722                        ;		s = CH376ByteWrite( ClustBuf, 2, NULL );
  2723                        ;		if ( s != USB_INT_SUCCESS ) return( s );
  Thu Dec  3 2020 22:25                                                Page 52


  2724                        ;		s = CH376ByteLocate( 0 );
  2725                        ;		if ( s != USB_INT_SUCCESS ) return( s );
  2726                        ;	}
  2727                        ;	else {
  2728                        ;		if ( PathName[0] == DEF_SEPAR_CHAR1 || P
                    athName[0] == DEF_SEPAR_CHAR2 ) return( CH376DirCreate( Path
                    Name ) );
  2729                        ;		else return( ERR_MISS_DIR );
  2730                        ;	}
  2731                        ;}
  2732                        ;#endif
  2733                        ;
  2734                        ;UINT8	CH376FileErase( PUINT8 PathName )
  2735                        ;{
  2736                        	.line	347
  2737                        	.line	348
  2738                        	code
  2739                        	xdef	~~CH376FileErase
  2740                        	func
  2741                        	.function	348
  2742                        ~~CH376FileErase:
  2743                        	longa	on
  2744                        	longi	on
  2745 00:09C2: 3B           	tsc
  2746 00:09C3: 38           	sec
  2747 00:09C4: E9 0D 00     	sbc	#L165
  2748 00:09C7: 1B           	tcs
  2749 00:09C8: 0B           	phd
  2750 00:09C9: 5B           	tcd
  2751             00000004   PathName_0	set	4
  2752                        	.block	348
  2753                        ;	UINT8	s;
  2754                        ;	if ( PathName ) {
  2755             00000000   s_1	set	0
  2756                        	.sym	s,0,14,1,8
  2757                        	.sym	PathName,4,142,6,32
  2758                        	.line	350
  2759 00:09CA: A5 11        	lda	<L165+PathName_0
  2760 00:09CC: 05 13        	ora	<L165+PathName_0+2
  2761 00:09CE: D0 03        	bne	L168
  2762 00:09D0: 82 AD 00     	brl	L10054
  2763                        L168:
  2764                        	.line	350
  2765                        ;		for ( s = 1; PathName[s] != DEF_SEPAR_CH
                    AR1 && PathName[s] != DEF_SEPAR_CHAR2 && PathName[s] != 0; +
                    + s );
  2766                        	.line	351
  2767 00:09D3: E2 20        	sep	#$20
  2768                        	longa	off
  2769 00:09D5: A9 01        	lda	#$1
  2770 00:09D7: 85 0D        	sta	<L166+s_1
  2771 00:09D9: C2 20        	rep	#$20
  2772                        	longa	on
  2773 00:09DB: 82 06 00     	brl	L10058
  2774                        L10057:
  2775                        	.line	351
  2776                        L10055:
  2777 00:09DE: E2 20        	sep	#$20
  Thu Dec  3 2020 22:25                                                Page 53


  2778                        	longa	off
  2779 00:09E0: E6 0D        	inc	<L166+s_1
  2780 00:09E2: C2 20        	rep	#$20
  2781                        	longa	on
  2782                        L10058:
  2783 00:09E4: A5 0D        	lda	<L166+s_1
  2784 00:09E6: 29 FF 00     	and	#$ff
  2785 00:09E9: 85 01        	sta	<R0
  2786 00:09EB: E2 20        	sep	#$20
  2787                        	longa	off
  2788 00:09ED: A4 01        	ldy	<R0
  2789 00:09EF: B7 11        	lda	[<L165+PathName_0],Y
  2790 00:09F1: C9 5C        	cmp	#<$5c
  2791 00:09F3: C2 20        	rep	#$20
  2792                        	longa	on
  2793 00:09F5: D0 03        	bne	L170
  2794 00:09F7: 82 29 00     	brl	L169
  2795                        L170:
  2796 00:09FA: A5 0D        	lda	<L166+s_1
  2797 00:09FC: 29 FF 00     	and	#$ff
  2798 00:09FF: 85 05        	sta	<R1
  2799 00:0A01: E2 20        	sep	#$20
  2800                        	longa	off
  2801 00:0A03: A4 05        	ldy	<R1
  2802 00:0A05: B7 11        	lda	[<L165+PathName_0],Y
  2803 00:0A07: C9 2F        	cmp	#<$2f
  2804 00:0A09: C2 20        	rep	#$20
  2805                        	longa	on
  2806 00:0A0B: D0 03        	bne	L171
  2807 00:0A0D: 82 13 00     	brl	L169
  2808                        L171:
  2809 00:0A10: A5 0D        	lda	<L166+s_1
  2810 00:0A12: 29 FF 00     	and	#$ff
  2811 00:0A15: 85 09        	sta	<R2
  2812 00:0A17: A4 09        	ldy	<R2
  2813 00:0A19: B7 11        	lda	[<L165+PathName_0],Y
  2814 00:0A1B: 29 FF 00     	and	#$ff
  2815 00:0A1E: F0 03        	beq	L172
  2816 00:0A20: 82 BB FF     	brl	L10057
  2817                        L172:
  2818                        L169:
  2819                        L10056:
  2820                        ;		if ( PathName[s] ) {
  2821                        	.line	352
  2822 00:0A23: A5 0D        	lda	<L166+s_1
  2823 00:0A25: 29 FF 00     	and	#$ff
  2824 00:0A28: 85 01        	sta	<R0
  2825 00:0A2A: A4 01        	ldy	<R0
  2826 00:0A2C: B7 11        	lda	[<L165+PathName_0],Y
  2827 00:0A2E: 29 FF 00     	and	#$ff
  2828 00:0A31: D0 03        	bne	L173
  2829 00:0A33: 82 42 00     	brl	L10059
  2830                        L173:
  2831                        	.line	352
  2832                        ;			s = CH376FileOpenPath( PathName 
                    );
  2833                        	.line	353
  2834 00:0A36: D4 13        	pei	<L165+PathName_0+2
  Thu Dec  3 2020 22:25                                                Page 54


  2835 00:0A38: D4 11        	pei	<L165+PathName_0
  2836 00:0A3A: 22 xx xx xx  	jsl	~~CH376FileOpenPath
  2837 00:0A3E: E2 20        	sep	#$20
  2838                        	longa	off
  2839 00:0A40: 85 0D        	sta	<L166+s_1
  2840 00:0A42: C2 20        	rep	#$20
  2841                        	longa	on
  2842                        ;			if ( s != USB_INT_SUCCESS && s !
                    = ERR_OPEN_DIR ) return( s );
  2843                        	.line	354
  2844 00:0A44: E2 20        	sep	#$20
  2845                        	longa	off
  2846 00:0A46: A5 0D        	lda	<L166+s_1
  2847 00:0A48: C9 14        	cmp	#<$14
  2848 00:0A4A: C2 20        	rep	#$20
  2849                        	longa	on
  2850 00:0A4C: D0 03        	bne	L174
  2851 00:0A4E: 82 24 00     	brl	L10060
  2852                        L174:
  2853 00:0A51: E2 20        	sep	#$20
  2854                        	longa	off
  2855 00:0A53: A5 0D        	lda	<L166+s_1
  2856 00:0A55: C9 41        	cmp	#<$41
  2857 00:0A57: C2 20        	rep	#$20
  2858                        	longa	on
  2859 00:0A59: D0 03        	bne	L175
  2860 00:0A5B: 82 17 00     	brl	L10060
  2861                        L175:
  2862                        	.line	354
  2863 00:0A5E: A5 0D        	lda	<L166+s_1
  2864 00:0A60: 29 FF 00     	and	#$ff
  2865                        L176:
  2866 00:0A63: A8           	tay
  2867 00:0A64: A5 0F        	lda	<L165+2
  2868 00:0A66: 85 13        	sta	<L165+2+4
  2869 00:0A68: A5 0E        	lda	<L165+1
  2870 00:0A6A: 85 12        	sta	<L165+1+4
  2871 00:0A6C: 2B           	pld
  2872 00:0A6D: 3B           	tsc
  2873 00:0A6E: 18           	clc
  2874 00:0A6F: 69 11 00     	adc	#L165+4
  2875 00:0A72: 1B           	tcs
  2876 00:0A73: 98           	tya
  2877 00:0A74: 6B           	rtl
  2878                        ;		}
  2879                        L10060:
  2880                        	.line	355
  2881                        ;		else CH376SetFileName( PathName );
  2882 00:0A75: 82 08 00     	brl	L10061
  2883                        L10059:
  2884                        	.line	356
  2885 00:0A78: D4 13        	pei	<L165+PathName_0+2
  2886 00:0A7A: D4 11        	pei	<L165+PathName_0
  2887 00:0A7C: 22 xx xx xx  	jsl	~~CH376SetFileName
  2888                        L10061:
  2889                        ;	}
  2890                        	.line	357
  2891                        ;	return( CH376SendCmdWaitInt( CMD0H_FILE_ERASE ) 
  Thu Dec  3 2020 22:25                                                Page 55


                    );
  2892                        L10054:
  2893                        	.line	358
  2894 00:0A80: F4 35 00     	pea	#<$35
  2895 00:0A83: 22 xx xx xx  	jsl	~~CH376SendCmdWaitInt
  2896 00:0A87: E2 20        	sep	#$20
  2897                        	longa	off
  2898 00:0A89: 85 01        	sta	<R0
  2899 00:0A8B: C2 20        	rep	#$20
  2900                        	longa	on
  2901 00:0A8D: A5 01        	lda	<R0
  2902 00:0A8F: 29 FF 00     	and	#$ff
  2903 00:0A92: 82 CE FF     	brl	L176
  2904                        ;}
  2905                        	.line	359
  2906                        	.endblock	359
  2907             0000000D   L165	equ	13
  2908             0000000D   L166	equ	13
  2909                        	ends
  2910                        	efunc
  2911                        	.endfunc	359,13,13
  2912                        	.line	359
  2913                        ;
  2914                        ;UINT8	CH376FileClose( UINT8 UpdateSz )
  2915                        ;{
  2916                        	.line	361
  2917                        	.line	362
  2918                        	code
  2919                        	xdef	~~CH376FileClose
  2920                        	func
  2921                        	.function	362
  2922                        ~~CH376FileClose:
  2923                        	longa	on
  2924                        	longi	on
  2925 00:0A95: 3B           	tsc
  2926 00:0A96: 38           	sec
  2927 00:0A97: E9 04 00     	sbc	#L177
  2928 00:0A9A: 1B           	tcs
  2929 00:0A9B: 0B           	phd
  2930 00:0A9C: 5B           	tcd
  2931             00000004   UpdateSz_0	set	4
  2932                        	.block	362
  2933                        ;	return( CH376SendCmdDatWaitInt( CMD1H_FILE_CLOSE
                    , UpdateSz ) );
  2934                        	.sym	UpdateSz,4,14,6,8
  2935                        	.line	363
  2936 00:0A9D: D4 08        	pei	<L177+UpdateSz_0
  2937 00:0A9F: F4 36 00     	pea	#<$36
  2938 00:0AA2: 22 xx xx xx  	jsl	~~CH376SendCmdDatWaitInt
  2939 00:0AA6: E2 20        	sep	#$20
  2940                        	longa	off
  2941 00:0AA8: 85 01        	sta	<R0
  2942 00:0AAA: C2 20        	rep	#$20
  2943                        	longa	on
  2944 00:0AAC: A5 01        	lda	<R0
  2945 00:0AAE: 29 FF 00     	and	#$ff
  2946                        L180:
  2947 00:0AB1: A8           	tay
  Thu Dec  3 2020 22:25                                                Page 56


  2948 00:0AB2: A5 06        	lda	<L177+2
  2949 00:0AB4: 85 08        	sta	<L177+2+2
  2950 00:0AB6: A5 05        	lda	<L177+1
  2951 00:0AB8: 85 07        	sta	<L177+1+2
  2952 00:0ABA: 2B           	pld
  2953 00:0ABB: 3B           	tsc
  2954 00:0ABC: 18           	clc
  2955 00:0ABD: 69 06 00     	adc	#L177+2
  2956 00:0AC0: 1B           	tcs
  2957 00:0AC1: 98           	tya
  2958 00:0AC2: 6B           	rtl
  2959                        ;}
  2960                        	.line	364
  2961                        	.endblock	364
  2962             00000004   L177	equ	4
  2963             00000005   L178	equ	5
  2964                        	ends
  2965                        	efunc
  2966                        	.endfunc	364,5,4
  2967                        	.line	364
  2968                        ;
  2969                        ;UINT8	CH376DirInfoRead( void )
  2970                        ;{
  2971                        	.line	366
  2972                        	.line	367
  2973                        	code
  2974                        	xdef	~~CH376DirInfoRead
  2975                        	func
  2976                        	.function	367
  2977                        ~~CH376DirInfoRead:
  2978                        	longa	on
  2979                        	longi	on
  2980 00:0AC3: 3B           	tsc
  2981 00:0AC4: 38           	sec
  2982 00:0AC5: E9 04 00     	sbc	#L181
  2983 00:0AC8: 1B           	tcs
  2984 00:0AC9: 0B           	phd
  2985 00:0ACA: 5B           	tcd
  2986                        	.block	367
  2987                        ;	return( CH376SendCmdDatWaitInt( CMD1H_DIR_INFO_R
                    EAD, 0xFF ) );
  2988                        	.line	368
  2989 00:0ACB: F4 FF 00     	pea	#<$ff
  2990 00:0ACE: F4 37 00     	pea	#<$37
  2991 00:0AD1: 22 xx xx xx  	jsl	~~CH376SendCmdDatWaitInt
  2992 00:0AD5: E2 20        	sep	#$20
  2993                        	longa	off
  2994 00:0AD7: 85 01        	sta	<R0
  2995 00:0AD9: C2 20        	rep	#$20
  2996                        	longa	on
  2997 00:0ADB: A5 01        	lda	<R0
  2998 00:0ADD: 29 FF 00     	and	#$ff
  2999                        L184:
  3000 00:0AE0: A8           	tay
  3001 00:0AE1: 2B           	pld
  3002 00:0AE2: 3B           	tsc
  3003 00:0AE3: 18           	clc
  3004 00:0AE4: 69 04 00     	adc	#L181
  Thu Dec  3 2020 22:25                                                Page 57


  3005 00:0AE7: 1B           	tcs
  3006 00:0AE8: 98           	tya
  3007 00:0AE9: 6B           	rtl
  3008                        ;}
  3009                        	.line	369
  3010                        	.endblock	369
  3011             00000004   L181	equ	4
  3012             00000005   L182	equ	5
  3013                        	ends
  3014                        	efunc
  3015                        	.endfunc	369,5,4
  3016                        	.line	369
  3017                        ;
  3018                        ;UINT8	CH376DirInfoSave( void )
  3019                        ;{
  3020                        	.line	371
  3021                        	.line	372
  3022                        	code
  3023                        	xdef	~~CH376DirInfoSave
  3024                        	func
  3025                        	.function	372
  3026                        ~~CH376DirInfoSave:
  3027                        	longa	on
  3028                        	longi	on
  3029 00:0AEA: 3B           	tsc
  3030 00:0AEB: 38           	sec
  3031 00:0AEC: E9 04 00     	sbc	#L185
  3032 00:0AEF: 1B           	tcs
  3033 00:0AF0: 0B           	phd
  3034 00:0AF1: 5B           	tcd
  3035                        	.block	372
  3036                        ;	return( CH376SendCmdWaitInt( CMD0H_DIR_INFO_SAVE
                     ) );
  3037                        	.line	373
  3038 00:0AF2: F4 38 00     	pea	#<$38
  3039 00:0AF5: 22 xx xx xx  	jsl	~~CH376SendCmdWaitInt
  3040 00:0AF9: E2 20        	sep	#$20
  3041                        	longa	off
  3042 00:0AFB: 85 01        	sta	<R0
  3043 00:0AFD: C2 20        	rep	#$20
  3044                        	longa	on
  3045 00:0AFF: A5 01        	lda	<R0
  3046 00:0B01: 29 FF 00     	and	#$ff
  3047                        L188:
  3048 00:0B04: A8           	tay
  3049 00:0B05: 2B           	pld
  3050 00:0B06: 3B           	tsc
  3051 00:0B07: 18           	clc
  3052 00:0B08: 69 04 00     	adc	#L185
  3053 00:0B0B: 1B           	tcs
  3054 00:0B0C: 98           	tya
  3055 00:0B0D: 6B           	rtl
  3056                        ;}
  3057                        	.line	374
  3058                        	.endblock	374
  3059             00000004   L185	equ	4
  3060             00000005   L186	equ	5
  3061                        	ends
  Thu Dec  3 2020 22:25                                                Page 58


  3062                        	efunc
  3063                        	.endfunc	374,5,4
  3064                        	.line	374
  3065                        ;
  3066                        ;UINT8	CH376ByteLocate( UINT32 offset )
  3067                        ;{
  3068                        	.line	376
  3069                        	.line	377
  3070                        	code
  3071                        	xdef	~~CH376ByteLocate
  3072                        	func
  3073                        	.function	377
  3074                        ~~CH376ByteLocate:
  3075                        	longa	on
  3076                        	longi	on
  3077 00:0B0E: 3B           	tsc
  3078 00:0B0F: 38           	sec
  3079 00:0B10: E9 04 00     	sbc	#L189
  3080 00:0B13: 1B           	tcs
  3081 00:0B14: 0B           	phd
  3082 00:0B15: 5B           	tcd
  3083             00000004   offset_0	set	4
  3084                        	.block	377
  3085                        ;	xWriteCH376Cmd( CMD4H_BYTE_LOCATE );
  3086                        	.sym	offset,4,18,6,32
  3087                        	.line	378
  3088 00:0B16: F4 39 00     	pea	#<$39
  3089 00:0B19: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
  3090                        ;	xWriteCH376Data( (UINT8)offset );
  3091                        	.line	379
  3092 00:0B1D: D4 08        	pei	<L189+offset_0
  3093 00:0B1F: 22 xx xx xx  	jsl	~~xWriteCH376Data
  3094                        ;	xWriteCH376Data( (UINT8)((UINT16)offset>>8) );
  3095                        	.line	380
  3096 00:0B23: A5 08        	lda	<L189+offset_0
  3097 00:0B25: EB           	xba
  3098 00:0B26: 29 FF 00     	and	#$00ff
  3099 00:0B29: 48           	pha
  3100 00:0B2A: 22 xx xx xx  	jsl	~~xWriteCH376Data
  3101                        ;	xWriteCH376Data( (UINT8)(offset>>16) );
  3102                        	.line	381
  3103 00:0B2E: D4 0A        	pei	<L189+offset_0+2
  3104 00:0B30: D4 08        	pei	<L189+offset_0
  3105 00:0B32: A9 10 00     	lda	#$10
  3106                        	xref	~~~llsr
  3107 00:0B35: 22 xx xx xx  	jsl	~~~llsr
  3108 00:0B39: 85 01        	sta	<R0
  3109 00:0B3B: 86 03        	stx	<R0+2
  3110 00:0B3D: D4 01        	pei	<R0
  3111 00:0B3F: 22 xx xx xx  	jsl	~~xWriteCH376Data
  3112                        ;	xWriteCH376Data( (UINT8)(offset>>24) );
  3113                        	.line	382
  3114 00:0B43: D4 0A        	pei	<L189+offset_0+2
  3115 00:0B45: D4 08        	pei	<L189+offset_0
  3116 00:0B47: A9 18 00     	lda	#$18
  3117                        	xref	~~~llsr
  3118 00:0B4A: 22 xx xx xx  	jsl	~~~llsr
  3119 00:0B4E: 85 01        	sta	<R0
  Thu Dec  3 2020 22:25                                                Page 59


  3120 00:0B50: 86 03        	stx	<R0+2
  3121 00:0B52: D4 01        	pei	<R0
  3122 00:0B54: 22 xx xx xx  	jsl	~~xWriteCH376Data
  3123                        ;	xEndCH376Cmd( );
  3124                        	.line	383
  3125 00:0B58: 22 xx xx xx  	jsl	~~xEndCH376Cmd
  3126                        ;	return( Wait376Interrupt( ) );
  3127                        	.line	384
  3128 00:0B5C: 22 xx xx xx  	jsl	~~Wait376Interrupt
  3129 00:0B60: E2 20        	sep	#$20
  3130                        	longa	off
  3131 00:0B62: 85 01        	sta	<R0
  3132 00:0B64: C2 20        	rep	#$20
  3133                        	longa	on
  3134 00:0B66: A5 01        	lda	<R0
  3135 00:0B68: 29 FF 00     	and	#$ff
  3136                        L192:
  3137 00:0B6B: A8           	tay
  3138 00:0B6C: A5 06        	lda	<L189+2
  3139 00:0B6E: 85 0A        	sta	<L189+2+4
  3140 00:0B70: A5 05        	lda	<L189+1
  3141 00:0B72: 85 09        	sta	<L189+1+4
  3142 00:0B74: 2B           	pld
  3143 00:0B75: 3B           	tsc
  3144 00:0B76: 18           	clc
  3145 00:0B77: 69 08 00     	adc	#L189+4
  3146 00:0B7A: 1B           	tcs
  3147 00:0B7B: 98           	tya
  3148 00:0B7C: 6B           	rtl
  3149                        ;}
  3150                        	.line	385
  3151                        	.endblock	385
  3152             00000004   L189	equ	4
  3153             00000005   L190	equ	5
  3154                        	ends
  3155                        	efunc
  3156                        	.endfunc	385,5,4
  3157                        	.line	385
  3158                        ;
  3159                        ;UINT8	CH376ByteRead( PUINT8 buf, UINT16 ReqCou
                    nt, PUINT16 RealCount )
  3160                        ;{
  3161                        	.line	387
  3162                        	.line	388
  3163                        	code
  3164                        	xdef	~~CH376ByteRead
  3165                        	func
  3166                        	.function	388
  3167                        ~~CH376ByteRead:
  3168                        	longa	on
  3169                        	longi	on
  3170 00:0B7D: 3B           	tsc
  3171 00:0B7E: 38           	sec
  3172 00:0B7F: E9 05 00     	sbc	#L193
  3173 00:0B82: 1B           	tcs
  3174 00:0B83: 0B           	phd
  3175 00:0B84: 5B           	tcd
  3176             00000004   buf_0	set	4
  Thu Dec  3 2020 22:25                                                Page 60


  3177             00000008   ReqCount_0	set	8
  3178             0000000A   RealCount_0	set	10
  3179                        	.block	388
  3180                        ;	UINT8	s;
  3181                        ;	xWriteCH376Cmd( CMD2H_BYTE_READ );
  3182             00000000   s_1	set	0
  3183                        	.sym	s,0,14,1,8
  3184                        	.sym	buf,4,142,6,32
  3185                        	.sym	ReqCount,8,15,6,16
  3186                        	.sym	RealCount,10,143,6,32
  3187                        	.line	390
  3188 00:0B85: F4 3A 00     	pea	#<$3a
  3189 00:0B88: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
  3190                        ;	xWriteCH376Data( (UINT8)ReqCount );
  3191                        	.line	391
  3192 00:0B8C: D4 0D        	pei	<L193+ReqCount_0
  3193 00:0B8E: 22 xx xx xx  	jsl	~~xWriteCH376Data
  3194                        ;	xWriteCH376Data( (UINT8)(ReqCount>>8) );
  3195                        	.line	392
  3196 00:0B92: A5 0D        	lda	<L193+ReqCount_0
  3197 00:0B94: EB           	xba
  3198 00:0B95: 29 FF 00     	and	#$00ff
  3199 00:0B98: 48           	pha
  3200 00:0B99: 22 xx xx xx  	jsl	~~xWriteCH376Data
  3201                        ;	xEndCH376Cmd( );
  3202                        	.line	393
  3203 00:0B9D: 22 xx xx xx  	jsl	~~xEndCH376Cmd
  3204                        ;	if ( RealCount ) *RealCount = 0;
  3205                        	.line	394
  3206 00:0BA1: A5 0F        	lda	<L193+RealCount_0
  3207 00:0BA3: 05 11        	ora	<L193+RealCount_0+2
  3208 00:0BA5: D0 03        	bne	L196
  3209 00:0BA7: 82 05 00     	brl	L10062
  3210                        L196:
  3211                        	.line	394
  3212 00:0BAA: A9 00 00     	lda	#$0
  3213 00:0BAD: 87 0F        	sta	[<L193+RealCount_0]
  3214                        ;	while ( 1 ) {
  3215                        L10062:
  3216                        	.line	395
  3217                        L10063:
  3218                        	.line	395
  3219                        ;		s = Wait376Interrupt( );
  3220                        	.line	396
  3221 00:0BAF: 22 xx xx xx  	jsl	~~Wait376Interrupt
  3222 00:0BB3: E2 20        	sep	#$20
  3223                        	longa	off
  3224 00:0BB5: 85 05        	sta	<L194+s_1
  3225 00:0BB7: C2 20        	rep	#$20
  3226                        	longa	on
  3227                        ;		if ( s == USB_INT_DISK_READ ) {
  3228                        	.line	397
  3229 00:0BB9: E2 20        	sep	#$20
  3230                        	longa	off
  3231 00:0BBB: A5 05        	lda	<L194+s_1
  3232 00:0BBD: C9 1D        	cmp	#<$1d
  3233 00:0BBF: C2 20        	rep	#$20
  3234                        	longa	on
  Thu Dec  3 2020 22:25                                                Page 61


  3235 00:0BC1: F0 03        	beq	L197
  3236 00:0BC3: 82 49 00     	brl	L10065
  3237                        L197:
  3238                        	.line	397
  3239                        ;			s = CH376ReadBlock( buf );
  3240                        	.line	398
  3241 00:0BC6: D4 0B        	pei	<L193+buf_0+2
  3242 00:0BC8: D4 09        	pei	<L193+buf_0
  3243 00:0BCA: 22 xx xx xx  	jsl	~~CH376ReadBlock
  3244 00:0BCE: E2 20        	sep	#$20
  3245                        	longa	off
  3246 00:0BD0: 85 05        	sta	<L194+s_1
  3247 00:0BD2: C2 20        	rep	#$20
  3248                        	longa	on
  3249                        ;			xWriteCH376Cmd( CMD0H_BYTE_RD_GO
                     );
  3250                        	.line	399
  3251 00:0BD4: F4 3B 00     	pea	#<$3b
  3252 00:0BD7: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
  3253                        ;			xEndCH376Cmd( );
  3254                        	.line	400
  3255 00:0BDB: 22 xx xx xx  	jsl	~~xEndCH376Cmd
  3256                        ;			buf += s;
  3257                        	.line	401
  3258 00:0BDF: A5 05        	lda	<L194+s_1
  3259 00:0BE1: 29 FF 00     	and	#$ff
  3260 00:0BE4: 85 01        	sta	<R0
  3261 00:0BE6: 64 03        	stz	<R0+2
  3262 00:0BE8: 18           	clc
  3263 00:0BE9: A5 09        	lda	<L193+buf_0
  3264 00:0BEB: 65 01        	adc	<R0
  3265 00:0BED: 85 09        	sta	<L193+buf_0
  3266 00:0BEF: A5 0B        	lda	<L193+buf_0+2
  3267 00:0BF1: 65 03        	adc	<R0+2
  3268 00:0BF3: 85 0B        	sta	<L193+buf_0+2
  3269                        ;			if ( RealCount ) *RealCount += s
                    ;
  3270                        	.line	402
  3271 00:0BF5: A5 0F        	lda	<L193+RealCount_0
  3272 00:0BF7: 05 11        	ora	<L193+RealCount_0+2
  3273 00:0BF9: D0 03        	bne	L198
  3274 00:0BFB: 82 0E 00     	brl	L10066
  3275                        L198:
  3276                        	.line	402
  3277 00:0BFE: A5 05        	lda	<L194+s_1
  3278 00:0C00: 29 FF 00     	and	#$ff
  3279 00:0C03: 85 01        	sta	<R0
  3280 00:0C05: 18           	clc
  3281 00:0C06: A5 01        	lda	<R0
  3282 00:0C08: 67 0F        	adc	[<L193+RealCount_0]
  3283 00:0C0A: 87 0F        	sta	[<L193+RealCount_0]
  3284                        ;		}
  3285                        L10066:
  3286                        	.line	403
  3287                        ;/*		else if ( s == USB_INT_SUCCESS )
                     return( s );*/
  3288                        ;		else return( s );
  3289 00:0C0C: 82 17 00     	brl	L10067
  Thu Dec  3 2020 22:25                                                Page 62


  3290                        L10065:
  3291                        	.line	405
  3292 00:0C0F: A5 05        	lda	<L194+s_1
  3293 00:0C11: 29 FF 00     	and	#$ff
  3294                        L199:
  3295 00:0C14: A8           	tay
  3296 00:0C15: A5 07        	lda	<L193+2
  3297 00:0C17: 85 11        	sta	<L193+2+10
  3298 00:0C19: A5 06        	lda	<L193+1
  3299 00:0C1B: 85 10        	sta	<L193+1+10
  3300 00:0C1D: 2B           	pld
  3301 00:0C1E: 3B           	tsc
  3302 00:0C1F: 18           	clc
  3303 00:0C20: 69 0F 00     	adc	#L193+10
  3304 00:0C23: 1B           	tcs
  3305 00:0C24: 98           	tya
  3306 00:0C25: 6B           	rtl
  3307                        L10067:
  3308                        ;	}
  3309                        	.line	406
  3310 00:0C26: 82 86 FF     	brl	L10063
  3311                        ;}
  3312                        	.line	407
  3313                        	.endblock	407
  3314             00000005   L193	equ	5
  3315             00000005   L194	equ	5
  3316                        	ends
  3317                        	efunc
  3318                        	.endfunc	407,5,5
  3319                        	.line	407
  3320                        ;
  3321                        ;UINT8	CH376ByteWrite( PUINT8 buf, UINT16 ReqCo
                    unt, PUINT16 RealCount )
  3322                        ;{
  3323                        	.line	409
  3324                        	.line	410
  3325                        	code
  3326                        	xdef	~~CH376ByteWrite
  3327                        	func
  3328                        	.function	410
  3329                        ~~CH376ByteWrite:
  3330                        	longa	on
  3331                        	longi	on
  3332 00:0C29: 3B           	tsc
  3333 00:0C2A: 38           	sec
  3334 00:0C2B: E9 05 00     	sbc	#L200
  3335 00:0C2E: 1B           	tcs
  3336 00:0C2F: 0B           	phd
  3337 00:0C30: 5B           	tcd
  3338             00000004   buf_0	set	4
  3339             00000008   ReqCount_0	set	8
  3340             0000000A   RealCount_0	set	10
  3341                        	.block	410
  3342                        ;	UINT8	s;
  3343                        ;	xWriteCH376Cmd( CMD2H_BYTE_WRITE );
  3344             00000000   s_1	set	0
  3345                        	.sym	s,0,14,1,8
  3346                        	.sym	buf,4,142,6,32
  Thu Dec  3 2020 22:25                                                Page 63


  3347                        	.sym	ReqCount,8,15,6,16
  3348                        	.sym	RealCount,10,143,6,32
  3349                        	.line	412
  3350 00:0C31: F4 3C 00     	pea	#<$3c
  3351 00:0C34: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
  3352                        ;	xWriteCH376Data( (UINT8)ReqCount );
  3353                        	.line	413
  3354 00:0C38: D4 0D        	pei	<L200+ReqCount_0
  3355 00:0C3A: 22 xx xx xx  	jsl	~~xWriteCH376Data
  3356                        ;	xWriteCH376Data( (UINT8)(ReqCount>>8) );
  3357                        	.line	414
  3358 00:0C3E: A5 0D        	lda	<L200+ReqCount_0
  3359 00:0C40: EB           	xba
  3360 00:0C41: 29 FF 00     	and	#$00ff
  3361 00:0C44: 48           	pha
  3362 00:0C45: 22 xx xx xx  	jsl	~~xWriteCH376Data
  3363                        ;	xEndCH376Cmd( );
  3364                        	.line	415
  3365 00:0C49: 22 xx xx xx  	jsl	~~xEndCH376Cmd
  3366                        ;	if ( RealCount ) *RealCount = 0;
  3367                        	.line	416
  3368 00:0C4D: A5 0F        	lda	<L200+RealCount_0
  3369 00:0C4F: 05 11        	ora	<L200+RealCount_0+2
  3370 00:0C51: D0 03        	bne	L203
  3371 00:0C53: 82 05 00     	brl	L10068
  3372                        L203:
  3373                        	.line	416
  3374 00:0C56: A9 00 00     	lda	#$0
  3375 00:0C59: 87 0F        	sta	[<L200+RealCount_0]
  3376                        ;	while ( 1 ) {
  3377                        L10068:
  3378                        	.line	417
  3379                        L10069:
  3380                        	.line	417
  3381                        ;		s = Wait376Interrupt( );
  3382                        	.line	418
  3383 00:0C5B: 22 xx xx xx  	jsl	~~Wait376Interrupt
  3384 00:0C5F: E2 20        	sep	#$20
  3385                        	longa	off
  3386 00:0C61: 85 05        	sta	<L201+s_1
  3387 00:0C63: C2 20        	rep	#$20
  3388                        	longa	on
  3389                        ;		if ( s == USB_INT_DISK_WRITE ) {
  3390                        	.line	419
  3391 00:0C65: E2 20        	sep	#$20
  3392                        	longa	off
  3393 00:0C67: A5 05        	lda	<L201+s_1
  3394 00:0C69: C9 1E        	cmp	#<$1e
  3395 00:0C6B: C2 20        	rep	#$20
  3396                        	longa	on
  3397 00:0C6D: F0 03        	beq	L204
  3398 00:0C6F: 82 49 00     	brl	L10071
  3399                        L204:
  3400                        	.line	419
  3401                        ;			s = CH376WriteReqBlock( buf );
  3402                        	.line	420
  3403 00:0C72: D4 0B        	pei	<L200+buf_0+2
  3404 00:0C74: D4 09        	pei	<L200+buf_0
  Thu Dec  3 2020 22:25                                                Page 64


  3405 00:0C76: 22 xx xx xx  	jsl	~~CH376WriteReqBlock
  3406 00:0C7A: E2 20        	sep	#$20
  3407                        	longa	off
  3408 00:0C7C: 85 05        	sta	<L201+s_1
  3409 00:0C7E: C2 20        	rep	#$20
  3410                        	longa	on
  3411                        ;			xWriteCH376Cmd( CMD0H_BYTE_WR_GO
                     );
  3412                        	.line	421
  3413 00:0C80: F4 3D 00     	pea	#<$3d
  3414 00:0C83: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
  3415                        ;			xEndCH376Cmd( );
  3416                        	.line	422
  3417 00:0C87: 22 xx xx xx  	jsl	~~xEndCH376Cmd
  3418                        ;			buf += s;
  3419                        	.line	423
  3420 00:0C8B: A5 05        	lda	<L201+s_1
  3421 00:0C8D: 29 FF 00     	and	#$ff
  3422 00:0C90: 85 01        	sta	<R0
  3423 00:0C92: 64 03        	stz	<R0+2
  3424 00:0C94: 18           	clc
  3425 00:0C95: A5 09        	lda	<L200+buf_0
  3426 00:0C97: 65 01        	adc	<R0
  3427 00:0C99: 85 09        	sta	<L200+buf_0
  3428 00:0C9B: A5 0B        	lda	<L200+buf_0+2
  3429 00:0C9D: 65 03        	adc	<R0+2
  3430 00:0C9F: 85 0B        	sta	<L200+buf_0+2
  3431                        ;			if ( RealCount ) *RealCount += s
                    ;
  3432                        	.line	424
  3433 00:0CA1: A5 0F        	lda	<L200+RealCount_0
  3434 00:0CA3: 05 11        	ora	<L200+RealCount_0+2
  3435 00:0CA5: D0 03        	bne	L205
  3436 00:0CA7: 82 0E 00     	brl	L10072
  3437                        L205:
  3438                        	.line	424
  3439 00:0CAA: A5 05        	lda	<L201+s_1
  3440 00:0CAC: 29 FF 00     	and	#$ff
  3441 00:0CAF: 85 01        	sta	<R0
  3442 00:0CB1: 18           	clc
  3443 00:0CB2: A5 01        	lda	<R0
  3444 00:0CB4: 67 0F        	adc	[<L200+RealCount_0]
  3445 00:0CB6: 87 0F        	sta	[<L200+RealCount_0]
  3446                        ;		}
  3447                        L10072:
  3448                        	.line	425
  3449                        ;/*		else if ( s == USB_INT_SUCCESS )
                     return( s );*/
  3450                        ;		else return( s );
  3451 00:0CB8: 82 17 00     	brl	L10073
  3452                        L10071:
  3453                        	.line	427
  3454 00:0CBB: A5 05        	lda	<L201+s_1
  3455 00:0CBD: 29 FF 00     	and	#$ff
  3456                        L206:
  3457 00:0CC0: A8           	tay
  3458 00:0CC1: A5 07        	lda	<L200+2
  3459 00:0CC3: 85 11        	sta	<L200+2+10
  Thu Dec  3 2020 22:25                                                Page 65


  3460 00:0CC5: A5 06        	lda	<L200+1
  3461 00:0CC7: 85 10        	sta	<L200+1+10
  3462 00:0CC9: 2B           	pld
  3463 00:0CCA: 3B           	tsc
  3464 00:0CCB: 18           	clc
  3465 00:0CCC: 69 0F 00     	adc	#L200+10
  3466 00:0CCF: 1B           	tcs
  3467 00:0CD0: 98           	tya
  3468 00:0CD1: 6B           	rtl
  3469                        L10073:
  3470                        ;	}
  3471                        	.line	428
  3472 00:0CD2: 82 86 FF     	brl	L10069
  3473                        ;}
  3474                        	.line	429
  3475                        	.endblock	429
  3476             00000005   L200	equ	5
  3477             00000005   L201	equ	5
  3478                        	ends
  3479                        	efunc
  3480                        	.endfunc	429,5,5
  3481                        	.line	429
  3482                        ;
  3483                        ;#ifdef	EN_DISK_QUERY
  3484                        ;
  3485                        ;UINT8	CH376DiskCapacity( PUINT32 DiskCap )
  3486                        ;{
  3487                        ;	UINT8	s;
  3488                        ;	s = CH376SendCmdWaitInt( CMD0H_DISK_CAPACITY );
  3489                        ;	if ( s == USB_INT_SUCCESS ) {
  3490                        ;		xWriteCH376Cmd( CMD01_RD_USB_DATA0 );
  3491                        ;		xReadCH376Data( );
  3492                        ;		*DiskCap = CH376Read32bitDat( );
  3493                        ;	}
  3494                        ;	else *DiskCap = 0;
  3495                        ;	return( s );
  3496                        ;}
  3497                        ;
  3498                        ;UINT8	CH376DiskQuery( PUINT32 DiskFre )
  3499                        ;{
  3500                        ;	UINT8	s;
  3501                        ;	UINT8	c0, c1, c2, c3;
  3502                        ;#ifndef	DEF_IC_V43_U
  3503                        ;	xWriteCH376Cmd( CMD01_GET_IC_VER );
  3504                        ;	if ( xReadCH376Data( ) < 0x43 ) {
  3505                        ;		if ( CH376ReadVar8( VAR_DISK_STATUS ) >=
                     DEF_DISK_READY ) CH376WriteVar8( VAR_DISK_STATUS, DEF_DISK_
                    MOUNTED );
  3506                        ;	}
  3507                        ;#endif
  3508                        ;	s = CH376SendCmdWaitInt( CMD0H_DISK_QUERY );
  3509                        ;	if ( s == USB_INT_SUCCESS ) {
  3510                        ;		xWriteCH376Cmd( CMD01_RD_USB_DATA0 );
  3511                        ;		xReadCH376Data( );
  3512                        ;		xReadCH376Data( );
  3513                        ;		xReadCH376Data( );
  3514                        ;		xReadCH376Data( );
  3515                        ;		xReadCH376Data( );
  Thu Dec  3 2020 22:25                                                Page 66


  3516                        ;		c0 = xReadCH376Data( );
  3517                        ;		c1 = xReadCH376Data( );
  3518                        ;		c2 = xReadCH376Data( );
  3519                        ;		c3 = xReadCH376Data( );
  3520                        ;		*DiskFre = c0 | (UINT16)c1 << 8 | (UINT3
                    2)c2 << 16 | (UINT32)c3 << 24;
  3521                        ;		xReadCH376Data( );
  3522                        ;		xEndCH376Cmd( );
  3523                        ;	}
  3524                        ;	else *DiskFre = 0;
  3525                        ;	return( s );
  3526                        ;}
  3527                        ;
  3528                        ;#endif
  3529                        ;
  3530                        ;UINT8	CH376SecLocate( UINT32 offset )
  3531                        ;{
  3532                        	.line	478
  3533                        	.line	479
  3534                        	code
  3535                        	xdef	~~CH376SecLocate
  3536                        	func
  3537                        	.function	479
  3538                        ~~CH376SecLocate:
  3539                        	longa	on
  3540                        	longi	on
  3541 00:0CD5: 3B           	tsc
  3542 00:0CD6: 38           	sec
  3543 00:0CD7: E9 04 00     	sbc	#L207
  3544 00:0CDA: 1B           	tcs
  3545 00:0CDB: 0B           	phd
  3546 00:0CDC: 5B           	tcd
  3547             00000004   offset_0	set	4
  3548                        	.block	479
  3549                        ;	xWriteCH376Cmd( CMD4H_SEC_LOCATE );
  3550                        	.sym	offset,4,18,6,32
  3551                        	.line	480
  3552 00:0CDD: F4 4A 00     	pea	#<$4a
  3553 00:0CE0: 22 xx xx xx  	jsl	~~xWriteCH376Cmd
  3554                        ;	xWriteCH376Data( (UINT8)offset );
  3555                        	.line	481
  3556 00:0CE4: D4 08        	pei	<L207+offset_0
  3557 00:0CE6: 22 xx xx xx  	jsl	~~xWriteCH376Data
  3558                        ;	xWriteCH376Data( (UINT8)((UINT16)offset>>8) );
  3559                        	.line	482
  3560 00:0CEA: A5 08        	lda	<L207+offset_0
  3561 00:0CEC: EB           	xba
  3562 00:0CED: 29 FF 00     	and	#$00ff
  3563 00:0CF0: 48           	pha
  3564 00:0CF1: 22 xx xx xx  	jsl	~~xWriteCH376Data
  3565                        ;	xWriteCH376Data( (UINT8)(offset>>16) );
  3566                        	.line	483
  3567 00:0CF5: D4 0A        	pei	<L207+offset_0+2
  3568 00:0CF7: D4 08        	pei	<L207+offset_0
  3569 00:0CF9: A9 10 00     	lda	#$10
  3570                        	xref	~~~llsr
  3571 00:0CFC: 22 xx xx xx  	jsl	~~~llsr
  3572 00:0D00: 85 01        	sta	<R0
  Thu Dec  3 2020 22:25                                                Page 67


  3573 00:0D02: 86 03        	stx	<R0+2
  3574 00:0D04: D4 01        	pei	<R0
  3575 00:0D06: 22 xx xx xx  	jsl	~~xWriteCH376Data
  3576                        ;	xWriteCH376Data( 0 );
  3577                        	.line	484
  3578 00:0D0A: F4 00 00     	pea	#<$0
  3579 00:0D0D: 22 xx xx xx  	jsl	~~xWriteCH376Data
  3580                        ;	xEndCH376Cmd( );
  3581                        	.line	485
  3582 00:0D11: 22 xx xx xx  	jsl	~~xEndCH376Cmd
  3583                        ;	return( Wait376Interrupt( ) );
  3584                        	.line	486
  3585 00:0D15: 22 xx xx xx  	jsl	~~Wait376Interrupt
  3586 00:0D19: E2 20        	sep	#$20
  3587                        	longa	off
  3588 00:0D1B: 85 01        	sta	<R0
  3589 00:0D1D: C2 20        	rep	#$20
  3590                        	longa	on
  3591 00:0D1F: A5 01        	lda	<R0
  3592 00:0D21: 29 FF 00     	and	#$ff
  3593                        L210:
  3594 00:0D24: A8           	tay
  3595 00:0D25: A5 06        	lda	<L207+2
  3596 00:0D27: 85 0A        	sta	<L207+2+4
  3597 00:0D29: A5 05        	lda	<L207+1
  3598 00:0D2B: 85 09        	sta	<L207+1+4
  3599 00:0D2D: 2B           	pld
  3600 00:0D2E: 3B           	tsc
  3601 00:0D2F: 18           	clc
  3602 00:0D30: 69 08 00     	adc	#L207+4
  3603 00:0D33: 1B           	tcs
  3604 00:0D34: 98           	tya
  3605 00:0D35: 6B           	rtl
  3606                        ;}
  3607                        	.line	487
  3608                        	.endblock	487
  3609             00000004   L207	equ	4
  3610             00000005   L208	equ	5
  3611                        	ends
  3612                        	efunc
  3613                        	.endfunc	487,5,4
  3614                        	.line	487
  3615                        ;
  3616                        ;#ifdef	EN_SECTOR_ACCESS
  3617                        ;
  3618                        ;UINT8	CH376DiskReadSec( PUINT8 buf, UINT32 iLb
                    aStart, UINT8 iSectorCount )
  3619                        ;
  3620                        ;{
  3621                        ;	UINT8	s, err;
  3622                        ;	UINT16	mBlockCount;
  3623                        ;	for ( err = 0; err != 3; ++ err ) {
  3624                        ;		xWriteCH376Cmd( CMD5H_DISK_READ );
  3625                        ;		xWriteCH376Data( (UINT8)iLbaStart );
  3626                        ;		xWriteCH376Data( (UINT8)( (UINT16)iLbaSt
                    art >> 8 ) );
  3627                        ;		xWriteCH376Data( (UINT8)( iLbaStart >> 1
                    6 ) );
  Thu Dec  3 2020 22:25                                                Page 68


  3628                        ;		xWriteCH376Data( (UINT8)( iLbaStart >> 2
                    4 ) );
  3629                        ;		xWriteCH376Data( iSectorCount );
  3630                        ;		xEndCH376Cmd( );
  3631                        ;		for ( mBlockCount = iSectorCount * DEF_S
                    ECTOR_SIZE / CH376_DAT_BLOCK_LEN; mBlockCount != 0; -- mBloc
                    kCount ) {
  3632                        ;			s = Wait376Interrupt( );
  3633                        ;			if ( s == USB_INT_DISK_READ ) {
  3634                        ;				s = CH376ReadBlock( buf 
                    );
  3635                        ;				xWriteCH376Cmd( CMD0H_DI
                    SK_RD_GO );
  3636                        ;				xEndCH376Cmd( );
  3637                        ;				buf += s;
  3638                        ;			}
  3639                        ;			else break;
  3640                        ;		}
  3641                        ;		if ( mBlockCount == 0 ) {
  3642                        ;			s = Wait376Interrupt( );
  3643                        ;			if ( s == USB_INT_SUCCESS ) retu
                    rn( USB_INT_SUCCESS );
  3644                        ;		}
  3645                        ;		if ( s == USB_INT_DISCONNECT ) return( s
                     );
  3646                        ;		CH376DiskReqSense( );
  3647                        ;	}
  3648                        ;	return( s );
  3649                        ;}
  3650                        ;
  3651                        ;UINT8	CH376DiskWriteSec( PUINT8 buf, UINT32 iL
                    baStart, UINT8 iSectorCount )
  3652                        ;
  3653                        ;{
  3654                        ;	UINT8	s, err;
  3655                        ;	UINT16	mBlockCount;
  3656                        ;	for ( err = 0; err != 3; ++ err ) {
  3657                        ;		xWriteCH376Cmd( CMD5H_DISK_WRITE );
  3658                        ;		xWriteCH376Data( (UINT8)iLbaStart );
  3659                        ;		xWriteCH376Data( (UINT8)( (UINT16)iLbaSt
                    art >> 8 ) );
  3660                        ;		xWriteCH376Data( (UINT8)( iLbaStart >> 1
                    6 ) );
  3661                        ;		xWriteCH376Data( (UINT8)( iLbaStart >> 2
                    4 ) );
  3662                        ;		xWriteCH376Data( iSectorCount );
  3663                        ;		xEndCH376Cmd( );
  3664                        ;		for ( mBlockCount = iSectorCount * DEF_S
                    ECTOR_SIZE / CH376_DAT_BLOCK_LEN; mBlockCount != 0; -- mBloc
                    kCount ) {
  3665                        ;			s = Wait376Interrupt( );
  3666                        ;			if ( s == USB_INT_DISK_WRITE ) {
  3667                        ;				CH376WriteHostBlock( buf
                    , CH376_DAT_BLOCK_LEN );
  3668                        ;				xWriteCH376Cmd( CMD0H_DI
                    SK_WR_GO );
  3669                        ;				xEndCH376Cmd( );
  3670                        ;				buf += CH376_DAT_BLOCK_L
  Thu Dec  3 2020 22:25                                                Page 69


                    EN;
  3671                        ;			}
  3672                        ;			else break;
  3673                        ;		}
  3674                        ;		if ( mBlockCount == 0 ) {
  3675                        ;			s = Wait376Interrupt( );
  3676                        ;			if ( s == USB_INT_SUCCESS ) retu
                    rn( USB_INT_SUCCESS );
  3677                        ;		}
  3678                        ;		if ( s == USB_INT_DISCONNECT ) return( s
                     );
  3679                        ;		CH376DiskReqSense( );
  3680                        ;	}
  3681                        ;	return( s );
  3682                        ;}
  3683                        ;
  3684                        ;UINT8	CH376SecRead( PUINT8 buf, UINT8 ReqCount
                    , PUINT8 RealCount )
  3685                        ;{
  3686                        ;	UINT8	s;
  3687                        ;	UINT8	cnt;
  3688                        ;	UINT32	StaSec;
  3689                        ;#ifndef	DEF_IC_V43_U
  3690                        ;	UINT32	fsz, fofs;
  3691                        ;#endif
  3692                        ;	if ( RealCount ) *RealCount = 0;
  3693                        ;	do {
  3694                        ;#ifndef	DEF_IC_V43_U
  3695                        ;		xWriteCH376Cmd( CMD01_GET_IC_VER );
  3696                        ;		cnt = xReadCH376Data( );
  3697                        ;		if ( cnt == 0x41 ) {
  3698                        ;			xWriteCH376Cmd( CMD14_READ_VAR32
                     );
  3699                        ;			xWriteCH376Data( VAR_FILE_SIZE )
                    ;
  3700                        ;			xReadCH376Data( );
  3701                        ;			fsz = xReadCH376Data( );
  3702                        ;			fsz |= (UINT16)(xReadCH376Data( 
                    )) << 8;
  3703                        ;			cnt = xReadCH376Data( );
  3704                        ;			fsz |= (UINT32)cnt << 16;
  3705                        ;			xWriteCH376Cmd( CMD14_READ_VAR32
                     );
  3706                        ;			xWriteCH376Data( VAR_CURRENT_OFF
                    SET );
  3707                        ;			xReadCH376Data( );
  3708                        ;			fofs = xReadCH376Data( );
  3709                        ;			fofs |= (UINT16)(xReadCH376Data(
                     )) << 8;
  3710                        ;			fofs |= (UINT32)(xReadCH376Data(
                     )) << 16;
  3711                        ;			if ( fsz >= fofs + 510 ) CH376Wr
                    iteVar8( VAR_FILE_SIZE + 3, 0xFF );
  3712                        ;			else cnt = 0xFF;
  3713                        ;		}
  3714                        ;		else cnt = 0xFF;
  3715                        ;#endif
  3716                        ;		xWriteCH376Cmd( CMD1H_SEC_READ );
  Thu Dec  3 2020 22:25                                                Page 70


  3717                        ;		xWriteCH376Data( ReqCount );
  3718                        ;		xEndCH376Cmd( );
  3719                        ;		s = Wait376Interrupt( );
  3720                        ;#ifndef	DEF_IC_V43_U
  3721                        ;		if ( cnt != 0xFF ) CH376WriteVar8( VAR_F
                    ILE_SIZE + 3, cnt );
  3722                        ;#endif
  3723                        ;		if ( s != USB_INT_SUCCESS ) return( s );
  3724                        ;		xWriteCH376Cmd( CMD01_RD_USB_DATA0 );
  3725                        ;		xReadCH376Data( );
  3726                        ;		cnt = xReadCH376Data( );
  3727                        ;		xReadCH376Data( );
  3728                        ;		xReadCH376Data( );
  3729                        ;		xReadCH376Data( );
  3730                        ;		StaSec = CH376Read32bitDat( );
  3731                        ;		if ( cnt == 0 ) break;
  3732                        ;		s = CH376DiskReadSec( buf, StaSec, cnt )
                    ;
  3733                        ;		if ( s != USB_INT_SUCCESS ) return( s );
  3734                        ;		buf += cnt * DEF_SECTOR_SIZE;
  3735                        ;		if ( RealCount ) *RealCount += cnt;
  3736                        ;		ReqCount -= cnt;
  3737                        ;	} while ( ReqCount );
  3738                        ;	return( s );
  3739                        ;}
  3740                        ;
  3741                        ;UINT8	CH376SecWrite( PUINT8 buf, UINT8 ReqCoun
                    t, PUINT8 RealCount )
  3742                        ;{
  3743                        ;	UINT8	s;
  3744                        ;	UINT8	cnt;
  3745                        ;	UINT32	StaSec;
  3746                        ;	if ( RealCount ) *RealCount = 0;
  3747                        ;	do {
  3748                        ;		xWriteCH376Cmd( CMD1H_SEC_WRITE );
  3749                        ;		xWriteCH376Data( ReqCount );
  3750                        ;		xEndCH376Cmd( );
  3751                        ;		s = Wait376Interrupt( );
  3752                        ;		if ( s != USB_INT_SUCCESS ) return( s );
  3753                        ;		xWriteCH376Cmd( CMD01_RD_USB_DATA0 );
  3754                        ;		xReadCH376Data( );
  3755                        ;		cnt = xReadCH376Data( );
  3756                        ;		xReadCH376Data( );
  3757                        ;		xReadCH376Data( );
  3758                        ;		xReadCH376Data( );
  3759                        ;		StaSec = CH376Read32bitDat( );
  3760                        ;		if ( cnt == 0 ) break;
  3761                        ;		s = CH376DiskWriteSec( buf, StaSec, cnt 
                    );
  3762                        ;		if ( s != USB_INT_SUCCESS ) return( s );
  3763                        ;		buf += cnt * DEF_SECTOR_SIZE;
  3764                        ;		if ( RealCount ) *RealCount += cnt;
  3765                        ;		ReqCount -= cnt;
  3766                        ;	} while ( ReqCount );
  3767                        ;	return( s );
  3768                        ;}
  3769                        ;
  3770                        ;#endif
  Thu Dec  3 2020 22:25                                                Page 71


  3771                        ;
  3772                        ;#ifdef	EN_LONG_NAME
  3773                        ;
  3774                        ;UINT8	CH376LongNameWrite( PUINT8 buf, UINT16 R
                    eqCount )
  3775                        ;{
  3776                        ;	UINT8	s;
  3777                        ;#ifndef	DEF_IC_V43_U
  3778                        ;	UINT8	c;
  3779                        ;	c = CH376ReadVar8( VAR_DISK_STATUS );
  3780                        ;	if ( c == DEF_DISK_OPEN_ROOT ) CH376WriteVar8( V
                    AR_DISK_STATUS, DEF_DISK_OPEN_DIR );
  3781                        ;#endif
  3782                        ;	xWriteCH376Cmd( CMD2H_BYTE_WRITE );
  3783                        ;	xWriteCH376Data( (UINT8)ReqCount );
  3784                        ;	xWriteCH376Data( (UINT8)(ReqCount>>8) );
  3785                        ;	xEndCH376Cmd( );
  3786                        ;	while ( 1 ) {
  3787                        ;		s = Wait376Interrupt( );
  3788                        ;		if ( s == USB_INT_DISK_WRITE ) {
  3789                        ;			if ( buf ) buf += CH376WriteReqB
                    lock( buf );
  3790                        ;			else {
  3791                        ;				xWriteCH376Cmd( CMD01_WR
                    _REQ_DATA );
  3792                        ;				s = xReadCH376Data( );
  3793                        ;				while ( s -- ) xWriteCH3
                    76Data( 0 );
  3794                        ;			}
  3795                        ;			xWriteCH376Cmd( CMD0H_BYTE_WR_GO
                     );
  3796                        ;			xEndCH376Cmd( );
  3797                        ;		}
  3798                        ;/*		else if ( s == USB_INT_SUCCESS )
                     return( s );*/
  3799                        ;		else {
  3800                        ;#ifndef	DEF_IC_V43_U
  3801                        ;			if ( c == DEF_DISK_OPEN_ROOT ) C
                    H376WriteVar8( VAR_DISK_STATUS, c );
  3802                        ;#endif
  3803                        ;			return( s );
  3804                        ;		}
  3805                        ;	}
  3806                        ;}
  3807                        ;
  3808                        ;UINT8	CH376CheckNameSum( PUINT8 DirName )
  3809                        ;{
  3810                        ;	UINT8	NameLen;
  3811                        ;	UINT8	CheckSum;
  3812                        ;	CheckSum = 0;
  3813                        ;	for ( NameLen = 0; NameLen != 11; NameLen ++ ) C
                    heckSum = ( CheckSum & 1 ? 0x80 : 0x00 ) + ( CheckSum >> 1 )
                     + *DirName++;
  3814                        ;	return( CheckSum );
  3815                        ;}
  3816                        ;
  3817                        ;UINT8	CH376LocateInUpDir( PUINT8 PathName )
  3818                        ;
  Thu Dec  3 2020 22:25                                                Page 72


  3819                        ;
  3820                        ;{
  3821                        ;	UINT8	s;
  3822                        ;	xWriteCH376Cmd( CMD14_READ_VAR32 );
  3823                        ;	xWriteCH376Data( VAR_FAT_DIR_LBA );
  3824                        ;	for ( s = 4; s != 8; s ++ ) GlobalBuf[ s ] = xRe
                    adCH376Data( );
  3825                        ;	xEndCH376Cmd( );
  3826                        ;	s = CH376SeparatePath( PathName );
  3827                        ;	if ( s ) s = CH376FileOpenDir( PathName, s );
  3828                        ;	else s = CH376FileOpen( "/" );
  3829                        ;	if ( s != ERR_OPEN_DIR ) return( s );
  3830                        ;	*(PUINT32)(&GlobalBuf[0]) = 0;
  3831                        ;	while ( 1 ) {
  3832                        ;		s = CH376SecLocate( *(PUINT32)(&GlobalBu
                    f[0]) );
  3833                        ;		if ( s != USB_INT_SUCCESS ) return( s );
  3834                        ;		CH376ReadBlock( &GlobalBuf[8] );
  3835                        ;		if ( *(PUINT32)(&GlobalBuf[8]) == *(PUIN
                    T32)(&GlobalBuf[4]) ) return( USB_INT_SUCCESS );
  3836                        ;		xWriteCH376Cmd( CMD50_WRITE_VAR32 );
  3837                        ;		xWriteCH376Data( VAR_FAT_DIR_LBA );
  3838                        ;		for ( s = 8; s != 12; s ++ ) xWriteCH376
                    Data( GlobalBuf[ s ] );
  3839                        ;		xEndCH376Cmd( );
  3840                        ;		++ *(PUINT32)(&GlobalBuf[0]);
  3841                        ;	}
  3842                        ;}
  3843                        ;
  3844                        ;UINT8	CH376GetLongName( PUINT8 PathName, PUINT
                    8 LongName )
  3845                        ;
  3846                        ;
  3847                        ;{
  3848                        ;	UINT8	s;
  3849                        ;	UINT16	NameCount;
  3850                        ;	s = CH376FileOpenPath( PathName );
  3851                        ;	if ( s != USB_INT_SUCCESS && s != ERR_OPEN_DIR )
                     return( s );
  3852                        ;	s = CH376DirInfoRead( );
  3853                        ;	if ( s != USB_INT_SUCCESS ) return( s );
  3854                        ;	CH376ReadBlock( GlobalBuf );
  3855                        ;	CH376EndDirInfo( );
  3856                        ;	GlobalBuf[32] = CH376CheckNameSum( GlobalBuf );
  3857                        ;	GlobalBuf[33] = CH376ReadVar8( VAR_FILE_DIR_INDE
                    X );
  3858                        ;	NameCount = 0;
  3859                        ;	while ( 1 ) {
  3860                        ;		if ( GlobalBuf[33] == 0 ) {
  3861                        ;			s = CH376LocateInUpDir( PathName
                     );
  3862                        ;			if ( s != USB_INT_SUCCESS ) brea
                    k;
  3863                        ;			if ( CH376ReadVar32( VAR_CURRENT
                    _OFFSET ) == 0 ) {
  3864                        ;				s = ERR_LONG_NAME_ERR;
  3865                        ;				break;
  3866                        ;			}
  Thu Dec  3 2020 22:25                                                Page 73


  3867                        ;			GlobalBuf[33] = DEF_SECTOR_SIZE 
                    / sizeof( FAT_DIR_INFO );
  3868                        ;		}
  3869                        ;		GlobalBuf[33] --;
  3870                        ;		s = CH376SendCmdDatWaitInt( CMD1H_DIR_IN
                    FO_READ, GlobalBuf[33] );
  3871                        ;		if ( s != USB_INT_SUCCESS ) break;
  3872                        ;		CH376ReadBlock( GlobalBuf );
  3873                        ;		CH376EndDirInfo( );
  3874                        ;		if ( ( GlobalBuf[11] & ATTR_LONG_NAME_MA
                    SK ) != ATTR_LONG_NAME || GlobalBuf[13] != GlobalBuf[32] ) {
  3875                        ;			s = ERR_LONG_NAME_ERR;
  3876                        ;			break;
  3877                        ;		}
  3878                        ;		for ( s = 1; s < sizeof( FAT_DIR_INFO );
                     s += 2 ) {
  3879                        ;			if ( s == 1 + 5 * 2 ) s = 14;
  3880                        ;			else if ( s == 14 + 6 * 2 ) s = 
                    28;
  3881                        ;			LongName[ NameCount++ ] = Global
                    Buf[ s ];
  3882                        ;			LongName[ NameCount++ ] = Global
                    Buf[ s + 1 ];
  3883                        ;			if ( GlobalBuf[ s ] == 0 && Glob
                    alBuf[ s + 1 ] == 0 ) break;
  3884                        ;			if ( NameCount >= LONG_NAME_BUF_
                    LEN ) {
  3885                        ;				s = ERR_LONG_BUF_OVER;
  3886                        ;				goto CH376GetLongNameE;
  3887                        ;			}
  3888                        ;		}
  3889                        ;		if ( GlobalBuf[0] & 0x40 ) {
  3890                        ;			if ( s >= sizeof( FAT_DIR_INFO )
                     ) *(PUINT16)( &LongName[ NameCount ] ) = 0x0000;
  3891                        ;			s = USB_INT_SUCCESS;
  3892                        ;			break;
  3893                        ;		}
  3894                        ;	}
  3895                        ;CH376GetLongNameE:
  3896                        ;	CH376FileClose( FALSE );
  3897                        ;	return( s );
  3898                        ;}
  3899                        ;
  3900                        ;UINT8	CH376CreateLongName( PUINT8 PathName, PU
                    INT8 LongName )
  3901                        ;{
  3902                        ;	UINT8	s, i;
  3903                        ;	UINT8	DirBlockCnt;
  3904                        ;	UINT16	count;
  3905                        ;	UINT16	NameCount;
  3906                        ;	UINT32	NewFileLoc;
  3907                        ;	for ( count = 0; count < LONG_NAME_BUF_LEN; coun
                    t += 2 ) if ( *(PUINT16)(&LongName[count]) == 0 ) break;
  3908                        ;	if ( count == 0 || count >= LONG_NAME_BUF_LEN ||
                     count > LONE_NAME_MAX_CHAR ) return( ERR_LONG_NAME_ERR );
  3909                        ;	DirBlockCnt = count / LONG_NAME_PER_DIR;
  3910                        ;	i = count - DirBlockCnt * LONG_NAME_PER_DIR;
  3911                        ;	if ( i ) {
  Thu Dec  3 2020 22:25                                                Page 74


  3912                        ;		if ( ++ DirBlockCnt * LONG_NAME_PER_DIR 
                    > LONG_NAME_BUF_LEN ) return( ERR_LONG_BUF_OVER );
  3913                        ;		count += 2;
  3914                        ;		i += 2;
  3915                        ;		if ( i < LONG_NAME_PER_DIR ) {
  3916                        ;			while ( i++ < LONG_NAME_PER_DIR 
                    ) LongName[count++] = 0xFF;
  3917                        ;		}
  3918                        ;	}
  3919                        ;	s = CH376FileOpenPath( PathName );
  3920                        ;	if ( s == USB_INT_SUCCESS ) {
  3921                        ;		s = ERR_NAME_EXIST;
  3922                        ;		goto CH376CreateLongNameE;
  3923                        ;	}
  3924                        ;	if ( s != ERR_MISS_FILE ) return( s );
  3925                        ;	s = CH376FileCreatePath( PathName );
  3926                        ;	if ( s != USB_INT_SUCCESS ) return( s );
  3927                        ;	i = CH376ReadVar8( VAR_FILE_DIR_INDEX );
  3928                        ;	s = CH376LocateInUpDir( PathName );
  3929                        ;	if ( s != USB_INT_SUCCESS ) goto CH376CreateLong
                    NameE;
  3930                        ;	NewFileLoc = CH376ReadVar32( VAR_CURRENT_OFFSET 
                    ) + i * sizeof(FAT_DIR_INFO);
  3931                        ;	s = CH376ByteLocate( NewFileLoc );
  3932                        ;	if ( s != USB_INT_SUCCESS ) goto CH376CreateLong
                    NameE;
  3933                        ;	s = CH376ByteRead( &GlobalBuf[ sizeof(FAT_DIR_IN
                    FO) ], sizeof(FAT_DIR_INFO), NULL );
  3934                        ;	if ( s != USB_INT_SUCCESS ) goto CH376CreateLong
                    NameE;
  3935                        ;	for ( i = DirBlockCnt; i != 0; -- i ) {
  3936                        ;		s = CH376ByteRead( GlobalBuf, sizeof(FAT
                    _DIR_INFO), &count );
  3937                        ;		if ( s != USB_INT_SUCCESS ) goto CH376Cr
                    eateLongNameE;
  3938                        ;		if ( count == 0 ) break;
  3939                        ;		if ( GlobalBuf[0] && GlobalBuf[0] != 0xE
                    5 ) {
  3940                        ;			s = CH376ByteLocate( NewFileLoc 
                    );
  3941                        ;			if ( s != USB_INT_SUCCESS ) goto
                     CH376CreateLongNameE;
  3942                        ;			GlobalBuf[ 0 ] = 0xE5;
  3943                        ;			for ( s = 1; s != sizeof(FAT_DIR
                    _INFO); s ++ ) GlobalBuf[ s ] = GlobalBuf[ sizeof(FAT_DIR_IN
                    FO) + s ];
  3944                        ;			s = CH376LongNameWrite( GlobalBu
                    f, sizeof(FAT_DIR_INFO) );
  3945                        ;			if ( s != USB_INT_SUCCESS ) goto
                     CH376CreateLongNameE;
  3946                        ;			do {
  3947                        ;				s = CH376ByteRead( Globa
                    lBuf, sizeof(FAT_DIR_INFO), &count );
  3948                        ;				if ( s != USB_INT_SUCCES
                    S ) goto CH376CreateLongNameE;
  3949                        ;			} while ( count && GlobalBuf[0] 
                    );
  3950                        ;			NewFileLoc = CH376ReadVar32( VAR
  Thu Dec  3 2020 22:25                                                Page 75


                    _CURRENT_OFFSET );
  3951                        ;			i = DirBlockCnt + 1;
  3952                        ;			if ( count == 0 ) break;
  3953                        ;			NewFileLoc -= sizeof(FAT_DIR_INF
                    O);
  3954                        ;		}
  3955                        ;	}
  3956                        ;	if ( i ) {
  3957                        ;		s = CH376ReadVar8( VAR_SEC_PER_CLUS );
  3958                        ;		if ( s == 128 ) {
  3959                        ;			s = ERR_FDT_OVER;
  3960                        ;			goto CH376CreateLongNameE;
  3961                        ;		}
  3962                        ;		count = s * DEF_SECTOR_SIZE;
  3963                        ;		if ( count < i * sizeof(FAT_DIR_INFO) ) 
                    count <<= 1;
  3964                        ;		s = CH376LongNameWrite( NULL, count );
  3965                        ;		if ( s != USB_INT_SUCCESS ) goto CH376Cr
                    eateLongNameE;
  3966                        ;	}
  3967                        ;	s = CH376ByteLocate( NewFileLoc );
  3968                        ;	if ( s != USB_INT_SUCCESS ) goto CH376CreateLong
                    NameE;
  3969                        ;	GlobalBuf[11] = ATTR_LONG_NAME;
  3970                        ;	GlobalBuf[12] = 0x00;
  3971                        ;	GlobalBuf[13] = CH376CheckNameSum( &GlobalBuf[ s
                    izeof(FAT_DIR_INFO) ] );
  3972                        ;	GlobalBuf[26] = 0x00;
  3973                        ;	GlobalBuf[27] = 0x00;
  3974                        ;	for ( s = 0; DirBlockCnt != 0; ) {
  3975                        ;		GlobalBuf[0] = s ? DirBlockCnt : DirBloc
                    kCnt | 0x40;
  3976                        ;		DirBlockCnt --;
  3977                        ;		NameCount = DirBlockCnt * LONG_NAME_PER_
                    DIR;
  3978                        ;		for ( s = 1; s < sizeof( FAT_DIR_INFO );
                     s += 2 ) {
  3979                        ;			if ( s == 1 + 5 * 2 ) s = 14;
  3980                        ;			else if ( s == 14 + 6 * 2 ) s = 
                    28;
  3981                        ;			GlobalBuf[ s ] = LongName[ NameC
                    ount++ ];
  3982                        ;			GlobalBuf[ s + 1 ] = LongName[ N
                    ameCount++ ];
  3983                        ;		}
  3984                        ;		s = CH376LongNameWrite( GlobalBuf, sizeo
                    f(FAT_DIR_INFO) );
  3985                        ;		if ( s != USB_INT_SUCCESS ) goto CH376Cr
                    eateLongNameE;
  3986                        ;	}
  3987                        ;	s = CH376LongNameWrite( &GlobalBuf[ sizeof(FAT_D
                    IR_INFO) ], sizeof(FAT_DIR_INFO) );
  3988                        ;CH376CreateLongNameE:
  3989                        ;	CH376FileClose( FALSE );
  3990                        ;	return( s );
  3991                        ;}
  3992                        ;
  3993                        ;#endif
  Thu Dec  3 2020 22:25                                                Page 76


  3994                        ;
  3995                        	.line	866
  3996                        	.file	"G:\devprojects\c256Foenix\fxos\FXOSWork
                    space\FXOSv1\src\FILE_SYS.C",478
  3997                        	xref	~~Query376Interrupt
  3998                        	xref	~~xReadCH376Data
  3999                        	xref	~~xWriteCH376Data
  4000                        	xref	~~xWriteCH376Cmd
  4001                        	xref	~~xEndCH376Cmd
  4002                        	xref	~~mDelaymS
  4003                        	.sym	~~CH376SecLocate,~~CH376SecLocate,78,2,0
  4004                        	.sym	~~CH376ByteWrite,~~CH376ByteWrite,78,2,0
  4005                        	.sym	~~CH376ByteRead,~~CH376ByteRead,78,2,0
  4006                        	.sym	~~CH376ByteLocate,~~CH376ByteLocate,78,2
                    ,0
  4007                        	.sym	~~CH376DirInfoSave,~~CH376DirInfoSave,78
                    ,2,0
  4008                        	.sym	~~CH376DirInfoRead,~~CH376DirInfoRead,78
                    ,2,0
  4009                        	.sym	~~CH376FileClose,~~CH376FileClose,78,2,0
  4010                        	.sym	~~CH376FileErase,~~CH376FileErase,78,2,0
  4011                        	.sym	~~CH376FileCreatePath,~~CH376FileCreateP
                    ath,78,2,0
  4012                        	.sym	~~CH376FileOpenPath,~~CH376FileOpenPath,
                    78,2,0
  4013                        	.sym	~~CH376FileOpenDir,~~CH376FileOpenDir,78
                    ,2,0
  4014                        	.sym	~~CH376SeparatePath,~~CH376SeparatePath,
                    78,2,0
  4015                        	.sym	~~CH376DirCreate,~~CH376DirCreate,78,2,0
  4016                        	.sym	~~CH376FileCreate,~~CH376FileCreate,78,2
                    ,0
  4017                        	.sym	~~CH376FileOpen,~~CH376FileOpen,78,2,0
  4018                        	.sym	~~CH376DiskMount,~~CH376DiskMount,78,2,0
  4019                        	.sym	~~CH376DiskConnect,~~CH376DiskConnect,78
                    ,2,0
  4020                        	.sym	~~CH376DiskReqSense,~~CH376DiskReqSense,
                    78,2,0
  4021                        	.sym	~~CH376SendCmdDatWaitInt,~~CH376SendCmdD
                    atWaitInt,78,2,0
  4022                        	.sym	~~CH376SendCmdWaitInt,~~CH376SendCmdWait
                    Int,78,2,0
  4023                        	.sym	~~Wait376Interrupt,~~Wait376Interrupt,78
                    ,2,0
  4024                        	.sym	~~CH376GetIntStatus,~~CH376GetIntStatus,
                    78,2,0
  4025                        	.sym	~~CH376GetDiskStatus,~~CH376GetDiskStatu
                    s,78,2,0
  4026                        	.sym	~~CH376GetFileSize,~~CH376GetFileSize,82
                    ,2,0
  4027                        	.sym	~~CH376EndDirInfo,~~CH376EndDirInfo,65,2
                    ,0
  4028                        	.sym	~~CH376WriteVar32,~~CH376WriteVar32,65,2
                    ,0
  4029                        	.sym	~~CH376ReadVar32,~~CH376ReadVar32,82,2,0
  4030                        	.sym	~~CH376WriteVar8,~~CH376WriteVar8,65,2,0
  4031                        	.sym	~~CH376ReadVar8,~~CH376ReadVar8,78,2,0
  4032                        	.sym	~~CH376Read32bitDat,~~CH376Read32bitDat,
  Thu Dec  3 2020 22:25                                                Page 77


                    82,2,0
  4033                        	.sym	~~CH376SetFileName,~~CH376SetFileName,65
                    ,2,0
  4034                        	.sym	~~CH376WriteOfsBlock,~~CH376WriteOfsBloc
                    k,65,2,0
  4035                        	.sym	~~CH376WriteHostBlock,~~CH376WriteHostBl
                    ock,65,2,0
  4036                        	.sym	~~CH376WriteReqBlock,~~CH376WriteReqBloc
                    k,78,2,0
  4037                        	.sym	~~CH376ReadBlock,~~CH376ReadBlock,78,2,0
  4038                        	.sym	~~Query376Interrupt,~~Query376Interrupt,
                    78,18,0
  4039                        	.sym	~~xReadCH376Data,~~xReadCH376Data,78,18,
                    0
  4040                        	.sym	~~xWriteCH376Data,~~xWriteCH376Data,65,1
                    8,0
  4041                        	.sym	~~xWriteCH376Cmd,~~xWriteCH376Cmd,65,18,
                    0
  4042                        	.sym	~~xEndCH376Cmd,~~xEndCH376Cmd,65,18,0
  4043                        	.sym	~~mDelaymS,~~mDelaymS,65,18,0
  4044                        	.sym	P_CH376_CMD_DATA,0,139,14,32,20
  4045                        	.sym	CH376_CMD_DATA,0,11,14,288,20
  4046                        	.sym	P_SENSE_DATA,0,138,14,32,4
  4047                        	.sym	SENSE_DATA,0,10,14,144,4
  4048                        	.sym	P_INQUIRY_DATA,0,138,14,32,3
  4049                        	.sym	INQUIRY_DATA,0,10,14,288,3
  4050                        	.sym	P_BULK_ONLY_CBW,0,138,14,32,2
  4051                        	.sym	BULK_ONLY_CBW,0,10,14,248,2
  4052                        	.sym	P_FAT_DIR_INFO,0,138,14,32,1
  4053                        	.sym	FAT_DIR_INFO,0,10,14,256,1
  4054                        	.sym	PUINT8V,0,142,14,32
  4055                        	.sym	UINT8V,0,14,14,8
  4056                        	.sym	PUINT32,0,146,14,32
  4057                        	.sym	PUINT16,0,143,14,32
  4058                        	.sym	PUINT8,0,142,14,32
  4059                        	.sym	UINT32,0,18,14,32
  4060                        	.sym	UINT16,0,15,14,16
  4061                        	.sym	UINT8,0,14,14,8
  4062                        	end


      Lines assembled: 4062
      Errors: 0
